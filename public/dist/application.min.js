"use strict";function routeConfig($stateProvider){$stateProvider.state("recipes",{"abstract":!0,url:"/recipes",template:"<ui-view/>"}).state("recipes.list",{url:"",templateUrl:"modules/recipes/client/views/recipes/recipes-list.client.view.html"}).state("recipes.create",{url:"/create",templateUrl:"modules/recipes/client/views/recipes/recipe-form.client.view.html",data:{roles:["user","admin"]}}).state("recipes.view",{url:"/:recipeId",templateUrl:"modules/recipes/client/views/recipes/recipe-read.client.view.html"}).state("recipes.edit",{url:"/:recipeId/edit",templateUrl:"modules/recipes/client/views/recipes/recipe-form.client.view.html",data:{roles:["user","admin"]}}).state("ingredients",{"abstract":!0,url:"/ingredients",template:"<ui-view/>"}).state("ingredients.list",{url:"",templateUrl:"modules/recipes/client/views/ingredients/ingredients-list.client.view.html",data:{roles:["user","admin"]}}).state("ingredients.create",{url:"/create",templateUrl:"modules/recipes/client/views/ingredients/ingredient-form.client.view.html",data:{roles:["user","admin"]}}).state("ingredients.view",{url:"/:ingredientId",templateUrl:"modules/recipes/client/views/ingredients/ingredient-read.client.view.html",data:{roles:["user","admin"]}}).state("ingredients.edit",{url:"/:ingredientId/edit",templateUrl:"modules/recipes/client/views/ingredients/ingredient-form.client.view.html",data:{roles:["user","admin"]}}).state("measures",{"abstract":!0,url:"/measures",template:"<ui-view/>"}).state("measures.list",{url:"",templateUrl:"modules/recipes/client/views/measures/measures-list.client.view.html",data:{roles:["admin"]}}).state("measures.create",{url:"/create",templateUrl:"modules/recipes/client/views/measures/measure-form.client.view.html",data:{roles:["admin"]}}).state("measures.edit",{url:"/:measureId",templateUrl:"modules/recipes/client/views/measures/measure-form.client.view.html",data:{roles:["admin"]}}).state("products",{"abstract":!0,url:"/products",template:"<ui-view/>"}).state("products.list",{url:"",templateUrl:"modules/recipes/client/views/products/products-list.client.view.html",data:{roles:["admin"]}}).state("products.create",{url:"/create",templateUrl:"modules/recipes/client/views/products/product-create.client.view.html",data:{roles:["admin"]}}).state("products.edit",{url:"/:productId",templateUrl:"modules/recipes/client/views/products/product-edit.client.view.html",data:{roles:["admin"]}}).state("menu",{"abstract":!0,url:"/menu",template:"<ui-view/>"}).state("menu.list",{url:"",templateUrl:"modules/recipes/client/views/menus/menus-list.client.view.html",data:{roles:["admin"]}}).state("menu.create",{url:"/create",templateUrl:"modules/recipes/client/views/menus/menu-init.client.view.html",data:{roles:["admin"]}}).state("menu.init",{url:"/:menuId/init",templateUrl:"modules/recipes/client/views/menus/menu-init.client.view.html",data:{roles:["admin"]}}).state("menu.meals",{url:"/:menuId/meals",templateUrl:"modules/recipes/client/views/menus/menu-meals.client.view.html",data:{roles:["admin"]}}).state("menu.edit",{url:"/:menuId/weekplan",templateUrl:"modules/recipes/client/views/menus/menu-weekplan.client.view.html",data:{roles:["admin"]}}).state("menu.view",{url:"/:menuId",templateUrl:"modules/recipes/client/views/menus/menu-read.client.view.html",data:{roles:["admin"]}}).state("menu.summary",{url:"/:menuId/summary",templateUrl:"modules/recipes/client/views/menus/menu-summary.client.view.html",data:{roles:["admin"]}}).state("shelf",{"abstract":!0,url:"/shelf",template:"<ui-view/>"}).state("shelf.list",{url:"",templateUrl:"modules/recipes/client/views/shelf/shelf-list.client.view.html",data:{pageTitle:"Shelf List"}}).state("shelf.create",{url:"/create",params:{ingredient:null},templateUrl:"modules/recipes/client/views/shelf/shelf-form.client.view.html",data:{roles:["user","admin"]}}).state("shelf.edit",{url:"/:shelfId/edit",templateUrl:"modules/recipes/client/views/shelf/shelf-form.client.view.html",data:{roles:["user","admin"]}}).state("shelf.view",{url:"/:shelfId",templateUrl:"modules/recipes/client/views/shelf/shelf-read.client.view.html",data:{roles:["user","admin"]}}).state("shelf.query",{url:"/:shelfId/query",templateUrl:"modules/recipes/client/views/shelf/shelf-queries.client.view.html",data:{roles:["user","admin"]}}).state("shelf.queryEdit",{url:"/:shelfId/query/:queryId",templateUrl:"modules/recipes/client/views/shelf/shelf-query-edit.client.view.html",data:{roles:["user","admin"]}})}function IngredientsController($scope,$stateParams,$location,$window,$timeout,Authentication,IngredientService,MeasureService,FileUploader){$scope.authentication=Authentication,$scope.find=function(){IngredientService.query().$promise.then(function(ingredients){$scope.ingredients=ingredients})},$scope.findOne=function(){$stateParams.ingredientId?IngredientService.get({ingredientId:$stateParams.ingredientId}).$promise.then(function(ingredient){$scope.ingredient=ingredient,ingredient.getMeasure().then(function(measure){$scope.ingredient.measure=measure}),ingredient.getShelf().then(function(shelf){shelf.id&&($scope.shelf=shelf)})}):$scope.ingredient=new IngredientService},$scope.getMeasures=function(value){return MeasureService.query().$promise.then(function(results){var matched=[];return results.forEach(function(item,i,arr){item.caption.includes(value)&&matched.push(item)}),matched})},$scope.setMeasure=function(subMeasure){$scope.ingredient.measureDefault=subMeasure.id,$scope.ingredient.measure=subMeasure},$scope.unsetMeasure=function(){$scope.ingredient.measure=null,$scope.ingredient.measureDefault=null,$scope.asyncSelected=null},$scope.unsetPicture=function(){$scope.ingredient.image="",$scope.uploader.clearQueue()},$scope.save=function(isValid){function successCallback(res){$location.path("ingredients/"+$scope.ingredient.id)}function errorCallback(res){$scope.error=res.data.message}return isValid?void $scope.ingredient.createOrUpdate().then(successCallback)["catch"](errorCallback):($scope.$broadcast("show-errors-check-validity","menuForm"),!1)};var uploader=$scope.uploader=new FileUploader({url:"/api/pictures/ingredients"});$scope.imageurl="http://res.cloudinary.com/thomascookbook/image/upload/v1466671927/",uploader.filters.push({name:"imageFilter",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(type)!==-1}},{name:"overWriteFilter",fn:function(item,options){return 1===this.queue.length&&this.clearQueue(),!0}}),$scope.uploader.onAfterAddingFile=function(fileItem){if($window.FileReader){var fileReader=new FileReader;fileReader.readAsDataURL(fileItem._file),fileReader.onload=function(fileReaderEvent){$timeout(function(){$scope.imageURL=fileReaderEvent.target.result},0)}}}}function IngridientsController($scope,$stateParams,$location,$window,$timeout,Authentication,Recipes,Ingridients,Measures,FileUploader){$scope.authentication=Authentication,$scope.find=function(){$scope.ingridients=Ingridients.query()},$scope.findOne=function(){$scope.ingridient=Ingridients.get({ingridientId:$stateParams.ingridientId})},$scope.getMeasuresList=function(){return Measures.query().$promise},$scope.create=function(isValid){if($scope.error=null,!isValid)return $scope.$broadcast("show-errors-check-validity","ingridientForm"),!1;var ingridient=new Ingridients({caption:this.caption,infoCard:this.infoCard,image:$scope.imageURL,measureDefault:$scope.measureDefault});ingridient.$save(function(response){$location.path("ingridients/"+response.id),$scope.caption="",$scope.infoCard=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.update=function(isValid){if($scope.error=null,!isValid)return $scope.$broadcast("show-errors-check-validity","ingridientForm"),!1;var ingridient=$scope.ingridient;ingridient.image=$scope.imageURL,ingridient.$update(function(){$location.path("ingridients/"+ingridient.id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(ingridient){ingridient?(ingridient.$remove(),$location.path("ingridients")):$scope.ingridient.$remove(function(){$location.path("ingridient")})};var uploader=$scope.uploader=new FileUploader({url:"/api/pictures/ingridients"});$scope.imageurl="http://res.cloudinary.com/thomascookbook/image/upload/v1466671927/",uploader.filters.push({name:"imageFilter",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(type)!==-1}}),$scope.uploader.onAfterAddingFile=function(fileItem){if($window.FileReader){var fileReader=new FileReader;fileReader.readAsDataURL(fileItem._file),fileReader.onload=function(fileReaderEvent){$timeout(function(){$scope.imageURL=fileReaderEvent.target.result},0)}}}}function MeasuresController($scope,$stateParams,$location,Authentication,MeasureService){$scope.authentication=Authentication,$scope.converter=[],$scope.find=function(){$scope.measures=MeasureService.query()},$scope.findOne=function(){$stateParams.measureId?MeasureService.get({measureId:$stateParams.measureId}).$promise.then(function(measure){$scope.converter=measure.converter||[],$scope.measure=measure,$scope.uncountable=0===measure.step,$scope.converter&&$scope.converter.forEach(function(item,i,arr){item.index=i})}):$scope.measure=new MeasureService({min:0,step:1})},$scope.getMeasures=function(value){return MeasureService.query().$promise.then(function(results){var matched=[];return results.forEach(function(item,i,arr){item.caption.includes(value)&&matched.push(item)}),matched})},$scope.addSubMeasure=function(subMeasure){$scope.converter.push({id:subMeasure.id,index:$scope.converter.length,caption:subMeasure.caption,rate:1,uncountable:0===subMeasure.step}),$scope.asyncSelected=""},$scope.removeSubMeasure=function(index){$scope.converter.splice(index,1),$scope.converter.forEach(function(item,i,arr){item.index=i})},$scope.applyStep=function(id,step){step<=0&&($scope.uncountable=!0)},$scope.save=function(isValid){function successCallback(res){$location.path("measures")}function errorCallback(res){$scope.error=res.data.message}return isValid?($scope.uncountable&&($scope.measure.step=0,$scope.converter.forEach(function(item,i,arr){item.rate=0})),$scope.measure.converter=$scope.converter,void $scope.measure.createOrUpdate().then(successCallback)["catch"](errorCallback)):($scope.$broadcast("show-errors-check-validity","shelfForm"),!1)}}function MenusController($scope,$stateParams,$location,$window,Authentication,MenuService,ShelfQueryService,Recipes,Measures){$scope.authentication=Authentication,$scope.error=null,$scope.info={},$scope.form={},$scope.mytime=Date.now(),$scope.weekDays=[],$scope.weekDayMask=[!0,!0,!0,!0,!0,!0,!1],$scope.weekDayExamples=[new Date("2016-08-15"),new Date("2016-08-16"),new Date("2016-08-17"),new Date("2016-08-18"),new Date("2016-08-19"),new Date("2016-08-20"),new Date("2016-08-21")],$scope.meals=[{recipeId:1,index:0,type:0,weekday:0,portions:2,comment:"test meal 1",isDone:!1,startTime:960},{recipeId:1,index:1,type:0,weekday:2,portions:2.5,comment:"test meal 2",isDone:!0,startTime:1050},{recipeId:1,index:2,type:1,weekday:2,portions:2.5,comment:"test meal 2 - double",isDone:!0,startTime:1050},{recipeId:1,index:3,type:0,weekday:2,portions:2.5,comment:"test meal 3",isDone:!0,startTime:1050},{recipeId:1,index:4,type:1,weekday:3,portions:2.5,comment:"test meal 2",isDone:!0,startTime:1050}],$scope.find=function(){MenuService.query().$promise.then(function(menus){$scope.menus=menus})},$scope.findOneInit=function(){$stateParams.menuId?MenuService.get({menuId:$stateParams.menuId}).$promise.then(function(menu){$scope.menu=menu,$scope.menu.startDate=new Date(menu.startDate)}):$scope.menu=new MenuService({startDate:new Date(Date.now()),types:[{index:0,caption:"Завтрак",serve:new Date("2016-08-15 7:30")},{index:1,caption:"Обед",serve:new Date("2016-08-15 19:30")}]})},$scope.findOneRecipes=function(){$stateParams.menuId&&MenuService.get({menuId:$stateParams.menuId}).$promise.then(function(menu){menu.meals&&menu.meals.forEach(function(item,i,arr){item.recipe=$scope.getRecipe(item.recipeId)}),$scope.menu=menu,$scope.menu.startDate=new Date(menu.startDate)})},$scope.findOne=function(){$stateParams.menuId?MenuService.get({menuId:$stateParams.menuId}).$promise.then(function(menu){$scope.meals=menu.meals,$scope.menuInitByDays(menu),$scope.menu=menu,$scope.menu.startDate=new Date(menu.startDate)}):$scope.menu=new MenuService({startDate:Date.now(),types:[{index:0,caption:"Завтрак",serve:new Date("2016-08-15 7:30")},{index:1,caption:"Обед",serve:new Date("2016-08-15 19:30")}]})},$scope.findQueryForMenu=function(){ShelfQueryService.query({menuId:$stateParams.menuId}).$promise.then(function(shelfQueries){$scope.shelfQueries=shelfQueries})},$scope.menuInitByDays=function(menu){$scope.weekDays=[],$scope.weekDayMask.forEach(function(weekDay,i,arr){weekDay?$scope.weekDays.push({index:i,isActive:!0,caption:$scope.weekDayExamples[i]}):$scope.weekDays.push({index:i,isActive:!1,caption:$scope.weekDayExamples[i]}),$scope.weekDays[i].types=[],menu.types.forEach(function(type,j,arr){$scope.weekDays[i].types.push({index:j,caption:type.caption,serve:type.serve}),$scope.weekDays[i].types[j].meals=[],$scope.meals.forEach(function(meal,k,arr){meal.weekday===i&&meal.type===$scope.weekDays[i].types[j].index&&($scope.weekDays[i].types[j].meals.push(meal),$scope.weekDays[i].types[j].meals[$scope.weekDays[i].types[j].meals.length-1].index=k)})})}),$scope.form.newType={isShown:!1,caption:null,serve:menu.types[menu.types.length-1].serve}},$scope.addType=function(){$scope.menu.types.push({index:$scope.menu.types[$scope.menu.types.length-1].index+1,caption:$scope.form.newType.caption,serve:$scope.form.newType.serve}),$scope.form.newType={isShown:!1,caption:null,serve:$scope.menu.types[$scope.menu.types.length-1].serve}},$scope.removeType=function(typeIndex){$scope.menu.types.splice(typeIndex,1),$scope.menuInitByDays($scope.menu)},$scope.addMeal=function(weekday,typeIndex){$scope.meals.push({recipeId:1,index:$scope.meals.length,type:typeIndex,weekday:weekday,portions:2.5,comment:"",isDone:!1,startTime:1050}),$scope.menuInitByDays($scope.menu)},$scope.mealMoveType=function(oldType,meal,direction){var targetIndex=-1;$scope.weekDays[meal.weekday].types.some(function(type){if(direction<0){if(type.serve>=oldType.serve)return!0;targetIndex=type.index}else if(targetIndex=type.index,type.serve>oldType.serve)return!0;return!1}),targetIndex!==-1&&($scope.meals[meal.index].type=$scope.weekDays[meal.weekday].types[targetIndex].index,$scope.menuInitByDays($scope.menu))},$scope.mealMoveDay=function(meal,direction){if(direction<0){if(!(meal.weekday>0))return;meal.weekday=meal.weekday-1}else{if(!(meal.weekday<6))return;meal.weekday=meal.weekday+1}$scope.meals[meal.index].weekday=meal.weekday,$scope.menuInitByDays($scope.menu)},$scope.getLocation=function(val){return Recipes.query().$promise.then(function(results){return results.map(function(item){return{id:item.id,caption:item.title}})})},$scope.getRecipe=function(id){return Recipes.get({recipeId:id})},$scope.getRecipeIngredients=function(recipe){recipe.ingridients.length>0&&recipe.ingridients.forEach(function(item,i,arr){Measures.get({measureId:item.ingridientAmount.measureId}).$promise.then(function(measure){item.measure=measure})})},$scope.addRecipe=function(id){Recipes.get({recipeId:id}).$promise.then(function(recipe){$scope.menu.meals.push({recipeId:recipe.id,recipe:recipe,index:$scope.meals.length,portions:recipe.portions}),$scope.getRecipeIngredients(recipe)})},$scope.remove=function(){$window.confirm("Are you sure you want to delete?")&&($scope.menu.$remove(),$location.path("menu"))},$scope.save=function(isValid){function successCallback(res){$location.path("menu/"+$scope.menu.number)}function errorCallback(res){$scope.error=res.data.message}return isValid?(console.log($scope.menu.meals),$scope.menu.meals=[],$scope.meals.forEach(function(meal,k,arr){$scope.menu.meals.push(meal)}),console.log($scope.menu),void $scope.menu.createOrUpdate().then(successCallback)["catch"](errorCallback)):($scope.$broadcast("show-errors-check-validity","menuForm"),!1)}}function MenuInitController($scope,$stateParams,$location,$window,Authentication,MenuService){$scope.authentication=Authentication,$scope.error=null,$scope.form={},$scope.find=function(){MenuService.query().$promise.then(function(menus){$scope.menus=menus})},$scope.findOne=function(){$stateParams.menuId?MenuService.get({menuId:$stateParams.menuId}).$promise.then(function(menu){$scope.menu=menu,$scope.menu.startDate=new Date(menu.startDate)}):$scope.menu=new MenuService({startDate:new Date(Date.now()),types:[{index:0,caption:"Завтрак",serve:new Date("2016-08-15 7:30")},{index:1,caption:"Обед",serve:new Date("2016-08-15 19:30")}]})},$scope.addType=function(){$scope.menu.types.push({index:$scope.menu.types[$scope.menu.types.length-1].index+1,caption:$scope.form.newType.caption,serve:$scope.form.newType.serve}),$scope.form.newType={isShown:!1,caption:null,serve:$scope.menu.types[$scope.menu.types.length-1].serve}},$scope.removeType=function(typeIndex){$scope.menu.types.splice(typeIndex,1),$scope.menuInitByDays($scope.menu)},$scope.remove=function(){$window.confirm("Are you sure you want to delete?")&&($scope.menu.$remove(),$location.path("menu"))},$scope.save=function(isValid){function successCallback(res){$location.path("menu/"+$scope.menu.number+"/meals")}function errorCallback(res){$scope.error=res.data.message}return isValid?void $scope.menu.createOrUpdate().then(successCallback)["catch"](errorCallback):($scope.$broadcast("show-errors-check-validity","menuForm"),!1)}}function MenuMealsController($scope,$stateParams,$location,$window,Authentication,MenuService,RecipeService,MealService){$scope.authentication=Authentication,$scope.error=null,$scope.form={},$scope.recipeList=[],$scope.find=function(){MenuService.query().$promise.then(function(menus){$scope.menus=menus})},$scope.findOne=function(){$stateParams.menuId&&MenuService.get({menuId:$stateParams.menuId}).$promise.then(function(menu){$scope.menu=menu,$scope.menu.startDate=new Date(menu.startDate),$scope.assignMeals()})},$scope.getRecipes=function(value){var matched=[];return 0===$scope.recipeList.length?RecipeService.query().$promise.then(function(results){return $scope.recipeList=results,results.forEach(function(item,i,arr){item.title.includes(value)&&matched.push(item)}),matched}):($scope.recipeList.forEach(function(item,i,arr){item.title.includes(value)&&matched.push(item)}),matched)},$scope.addRecipe=function(recipe){var meal=new MealService({index:$scope.menu.meals.length,recipeId:recipe.id,weekday:-1,type:-1,portions:recipe.portions,recipe:recipe});$scope.menu.meals.push(meal),$scope.form.unassigned.push(meal),$scope.asyncSelected=""},$scope.assignMeals=function(){$scope.form.unassigned=[],$scope.form.types=[],$scope.menu.types.forEach(function(item,i,arr){$scope.form.types.push({caption:item.caption,meals:[]})}),$scope.menu.meals.forEach(function(item,i,arr){item=new MealService(item),item.getRecipe().then(function(recipe){item.recipe=recipe,item.type===-1||item.type>=$scope.form.types.length?$scope.form.unassigned.push(item):$scope.form.types[item.type]&&$scope.form.types[item.type].meals.push(item)})})},$scope.save=function(isValid){function successCallback(res){$location.path("menu/"+$scope.menu.number+"/weekplan")}function errorCallback(res){$scope.error=res.data.message}return isValid?($scope.form.types.forEach(function(type,i,arr){type.meals.forEach(function(meal,j,arr){meal.type=i,meal.recipe=void 0})}),void $scope.menu.createOrUpdate().then(successCallback)["catch"](errorCallback)):($scope.$broadcast("show-errors-check-validity","menuForm"),!1)}}function MenuSummaryController($scope,$stateParams,$location,$window,Authentication,MenuService,IngredientService,MealService){$scope.authentication=Authentication,$scope.error=null,$scope.form={},$scope.find=function(){MenuService.query().$promise.then(function(menus){$scope.menus=menus})},$scope.findOne=function(){$stateParams.menuId&&MenuService.get({menuId:$stateParams.menuId}).$promise.then(function(menu){$scope.menu=menu,$scope.ingredientSummary(),$scope.menu.startDate=new Date(menu.startDate)})},$scope.ingredientSummary=function(){$scope.summary=[],$scope.menu.meals.forEach(function(meal,i,arr){meal=new MealService(meal),meal.getRecipe().then(function(recipe){meal.recipe=recipe,recipe.ingredients.forEach(function(ingredient,j,arr){ingredient=new IngredientService(ingredient),ingredient.measureDefault=ingredient.ingredientAmount.measureId,ingredient.getMeasure().then(function(measure){$scope.addIngredientToSum(ingredient.id,ingredient.caption,ingredient.ingredientAmount.amount,measure,meal.portions)})})})})},$scope.addIngredientToSum=function(id,caption,amount,measure,mult){var done=!1;$scope.summary.forEach(function(ingredient,i,arr){if(ingredient.id===id){if(ingredient.measures.forEach(function(item,j,arr){item.id===measure.id&&(item.amount=item.amount+amount,item.total=+Number(amount*mult).toFixed(3)+item.total,done=!0)}),done)return;ingredient.measures.push({id:measure.id,caption:measure.caption,amount:amount,total:+Number(amount*mult).toFixed(3)}),done=!0}}),done||$scope.summary.push({id:id,caption:caption,measures:[{id:measure.id,caption:measure.caption,amount:amount,total:+Number(amount*mult).toFixed(3)}]})},$scope.save=function(isValid){function successCallback(res){$location.path("menu/"+$scope.menu.number+"/weekplan")}function errorCallback(res){$scope.error=res.data.message}return isValid?void $scope.menu.createOrUpdate().then(successCallback)["catch"](errorCallback):($scope.$broadcast("show-errors-check-validity","menuForm"),!1)}}function MenuWeekplanController($scope,$stateParams,$location,$window,Authentication,MenuService,MealService){$scope.authentication=Authentication,$scope.error=null,$scope.weekDays=[],$scope.weekDayExamples=[new Date("2016-08-15"),new Date("2016-08-16"),new Date("2016-08-17"),new Date("2016-08-18"),new Date("2016-08-19"),new Date("2016-08-20"),new Date("2016-08-21")],$scope.find=function(){MenuService.query().$promise.then(function(menus){$scope.menus=menus})},$scope.findOne=function(){$stateParams.menuId&&MenuService.get({menuId:$stateParams.menuId}).$promise.then(function(menu){$scope.meals=menu.meals,$scope.menu=menu,$scope.menuInitByDays(),$scope.menu.startDate=new Date(menu.startDate)})},$scope.menuInitByDays=function(){$scope.unassigned=[],$scope.weekDays=[],$scope.weekDayExamples.forEach(function(weekDay,i,arr){$scope.weekDays.push({index:i,caption:weekDay}),$scope.weekDays[i].types=[],$scope.menu.types.forEach(function(type,j,arr){$scope.weekDays[i].types.push({index:j,caption:type.caption,serve:type.serve}),$scope.weekDays[i].types[j].meals=[],$scope.meals.forEach(function(meal,k,arr){meal.weekday===i&&meal.type===$scope.weekDays[i].types[j].index&&(meal=new MealService(meal),meal.getRecipe().then(function(recipe){meal.recipe=recipe,$scope.weekDays[i].types[j].meals.push(meal)}))})})}),$scope.meals.forEach(function(meal,k,arr){(meal.weekday===-1||meal.type===-1||meal.type>=$scope.menu.types.length)&&(meal=new MealService(meal),meal.getRecipe().then(function(recipe){meal.recipe=recipe,$scope.unassigned.push(meal)}))})},$scope.save=function(isValid){function successCallback(res){$location.path("menu/"+$scope.menu.number)}function errorCallback(res){$scope.error=res.data.message}return isValid?($scope.meals=[],$scope.weekDays.forEach(function(weekDay,i,arr){$scope.menu.types.forEach(function(type,j,arr){$scope.weekDays[i].types[j].meals.forEach(function(meal,k,arr){meal.type=type.index,meal.weekday=weekDay.index,$scope.meals.push(meal)})})}),$scope.unassigned.forEach(function(meal,i,arr){meal.weekday=-1,$scope.meals.push(meal)}),$scope.menu.meals=$scope.meals,void $scope.menu.createOrUpdate().then(successCallback)["catch"](errorCallback)):($scope.$broadcast("show-errors-check-validity","menuForm"),!1)}}function ProductsController($scope,$stateParams,$location,$window,$timeout,Authentication,Products,FileUploader){$scope.authentication=Authentication,$scope.find=function(){$scope.products=Products.query()},$scope.findOne=function(){$scope.product=Products.get({productId:$stateParams.productId})},$scope.getMeasuresList=function(){},$scope.create=function(isValid){if($scope.error=null,!isValid)return $scope.$broadcast("show-errors-check-validity","productForm"),!1;var product=new Products({caption:this.caption,infoCard:this.infoCard,image:$scope.imageURL,measureId:$scope.measureId});product.$save(function(response){$location.path("products/"+response.id),$scope.caption="",$scope.infoCard=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.update=function(isValid){if($scope.error=null,!isValid)return $scope.$broadcast("show-errors-check-validity","productForm"),!1;var product=$scope.product;product.image=$scope.imageURL,product.$update(function(){$location.path("products/"+product.id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(ingridient){ingridient?(ingridient.$remove(),$location.path("ingridients")):$scope.ingridient.$remove(function(){$location.path("ingridient")})};var uploader=$scope.uploader=new FileUploader({url:"/api/pictures/products"});uploader.filters.push({name:"imageFilter",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(type)!==-1}}),$scope.uploader.onAfterAddingFile=function(fileItem){if($window.FileReader){var fileReader=new FileReader;fileReader.readAsDataURL(fileItem._file),fileReader.onload=function(fileReaderEvent){$timeout(function(){$scope.imageURL=fileReaderEvent.target.result},0)}}}}function RecipesController($scope,$stateParams,$location,$window,$timeout,Authentication,RecipeService,IngredientService,FileUploader){$scope.authentication=Authentication,$scope.ingredientList=[],$scope.shelves=!1,$scope.find=function(){RecipeService.query().$promise.then(function(recipes){$scope.recipes=recipes})},$scope.findOne=function(){$stateParams.recipeId?RecipeService.get({recipeId:$stateParams.recipeId}).$promise.then(function(recipe){if($scope.recipe=recipe,recipe.ingredients.length>0){var ingredients=recipe.ingredients;recipe.ingredients=[],ingredients.forEach(function(item,i,arr){$scope.getIngredients(item.caption).then(function(match){if(match.length>0){var measureDefault=match[0].measureDefault;match[0].measureDefault=item.ingredientAmount.measureId,match[0].amount=item.ingredientAmount.amount,match[0].comment=item.ingredientAmount.comment,$scope.addIngredient(match[0]),$scope.recipe.ingredients[i].measureDefault=measureDefault}})})}}):$scope.recipe=new RecipeService({portions:2,ingredients:[],steps:[]})},$scope.getIngredients=function(value){var matched=[];return 0===$scope.ingredientList.length?IngredientService.query().$promise.then(function(results){return $scope.ingredientList=results,results.forEach(function(item,i,arr){item.caption.includes(value)&&matched.push(item)}),matched}):($scope.ingredientList.forEach(function(item,i,arr){item.caption.includes(value)&&matched.push(item)}),matched)},$scope.addIngredient=function(ingredient){var newIngredient=new IngredientService(ingredient);ingredient.measure?(newIngredient.measure=ingredient.measure,newIngredient.amount=ingredient.amount):ingredient.getMeasure().then(function(measure){newIngredient.measure=measure,ingredient.amount||(newIngredient.amount=newIngredient.measure.min)}),newIngredient.index=$scope.recipe.ingredients.length,newIngredient.getShelf().then(function(shelf){shelf.id&&(console.log(shelf),newIngredient.shelf=shelf)}),$scope.recipe.ingredients.push(newIngredient),$scope.asyncSelectedAdd=""},$scope.removeIngredient=function(index){$scope.recipe.ingredients.splice(index,1)},$scope.addStep=function(){$scope.recipe.steps.push({action:""})},$scope.removeStep=function(index){$scope.recipe.steps.splice(index,1)},$scope.selectMain=function(ingredient){$scope.recipe.mainIngredient=ingredient,$scope.asyncSelectedMain=""},$scope.unsetPicture=function(){$scope.recipe.image="",$scope.uploader.clearQueue()},$scope.save=function(isValid){function successCallback(res){$location.path("recipes/"+$scope.recipe.id)}function errorCallback(res){$scope.error=res.data.message}return isValid?($scope.recipe.ingredients.forEach(function(item,i,arr){item.index=i}),void $scope.recipe.createOrUpdate().then(successCallback)["catch"](errorCallback)):($scope.$broadcast("show-errors-check-validity","recipeForm"),!1)};var uploader=$scope.uploader=new FileUploader({url:"/api/pictures/ingredients"});$scope.imageurl="http://res.cloudinary.com/thomascookbook/image/upload/v1466671927/",uploader.filters.push({name:"imageFilter",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(type)!==-1}},{name:"overWriteFilter",fn:function(item,options){return 1===this.queue.length&&this.clearQueue(),!0}}),$scope.uploader.onAfterAddingFile=function(fileItem){if($window.FileReader){var fileReader=new FileReader;fileReader.readAsDataURL(fileItem._file),fileReader.onload=function(fileReaderEvent){$timeout(function(){$scope.imageURL=fileReaderEvent.target.result},0)}}}}function ShelfController($scope,$stateParams,$location,$window,Authentication,ShelfService,ShelfQueryService,IngredientService,MeasureService){const pbLimitDeficit=20,pbLimitDesired=50,pbLimitMax=80;$scope.authentication=Authentication,$scope.error=null,$scope.ingredientList=[],$scope.legend=!1,$scope.selectedIngridient="",$scope.imageurl="http://res.cloudinary.com/thomascookbook/image/upload/v1466671927/",$scope.find=function(){ShelfService.query().$promise.then(function(shelves){$scope.shelves=shelves})},$scope.findOne=function(){$stateParams.shelfId?ShelfService.get({shelfId:$stateParams.shelfId}).$promise.then(function(shelf){$scope.shelf=shelf,shelf.ingredientId&&$scope.loadIngredient(shelf.ingredientId).then(function(ingredient){$scope.setIngredient(ingredient)})}):($scope.shelf=new ShelfService({stored:15,desired:25,max:30,deficit:10}),$stateParams.ingredient&&$scope.setIngredient($stateParams.ingredient))},$scope.getIngredients=function(value){var matched=[];return 0===$scope.ingredientList.length?IngredientService.query().$promise.then(function(results){$scope.ingredientList=results,results.forEach(function(item,i,arr){item.caption.includes(value)&&matched.push(item)})}):$scope.ingredientList.forEach(function(item,i,arr){item.caption.includes(value)&&matched.push(item)}),matched},$scope.loadIngredient=function(id){return IngredientService.get({ingredientId:id}).$promise},$scope.setIngredient=function(ingredient){return ingredient?($scope.ingredient=ingredient,$scope.shelf.ingredientId=ingredient.id,ingredient.getMeasure().then(function(measure){$scope.measure=measure}),void($scope.asyncSelected="")):($scope.shelf.ingridientId=null,void($scope.ingredient=null))},$scope.filterBar={spoiled:!0,deficit:!0,lsdesired:!0,desired:!0,max:!0},$scope.filterBarToggle=function(){$scope.filterBar.deficit&&$scope.filterBar.lsdesired&&$scope.filterBar.desired&&$scope.filterBar.max?$scope.filterBar={deficit:!1,lsdesired:!1,desired:!1,max:!1}:$scope.filterBar={deficit:!0,lsdesired:!0,desired:!0,max:!0}},$scope.filterByProgress=function(index){var item=$scope.shelves[index];return!item.progressbar||($scope.filterBar.spoiled&&item.isSpoiled||$scope.filterBar.deficit&&item.progressbar.value<=pbLimitDeficit||$scope.filterBar.lsdesired&&item.progressbar.value>pbLimitDeficit&&item.progressbar.value<pbLimitDesired||$scope.filterBar.desired&&item.progressbar.value>=pbLimitDesired&&item.progressbar.value<=pbLimitMax||$scope.filterBar.max&&item.progressbar.value>pbLimitMax&&item.progressbar.value<=100)},$scope.clearSpoiled=function(){},$scope.validateDeficit=function(id,value,oldValue){return $scope.form={deficit:!1,desired:!1,max:!1},!(value<$scope.measure.min||$scope.shelf.desired<=value)||($scope.form.deficit=!0,
!1)},$scope.validateDesired=function(id,value,oldValue){return $scope.form={deficit:!1,desired:!1,max:!1},!(value<=$scope.shelf.deficit||$scope.shelf.max<=value)||($scope.form.desired=!0,!1)},$scope.validateMax=function(id,value,oldValue){return $scope.form={deficit:!1,desired:!1,max:!1},!(value<=$scope.shelf.desired)||($scope.form.max=!0,!1)},$scope.remove=function(){$window.confirm("Are you sure you want to delete?")&&($scope.shelf.$remove(),$location.path("shelf"))},$scope.save=function(isValid){function successCallback(res){$location.path("shelf/"+$scope.shelf.number)}function errorCallback(res){$scope.error=res.data.message}return isValid?($scope.shelf.caption=$scope.ingredient.caption,$scope.shelf.measureCaption=$scope.measure.caption,void $scope.shelf.createOrUpdate().then(successCallback)["catch"](errorCallback)):($scope.$broadcast("show-errors-check-validity","shelfForm"),!1)}}function ShelfQueryController($scope,$stateParams,$location,$window,Authentication,ShelfQueryService,MeasureService){$scope.authentication=Authentication,$scope.error=null,$scope.info={},$scope.form={},$scope.imageurl="http://res.cloudinary.com/thomascookbook/image/upload/v1466671927/",$scope.find=function(){ShelfQueryService.query().$promise.then(function(shelfQueries){$scope.shelfQueries=shelfQueries})},$scope.findOne=function(){$stateParams.shelfId&&$stateParams.queryId&&ShelfQueryService.get({shelfId:$stateParams.shelfId,queryId:$stateParams.queryId}).$promise.then(function(shelfQuery){MeasureService.get({measureId:shelfQuery.measureId}).$promise.then(function(measure){$scope.measure=measure}),$scope.shelfQuery=shelfQuery})},$scope.remove=function(){$window.confirm("Are you sure you want to delete?")&&($scope.shelfQuery.$remove(),$location.path("shelfQuery"))},$scope.save=function(isValid){function successCallback(res){$location.path("shelf/"+$scope.shelfQuery.shelfId+"/query")}function errorCallback(res){$scope.error=res.data.message}return isValid?void $scope.shelfQuery.createOrUpdate().then(successCallback)["catch"](errorCallback):($scope.$broadcast("show-errors-check-validity","shelfQueryForm"),!1)}}function IngredientService($resource,ShelfService,MeasureService){function createOrUpdate(ingredient){return ingredient.id?ingredient.$update(onSuccess,onError):ingredient.$save(onSuccess,onError)}function getShelf(ingredient){return ShelfService.get({ingredientId:ingredient.id}).$promise}function getMeasure(ingredient){return MeasureService.get({measureId:ingredient.measureDefault}).$promise}function onSuccess(ingredient){}function onError(errorResponse){var error=errorResponse.data;handleError(error)}function handleError(error){console.log(error)}var Ingredient=$resource("api/ingredients/:ingredientId",{ingredientId:"@id"},{update:{method:"PUT"}});return angular.extend(Ingredient.prototype,{createOrUpdate:function(){var ingredient=this;return createOrUpdate(ingredient)},getShelf:function(){var ingredient=this;return getShelf(ingredient)},getMeasure:function(){var ingredient=this;return getMeasure(ingredient)}}),Ingredient}function MealService($resource,RecipeService){function createOrUpdate(meal){return meal.id?meal.$update(onSuccess,onError):meal.$save(onSuccess,onError)}function getRecipe(meal){return RecipeService.get({recipeId:meal.recipeId}).$promise}function onSuccess(menu){}function onError(errorResponse){var error=errorResponse.data;handleError(error)}function handleError(error){console.log(error)}var Meal=$resource("api/meal/:mealId",{mealId:"@number"},{update:{method:"PUT"}});return angular.extend(Meal.prototype,{createOrUpdate:function(){var meal=this;return createOrUpdate(meal)},getRecipe:function(){var meal=this;return getRecipe(meal)}}),Meal}function MeasureService($resource){function createOrUpdate(measure){return measure.id?measure.$update(onSuccess,onError):measure.$save(onSuccess,onError)}function applyValue(measure,value,toFixed){if(!(measure.step<=0)){var result=value||0,precision=toFixed||3;return value%measure.step>0&&(result=Number((value-value%measure.step+measure.step).toFixed(precision))),result<measure.min&&(result=measure.min),result}}function onSuccess(measure){}function onError(errorResponse){var error=errorResponse.data;handleError(error)}function handleError(error){console.log(error)}var Measure=$resource("api/measures/:measureId",{measureId:"@id"},{update:{method:"PUT"}});return angular.extend(Measure.prototype,{createOrUpdate:function(){var measure=this;return createOrUpdate(measure)},applyValue:function(value,precision){var measure=this;return applyValue(measure,value,precision)}}),Measure}function MenuService($resource){function createOrUpdate(menu){return menu.id?menu.$update(onSuccess,onError):menu.$save(onSuccess,onError)}function onSuccess(menu){}function onError(errorResponse){var error=errorResponse.data;handleError(error)}function handleError(error){console.log(error)}var Menu=$resource("api/menu/:menuId",{menuId:"@number"},{update:{method:"PUT"}});return angular.extend(Menu.prototype,{createOrUpdate:function(){var menu=this;return createOrUpdate(menu)}}),Menu}function RecipeService($resource){function createOrUpdate(recipe){return recipe.id?recipe.$update(onSuccess,onError):recipe.$save(onSuccess,onError)}function onSuccess(recipe){}function onError(errorResponse){var error=errorResponse.data;handleError(error)}function handleError(error){console.log(error)}var Recipe=$resource("api/recipes/:recipeId",{recipeId:"@id"},{update:{method:"PUT"}});return angular.extend(Recipe.prototype,{createOrUpdate:function(){var recipe=this;return createOrUpdate(recipe)}}),Recipe}function ShelfService($resource){function createOrUpdate(shelf){return shelf.id?shelf.$update(onSuccess,onError):shelf.$save(onSuccess,onError)}function onSuccess(shelf){}function onError(errorResponse){var error=errorResponse.data;handleError(error)}function handleError(error){console.log(error)}var Shelf=$resource("api/shelf/:shelfId",{shelfId:"@id"},{update:{method:"PUT"}});return angular.extend(Shelf.prototype,{createOrUpdate:function(){var shelf=this;return createOrUpdate(shelf)}}),Shelf}function ShelfQueryService($resource){function createOrUpdate(shelfQuery){return shelfQuery.id?shelfQuery.$update(onSuccess,onError):shelfQuery.$save(onSuccess,onError)}function onSuccess(shelfQuery){}function onError(errorResponse){var error=errorResponse.data;handleError(error)}function handleError(error){console.log(error)}var ShelfQuery=$resource("api/shelf/:shelfId/query/:queryId",{shelfId:"@shelfId",queryId:"@number"},{update:{method:"PUT"}});return angular.extend(ShelfQuery.prototype,{createOrUpdate:function(){var shelfQuery=this;return createOrUpdate(shelfQuery)}}),ShelfQuery}var ApplicationConfiguration=function(){var applicationModuleName="seanjs",applicationModuleVendorDependencies=["ngResource","ngAnimate","ngMessages","ui.router","ui.bootstrap","ui.utils","angularFileUpload"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider","$httpProvider",function($locationProvider,$httpProvider){$locationProvider.html5Mode(!0).hashPrefix("!"),$httpProvider.interceptors.push("authInterceptor")}]),angular.module(ApplicationConfiguration.applicationModuleName).run(["$rootScope","$state","Authentication",function($rootScope,$state,Authentication){$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){if(toState.data&&toState.data.roles&&toState.data.roles.length>0){var allowed=!1;Authentication.user.roles&&toState.data.roles.forEach(function(role){if(void 0!==Authentication.user.roles&&Authentication.user.roles.indexOf(role)!==-1)return allowed=!0,!0}),allowed||(event.preventDefault(),void 0!==Authentication.user&&"object"==typeof Authentication.user?$state.go("forbidden"):$state.go("authentication.signin"))}}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){fromState.data&&fromState.data.ignoreState||($state.previous={state:fromState,params:fromParams,href:$state.href(fromState,fromParams)})})}]),angular.element(document).ready(function(){if(window.location.hash&&"#_=_"===window.location.hash)if(window.history&&history.pushState)window.history.pushState("",document.title,window.location.pathname);else{var scroll={top:document.body.scrollTop,left:document.body.scrollLeft};window.location.hash="",document.body.scrollTop=scroll.top,document.body.scrollLeft=scroll.left}angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("articles"),ApplicationConfiguration.registerModule("chat"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("core.admin",["core"]),ApplicationConfiguration.registerModule("core.admin.routes",["ui.router"]),ApplicationConfiguration.registerModule("recipes",[]),ApplicationConfiguration.registerModule("user",["core"]),ApplicationConfiguration.registerModule("user.admin",["core.admin"]),ApplicationConfiguration.registerModule("user.admin.routes",["core.admin.routes"]),angular.module("articles").run(["Menus",function(Menus){}]),angular.module("articles").config(["$stateProvider",function($stateProvider){$stateProvider.state("articles",{"abstract":!0,url:"/articles",template:"<ui-view/>"}).state("articles.list",{url:"",templateUrl:"modules/articles/client/views/list-articles.client.view.html"}).state("articles.create",{url:"/create",templateUrl:"modules/articles/client/views/create-article.client.view.html",data:{roles:["user","admin"]}}).state("articles.view",{url:"/:articleId",templateUrl:"modules/articles/client/views/view-article.client.view.html"}).state("articles.edit",{url:"/:articleId/edit",templateUrl:"modules/articles/client/views/edit-article.client.view.html",data:{roles:["user","admin"]}})}]),angular.module("articles").controller("ArticlesController",["$scope","$stateParams","$location","Authentication","Articles",function($scope,$stateParams,$location,Authentication,Articles){$scope.authentication=Authentication,$scope.create=function(isValid){if($scope.error=null,!isValid)return $scope.$broadcast("show-errors-check-validity","articleForm"),!1;var article=new Articles({title:this.title,content:this.content});article.$save(function(response){$location.path("articles/"+response.id),$scope.title="",$scope.content=""},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.remove=function(article){article?(article.$remove(),$location.path("articles")):$scope.article.$remove(function(){$location.path("articles")})},$scope.update=function(isValid){if($scope.error=null,!isValid)return $scope.$broadcast("show-errors-check-validity","articleForm"),!1;var article=$scope.article;article.$update(function(){$location.path("articles/"+article.id)},function(errorResponse){$scope.error=errorResponse.data.message})},$scope.find=function(){$scope.articles=Articles.query()},$scope.findOne=function(){$scope.article=Articles.get({articleId:$stateParams.articleId})}}]),angular.module("articles").factory("Articles",["$resource",function($resource){return $resource("api/articles/:articleId",{articleId:"@id"},{update:{method:"PUT"}})}]),angular.module("chat").run(["Menus",function(Menus){}]),angular.module("chat").config(["$stateProvider",function($stateProvider){$stateProvider.state("chat",{url:"/chat",templateUrl:"modules/chat/client/views/chat.client.view.html",data:{roles:["user","admin"]}})}]),angular.module("chat").controller("ChatController",["$scope","$location","Authentication","Socket",function($scope,$location,Authentication,Socket){$scope.messages=[],Authentication.user||$location.path("/"),Socket.socket||Socket.connect(),Socket.on("chatMessage",function(message){$scope.messages.unshift(message)}),$scope.sendMessage=function(){var message={text:this.messageText};Socket.emit("chatMessage",message),this.messageText=""},$scope.$on("$destroy",function(){Socket.removeListener("chatMessage")}),Socket.on("currentClients",function(count){$scope.currentClients=count})}]),angular.module("core.admin").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Admin",state:"admin",type:"dropdown",roles:["admin"]})}]),angular.module("core.admin.routes").config(["$stateProvider",function($stateProvider){$stateProvider.state("admin",{"abstract":!0,url:"/admin",template:"<ui-view/>",data:{roles:["admin"]}})}]),angular.module("core").run(["Menus",function(Menus){}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise(function($injector,$location){$injector.get("$state").transitionTo("not-found",null,{location:!1})}),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/client/views/home.client.view.html"}).state("contact-us",{url:"/contact-us",templateUrl:"modules/core/client/views/contact.client.view.html"}).state("not-found",{url:"/not-found",templateUrl:"modules/core/client/views/404.client.view.html",data:{ignoreState:!0}}).state("bad-request",{url:"/bad-request",templateUrl:"modules/core/client/views/400.client.view.html",data:{ignoreState:!0}}).state("forbidden",{url:"/forbidden",templateUrl:"modules/core/client/views/403.client.view.html",data:{ignoreState:!0}})}]),angular.module("core").controller("ContactController",["$scope","ContactForm",function($scope,ContactForm){$scope.contact=function(isValid){if($scope.error=null,$scope.success=null,!isValid)return $scope.$broadcast("show-errors-check-validity","contactForm"),!1;if(""===grecaptcha.getResponse())$scope.error="Please resolve the captcha first!";else{var contactForm=new ContactForm({name:this.name,email:this.email,subject:this.subject,message:this.message,grecaptcha:grecaptcha.getResponse()});$scope.submitButton="Working...",$scope.submitButtonDisabled=!0,contactForm.$save(function(response){grecaptcha.reset(),$scope.success=response.message},function(errorResponse){console.log("errorResponse",errorResponse),grecaptcha.reset(),$scope.error=errorResponse.data.message}),$scope.submitButton="Send",$scope.submitButtonDisabled=!1}}}]),angular.module("core").controller("HeaderController",["$rootScope","$scope","$location","$state","Authentication","Menus",function($rootScope,$scope,$location,$state,Authentication,Menus){$scope.$state=$state,$scope.authentication=Authentication,$scope.menu=Menus.getMenu("topbar"),$scope.isCollapsed=!1,$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed},$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1,ga("send","pageview",$location.path())})}]),angular.module("core").controller("HomeController",["$scope","Authentication",function($scope,Authentication){$scope.authentication=Authentication}]),angular.module("core").directive("showErrors",["$timeout","$interpolate",function($timeout,$interpolate){var linkFn=function(scope,el,attrs,formCtrl){var inputEl,inputName,inputNgEl,options,showSuccess,toggleClasses,initCheck=!1,showValidationMessages=!1;if(options=scope.$eval(attrs.showErrors)||{},showSuccess=options.showSuccess||!1,inputEl=el[0].querySelector(".form-control[name]")||el[0].querySelector("[name]"),inputNgEl=angular.element(inputEl),inputName=$interpolate(inputNgEl.attr("name")||"")(scope),!inputName)throw"show-errors element has no child input elements with a 'name' attribute class";var reset=function(){return $timeout(function(){el.removeClass("has-error"),el.removeClass("has-success"),showValidationMessages=!1},0,!1)};scope.$watch(function(){return formCtrl[inputName]&&formCtrl[inputName].$invalid},function(invalid){return toggleClasses(invalid)}),scope.$on("show-errors-check-validity",function(event,name){if(angular.isUndefined(name)||formCtrl.$name===name)return initCheck=!0,showValidationMessages=!0,toggleClasses(formCtrl[inputName].$invalid)}),scope.$on("show-errors-reset",function(event,name){if(angular.isUndefined(name)||formCtrl.$name===name)return reset()}),toggleClasses=function(invalid){if(el.toggleClass("has-error",showValidationMessages&&invalid),showSuccess)return el.toggleClass("has-success",showValidationMessages&&!invalid)}};return{restrict:"A",require:"^form",compile:function(elem,attrs){if(attrs.showErrors.indexOf("skipFormGroupCheck")===-1&&!elem.hasClass("form-group")&&!elem.hasClass("input-group"))throw"show-errors element does not have the 'form-group' or 'input-group' class";return linkFn}}}]),angular.module("core").factory("ContactForm",["$resource",function($resource){return $resource("api/contact",{},{update:{method:"POST"}})}]),angular.module("core").factory("authInterceptor",["$q","$injector",function($q,$injector){return{responseError:function(rejection){if(!rejection.config.ignoreAuthModule)switch(rejection.status){case 401:$injector.get("$state").transitionTo("authentication.signin");break;case 403:$injector.get("$state").transitionTo("forbidden");break;case 404:$injector.get("$state").transitionTo("not-found")}return $q.reject(rejection)}}}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["user","admin"],this.menus={};var shouldRender=function(user){if(~this.roles.indexOf("*"))return!0;if(!user)return!1;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exist")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,options){return options=options||{},this.menus[menuId]={roles:options.roles||this.defaultRoles,items:options.items||[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,options){if(options=options||{},this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:options.title||"",state:options.state||"",type:options.type||"item","class":options["class"],roles:null===options.roles||"undefined"==typeof options.roles?this.defaultRoles:options.roles,position:options.position||0,items:[],shouldRender:shouldRender}),options.items)for(var i in options.items)this.addSubMenuItem(menuId,options.state,options.items[i]);return this.menus[menuId]},this.addSubMenuItem=function(menuId,parentItemState,options){options=options||{},this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].state===parentItemState&&this.menus[menuId].items[itemIndex].items.push({title:options.title||"",state:options.state||"",roles:null===options.roles||"undefined"==typeof options.roles?this.menus[menuId].items[itemIndex].roles:options.roles,position:options.position||0,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemState){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].state===menuItemState&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemState){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].state===submenuItemState&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar",{roles:["*"]})}]),angular.module("core").service("Socket",["Authentication","$state","$timeout",function(Authentication,$state,$timeout){this.connect=function(){Authentication.user&&(this.socket=io())},this.connect(),this.on=function(eventName,callback){this.socket&&this.socket.on(eventName,function(data){$timeout(function(){callback(data)})})},this.emit=function(eventName,data){this.socket&&this.socket.emit(eventName,data)},this.removeListener=function(eventName){this.socket&&this.socket.removeListener(eventName)}}]),angular.module("recipes").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Книга рецептов",state:"recipes.list",type:"button",roles:["*"]}),Menus.addMenuItem("topbar",{title:"Ингредиенты",state:"ingredients",type:"dropdown",roles:["user"]}),Menus.addSubMenuItem("topbar","ingredients",{title:"Справочник",state:"ingredients.list",roles:["user"]}),Menus.addSubMenuItem("topbar","ingredients",{title:"Добавить ингредиент",state:"ingredients.create",roles:["user"]}),Menus.addMenuItem("topbar",{title:"Хранилище",state:"shelf",type:"dropdown",roles:["user"]}),Menus.addSubMenuItem("topbar","shelf",{title:"Полки",state:"shelf.list",roles:["user"]}),Menus.addMenuItem("topbar",{title:"Меню",state:"menu",type:"dropdown",roles:["user"]}),Menus.addSubMenuItem("topbar","menu",{title:"(В разработке) Текущее меню",state:"menu.list",roles:["user"]}),Menus.addSubMenuItem("topbar","admin",{title:"Manage Measures",state:"measures.list",roles:["admin"]}),Menus.addSubMenuItem("topbar","admin",{title:"Manage Products",state:"products.list",roles:["admin"]})}]),angular.module("recipes").config(routeConfig),routeConfig.$inject=["$stateProvider"],angular.module("recipes").controller("IngredientsController",IngredientsController),IngredientsController.$inject=["$scope","$stateParams","$location","$window","$timeout","Authentication","IngredientService","MeasureService","FileUploader"],angular.module("recipes").controller("IngridientsController",IngridientsController),IngridientsController.$inject=["$scope","$stateParams","$location","$window","$timeout","Authentication","Recipes","Ingridients","Measures","FileUploader"],angular.module("recipes").controller("MeasuresController",MeasuresController),MeasuresController.$inject=["$scope","$stateParams","$location","Authentication","MeasureService"],angular.module("recipes").controller("MenusController",MenusController),MenusController.$inject=["$scope","$stateParams","$location","$window","Authentication","MenuService","ShelfQueryService","Recipes","Measures"],angular.module("recipes").controller("MenuInitController",MenuInitController),MenuInitController.$inject=["$scope","$stateParams","$location","$window","Authentication","MenuService"],angular.module("recipes").controller("MenuMealsController",MenuMealsController),MenuMealsController.$inject=["$scope","$stateParams","$location","$window","Authentication","MenuService","RecipeService","MealService"],angular.module("recipes").controller("MenuSummaryController",MenuSummaryController),MenuSummaryController.$inject=["$scope","$stateParams","$location","$window","Authentication","MenuService","IngredientService","MealService"],angular.module("recipes").controller("MenuWeekplanController",MenuWeekplanController),MenuWeekplanController.$inject=["$scope","$stateParams","$location","$window","Authentication","MenuService","MealService"],angular.module("recipes").controller("ProductsController",ProductsController),ProductsController.$inject=["$scope","$stateParams","$location","$window","$timeout","Authentication","Products","FileUploader"],angular.module("recipes").controller("RecipesController",RecipesController),RecipesController.$inject=["$scope","$stateParams","$location","$window","$timeout","Authentication","RecipeService","IngredientService","FileUploader"],angular.module("recipes").controller("ShelfController",ShelfController),ShelfController.$inject=["$scope","$stateParams","$location","$window","Authentication","ShelfService","ShelfQueryService","IngredientService","MeasureService"],angular.module("recipes").controller("ShelfQueryController",ShelfQueryController),ShelfQueryController.$inject=["$scope","$stateParams","$location","$window","Authentication","ShelfQueryService","MeasureService"],function(window,angular){function touchFix(e){if(!("clientX"in e||"clientY"in e)){var touches=e.touches||e.originalEvent.touches;touches&&touches.length&&(e.clientX=touches[0].clientX,e.clientY=touches[0].clientY),e.preventDefault()}}function getPreviousSibling(element){if(element=element[0],element.previousElementSibling)return angular.element(element.previousElementSibling);for(var sib=element.previousSibling;null!=sib&&1!=sib.nodeType;)sib=sib.previousSibling;return angular.element(sib)}function insertElementBefore(element,newElement){var prevSibl=getPreviousSibling(element);prevSibl.length>0?prevSibl.after(newElement):element.parent().prepend(newElement)}function elementMatchesSelector(element,selector){if(element instanceof angular.element&&(element=element[0]),null!==matchingFunction)return element[matchingFunction](selector)}var module=angular.module("recipes");module.directive("svRoot",[function(){function shouldBeAfter(elem,pointer,isGrid){return isGrid?elem.x-pointer.x<0:elem.y-pointer.y<0}function getSortableElements(key){return ROOTS_MAP[key]}function removeSortableElements(key){delete ROOTS_MAP[key]}var sortingInProgress,ROOTS_MAP=Object.create(null);return{restrict:"A",controller:["$scope","$attrs","$interpolate","$parse",function($scope,$attrs,$interpolate,$parse){this.MULTI_SELECT_LIST=[],this.multiSelectRaise=function(){for(var i=0;i<this.MULTI_SELECT_LIST.length;i++)this.MULTI_SELECT_LIST[i].element.addClass("sv-long-pressing")},this.isMultiSelecting=function(){return this.MULTI_SELECT_LIST.length>1},this.clearMultiSelect=function(html){for(var i=0;i<this.MULTI_SELECT_LIST.length;i++)this.MULTI_SELECT_LIST[i].$multiSelected=!1,this.MULTI_SELECT_LIST[i].element.removeClass("sv-element-multi-selected"),this.MULTI_SELECT_LIST[i].element.removeClass("sv-long-pressing");html.removeClass("sv-multi-selected"),this.MULTI_SELECT_LIST=[]},this.addToMultiSelect=function(sortableElement,multiScope,attr,html){for(var i=0;i<this.MULTI_SELECT_LIST.length;i++)if(this.MULTI_SELECT_LIST[i]===sortableElement)return!1;return sortableElement.$multiSelected=!0,sortableElement.element.addClass("sv-element-multi-selected"),sortableElement.multiScope=multiScope,sortableElement.attr=attr,html.addClass("sv-multi-selected"),this.MULTI_SELECT_LIST.push(sortableElement),!0},this.removeFromMultiSelect=function(sortableElement,html){sortableElement.$multiSelected=!1,delete sortableElement.multiScope,delete sortableElement.attr,sortableElement.element.removeClass("sv-element-multi-selected");for(var i=0;i<this.MULTI_SELECT_LIST.length;i++)if(this.MULTI_SELECT_LIST[i]===sortableElement){this.MULTI_SELECT_LIST.splice(i,1);break}0===document.querySelectorAll(".sv-element-multi-selected").length&&html.removeClass("sv-multi-selected")},this.getMultimodels=function(){for(var multiModels=[],that=this,i=0;i<that.MULTI_SELECT_LIST.length;i++)multiModels.push($parse(that.MULTI_SELECT_LIST[i].attr)(that.MULTI_SELECT_LIST[i].multiScope));return multiModels};var mapKey=$interpolate($attrs.svRoot)($scope)||$scope.$id;ROOTS_MAP[mapKey]||(ROOTS_MAP[mapKey]=[]);var candidates,$placeholder,options,$helper,$original,$target,html=angular.element(document.documentElement),that=this,isGrid=!1,isDisabled=!1,onSort=$parse($attrs.svOnSort);$scope.$watch($parse($attrs.svDisabled),function(newVal,oldVal){isDisabled=newVal}),$attrs.svOnStart=$attrs.$$element[0].attributes["sv-on-start"],$attrs.svOnStart=$attrs.svOnStart&&$attrs.svOnStart.value,$attrs.svOnStop=$attrs.$$element[0].attributes["sv-on-stop"],$attrs.svOnStop=$attrs.svOnStop&&$attrs.svOnStop.value;var onStart=$parse($attrs.svOnStart),onStop=$parse($attrs.svOnStop);if(this.mapKey=mapKey,this.sortingInProgress=function(){return sortingInProgress},this.sortingDisabled=function(){return isDisabled},$attrs.svGrid){if(isGrid="true"===$attrs.svGrid||"false"!==$attrs.svGrid&&null,null===isGrid)throw"Invalid value of sv-grid attribute"}else $scope.$watchCollection(function(){return getSortableElements(mapKey)},function(collection){isGrid=!1;var array=collection.filter(function(item){return!item.container}).map(function(item){return{part:item.getPart().id,y:item.element[0].getBoundingClientRect().top}}),dict=Object.create(null);array.forEach(function(item){dict[item.part]?dict[item.part].push(item.y):dict[item.part]=[item.y]}),Object.keys(dict).forEach(function(key){dict[key].sort(),dict[key].forEach(function(item,index){index<dict[key].length-1&&item>0&&item===dict[key][index+1]&&(isGrid=!0)})})});var stop=!1,scroll=function(step,delay){var el=document.querySelector(".main-ui-view");console.log("scrolling top",el.scrollTop),el.scrollTop+=step,stop||setTimeout(function(){scroll(step)},delay)};this.$moveUpdate=function(opts,mouse,svElement,svOriginal,svPlaceholder,originatingPart,originatingIndex){var svRect=svElement[0].getBoundingClientRect();"element"===opts.tolerance&&(mouse={x:~~(svRect.left+svRect.width/2),y:~~(svRect.top+svRect.height/2)}),sortingInProgress=!0,candidates=[],$placeholder||(svPlaceholder?($placeholder=svPlaceholder.clone(),$placeholder.removeClass("ng-hide")):($placeholder=svOriginal.clone(),$placeholder.addClass("sv-visibility-hidden"),$placeholder.addClass("sv-placeholder"),$placeholder.css({height:svRect.height+"px",width:svRect.width+"px"})),svOriginal.after($placeholder),that.keepInList||svOriginal.addClass("ng-hide"),$original=svOriginal,options=opts,$helper=svElement,onStart($scope,{$helper:{element:$helper},$part:originatingPart.model(originatingPart.scope),$index:originatingIndex,$item:originatingPart.model(originatingPart.scope)[originatingIndex]}),$scope.$root&&$scope.$root.$$phase||$scope.$apply());var reposX=mouse.x+document.body.scrollLeft-mouse.offset.x*svRect.width,reposY=mouse.y+document.body.scrollTop-mouse.offset.y*svRect.height;$helper[0].style.position="fixed",$helper[0].reposition({x:reposX,y:reposY}),reposY<=30?(stop=!1,scroll(-50,200)):reposY>=document.body.clientHeight-60?(stop=!1,scroll(50,200)):stop=!0,getSortableElements(mapKey).forEach(function(se,index){if(null==opts.containment||elementMatchesSelector(se.element,opts.containment)||elementMatchesSelector(se.element,opts.containment+" *")){var rect=se.element[0].getBoundingClientRect(),center={x:~~(rect.left+rect.width/2),y:~~(rect.top+rect.height/2)};se.container||!se.element[0].scrollHeight&&!se.element[0].scrollWidth||candidates.push({element:se.element,q:(center.x-mouse.x)*(center.x-mouse.x)+(center.y-mouse.y)*(center.y-mouse.y),view:se.getPart(),targetIndex:se.getIndex(),after:shouldBeAfter(center,mouse,isGrid)}),se.container&&!se.element[0].querySelector("[sv-element]:not(.sv-placeholder):not(.sv-source)")&&candidates.push({element:se.element,q:(center.x-mouse.x)*(center.x-mouse.x)+(center.y-mouse.y)*(center.y-mouse.y),view:se.getPart(),targetIndex:0,container:!0})}});var pRect=$placeholder[0].getBoundingClientRect(),pCenter={x:~~(pRect.left+pRect.width/2),y:~~(pRect.top+pRect.height/2)};candidates.push({q:(pCenter.x-mouse.x)*(pCenter.x-mouse.x)+(pCenter.y-mouse.y)*(pCenter.y-mouse.y),element:$placeholder,placeholder:!0}),candidates.sort(function(a,b){return a.q-b.q}),candidates.forEach(function(cand,index){0!==index||cand.placeholder||cand.container?0===index&&cand.container?($target=cand,cand.element.append($placeholder)):cand.element.removeClass("sv-candidate"):($target=cand,cand.element.addClass("sv-candidate"),cand.after?cand.element.after($placeholder):insertElementBefore(cand.element,$placeholder))})},this.$drop=function(originatingPart,index,options){function afterRevert(){sortingInProgress=!1,$placeholder.remove(),$helper.remove(),$original.removeClass("ng-hide"),candidates=void 0,$placeholder=void 0,options=void 0,$helper=void 0,$original=void 0,onStop($scope,{$part:originatingPart.model(originatingPart.scope),
$index:index,$item:originatingPart.model(originatingPart.scope)[index]});var multiModels=that.getMultimodels();if($target){$target.element.removeClass("sv-candidate");var spliced=[originatingPart.model(originatingPart.scope)[index]];that.keepInList||(spliced=originatingPart.model(originatingPart.scope).splice(index,1));var targetIndex=$target.targetIndex;$target.view===originatingPart&&$target.targetIndex>index&&targetIndex--,$target.after&&targetIndex++,0===multiModels.length&&(multiModels=spliced);for(var i=0;i<multiModels.length;i++)$target.view.model($target.view.scope).splice(targetIndex+i,0,multiModels[i]);var sortMethod,destinationScope=$scope,shouldSort=!1;if(index!=targetIndex&&(sortMethod=onSort,shouldSort=!0),$target.view!==originatingPart&&(shouldSort=!0,$target.view.element&&$target.view.element.attr("sv-on-external-sort"))){destinationScope=$target.view.element.scope();var destinationOnSort=$parse($target.view.element.attr("sv-on-external-sort"));destinationOnSort&&(sortMethod=destinationOnSort)}if(sortMethod&&sortMethod(destinationScope,{$partTo:$target.view.model($target.view.scope),$partFrom:originatingPart.model(originatingPart.scope),$items:multiModels,$indexTo:targetIndex,$indexFrom:index}),shouldSort){var $viewEl=$target.view.element;$viewEl.addClass("sv-dropped"),setTimeout(function(){$viewEl.removeClass("sv-dropped"),$viewEl=void 0,that.clearMultiSelect(html)},300)}}$target=void 0,$scope.$root&&$scope.$root.$$phase||$scope.$apply()}if(stop=!0,$placeholder)if(options.revert){var placeholderRect=$placeholder[0].getBoundingClientRect(),helperRect=$helper[0].getBoundingClientRect(),distance=Math.sqrt(Math.pow(helperRect.top-placeholderRect.top,2)+Math.pow(helperRect.left-placeholderRect.left,2)),duration=+options.revert*distance/200;duration=Math.min(duration,+options.revert),["-webkit-","-moz-","-ms-","-o-",""].forEach(function(prefix){"undefined"!=typeof $helper[0].style[prefix+"transition"]&&($helper[0].style[prefix+"transition"]="all "+duration+"ms ease")}),setTimeout(afterRevert,duration),$helper.css({top:placeholderRect.top+document.body.scrollTop+"px",left:placeholderRect.left+document.body.scrollLeft+"px"})}else afterRevert()},this.addToSortableElements=function(se){getSortableElements(mapKey).push(se)},this.removeFromSortableElements=function(se){var elems=getSortableElements(mapKey),index=elems.indexOf(se);index>-1&&(elems.splice(index,1),0===elems.length&&removeSortableElements(mapKey))}}]}}]),module.directive("svPart",["$parse",function($parse){return{restrict:"A",require:"^svRoot",controller:["$scope",function($scope){$scope.$ctrl=this,this.getPart=function(){return $scope.part},this.$drop=function(index,options){$scope.$sortableRoot.$drop($scope.part,index,options)}}],scope:!0,link:function($scope,$element,$attrs,$sortable){var html=angular.element(document.documentElement);if(!$attrs.svPart)throw new Error("no model provided");var model=$parse($attrs.svPart);if(!model.assign)throw new Error("model not assignable");$sortable.keepInList=$parse($attrs.svKeepInList)($scope),$scope.$ctrl.isDropzone=$parse($attrs.svIsDropzone)($scope)!==!1,$scope.$ctrl.multiSelect=$parse($attrs.svMultiSelect)($scope)===!0,$scope.$ctrl.multiSelect&&$element.on("mousedown",function(){$sortable.clearMultiSelect(html)}),$scope.part={id:$scope.$id,element:$element,model:model,scope:$scope},$scope.$sortableRoot=$sortable;var sortablePart={element:$element,getPart:$scope.$ctrl.getPart,container:!0};$scope.$ctrl.isDropzone&&$sortable.addToSortableElements(sortablePart),$scope.$on("$destroy",function(){$sortable.removeFromSortableElements(sortablePart)})}}}]),module.directive("svElement",["$parse","svDragging",function($parse,svDragging){return{restrict:"A",require:["^svPart","^svRoot"],controller:["$scope",function($scope){$scope.$ctrl=this}],link:function($scope,$element,$attrs,$controllers){function resetOnStartEvent(newHandle,event){return newHandle?(handle.off("mousedown touchstart",event),handle=newHandle,void handle.on("mousedown touchstart",event)):void handle.off("mousedown touchstart",event)}function onMousedown(e){function onMousemove(e){return touchFix(e),moveExecuted||(body.prepend(clone),moveExecuted=!0),$controllers[1].$moveUpdate(opts,{x:e.clientX,y:e.clientY,offset:pointerOffset},clone,$element,placeholder,$controllers[0].getPart(),$scope.$index),e.stopPropagation(),e.preventDefault(),!1}if(!(svDragging.isDragging||($controllers[0].multiSelect&&!sortableElement.$multiSelect?($controllers[1].addToMultiSelect(sortableElement,$scope,$attrs.svElement,html),$controllers[1].multiSelectRaise()):$element.addClass("sv-long-pressing"),svDragging.isDragging=!0,touchFix(e),$controllers[1].sortingInProgress()||$controllers[1].sortingDisabled()||0!=e.button&&"mousedown"===e.type))){moveExecuted=!1;var opts=$parse($attrs.svElement)($scope);if(opts=angular.extend({},{tolerance:"pointer",revert:200,containment:"html"},opts),opts.containment)var containmentRect=closestElement.call($element,opts.containment)[0].getBoundingClientRect();var clone,target=$element,clientRect=$element[0].getBoundingClientRect();if(helper||(helper=$controllers[0].helper),placeholder||(placeholder=$controllers[0].placeholder),helper)clone=helper.clone(),clone.removeClass("ng-hide"),clone.css({left:clientRect.left+document.body.scrollLeft+"px",top:clientRect.top+document.body.scrollTop+"px"}),target.addClass("sv-visibility-hidden");else if($controllers[1].isMultiSelecting()){clone=angular.element(document.querySelector("#sv-multi-helper")).clone();$controllers[1].getMultimodels();clone[0].querySelector(".card-title-text").innerHTML=target[0].querySelector(".card-title-text").innerHTML,clone[0].querySelector(".badge").innerHTML=$controllers[1].MULTI_SELECT_LIST.length,clone.addClass("sv-helper").css({left:clientRect.left+document.body.scrollLeft+"px",top:clientRect.top+document.body.scrollTop+"px",width:clientRect.width+"px"})}else clone=target.clone(),clone.removeClass("sv-element-multi-selected"),clone.addClass("sv-helper").css({left:clientRect.left+document.body.scrollLeft+"px",top:clientRect.top+document.body.scrollTop+"px",width:clientRect.width+"px"});clone[0].reposition=function(coords){var targetLeft=coords.x,targetTop=coords.y,helperRect=clone[0].getBoundingClientRect(),body=document.body;containmentRect&&(targetTop<containmentRect.top+body.scrollTop&&(targetTop=containmentRect.top+body.scrollTop),targetTop+helperRect.height>containmentRect.top+body.scrollTop+containmentRect.height&&(targetTop=containmentRect.top+body.scrollTop+containmentRect.height-helperRect.height),targetLeft<containmentRect.left+body.scrollLeft&&(targetLeft=containmentRect.left+body.scrollLeft),targetLeft+helperRect.width>containmentRect.left+body.scrollLeft+containmentRect.width&&(targetLeft=containmentRect.left+body.scrollLeft+containmentRect.width-helperRect.width)),this.style.left=targetLeft-body.scrollLeft+"px",this.style.top=targetTop-body.scrollTop+"px"};var pointerOffset={x:(e.clientX-clientRect.left)/clientRect.width,y:(e.clientY-clientRect.top)/clientRect.height};html.addClass("sv-sorting-in-progress");var dropzoneClass="sv-sorting-"+$controllers[1].mapKey;html.addClass(dropzoneClass),html.on("mousemove touchmove",onMousemove).on("mouseup touchend touchcancel",function mouseup(e){svDragging.isDragging=!1,html.off("mousemove touchmove",onMousemove),html.off("mouseup touchend",mouseup),setTimeout(function(){html.removeClass("sv-sorting-in-progress"),html.removeClass(dropzoneClass)},500),moveExecuted&&($controllers[0].$drop($scope.$index,opts),moveExecuted=!1),$element.removeClass("sv-visibility-hidden"),$controllers[0].multiSelect?1===$controllers[1].MULTI_SELECT_LIST.length&&$controllers[1].clearMultiSelect(html):setTimeout(function(){target.removeClass("sv-long-pressing")},300)})}}var sortableElement={element:$element,getPart:$controllers[0].getPart,getIndex:function(){return $scope.$index}};$controllers[0].isDropzone&&$controllers[1].addToSortableElements(sortableElement),$scope.$on("$destroy",function(){$controllers[1].removeFromSortableElements(sortableElement)});var startTimer,clearEvent=function(){svDragging.isDragging=!1,clearTimeout(startTimer)},event=function(e){function setMulti(ev){!moveExecuted&&$controllers[0].multiSelect&&(ev.ctrlKey||ev.metaKey?sortableElement.$multiSelected?$controllers[1].removeFromMultiSelect(sortableElement,html):$controllers[1].addToMultiSelect(sortableElement,$scope,$attrs.svElement,html):sortableElement.$multiSelected||($controllers[1].clearMultiSelect(html),$controllers[1].addToMultiSelect(sortableElement,$scope,$attrs.svElement,html)))}var evt=null==e?event:e;return!(!evt||!(evt.which>1||evt.button>2))||(!!$controllers[1].sortingDisabled()||(html.on("mouseup touchend",function mouseup(e){setMulti(e),clearEvent(),html.off("mouseup touchend",mouseup)}),startTimer=setTimeout(function(){setMulti(e),onMousedown(e)},300),e.preventDefault(),e.stopPropagation(),!1))};$scope.$watch($parse($attrs.svElementDisabled),function(newVal,oldVal){newVal?resetOnStartEvent(!1,event):resetOnStartEvent($element,event)});var handle=$element;handle.on("mousedown touchstart",event),$scope.$watch("$ctrl.handle",function(customHandle){customHandle&&resetOnStartEvent(customHandle,event)});var helper;$scope.$watch("$ctrl.helper",function(customHelper){customHelper&&(helper=customHelper)});var placeholder;$scope.$watch("$ctrl.placeholder",function(customPlaceholder){customPlaceholder&&(placeholder=customPlaceholder)});var moveExecuted,body=angular.element(document.body),html=angular.element(document.documentElement)}}}]),module.directive("svHandle",function(){return{require:"?^svElement",link:function($scope,$element,$attrs,$ctrl){$ctrl&&($ctrl.handle=$element.add($ctrl.handle))}}}),module.directive("svHelper",function(){return{require:["?^svPart","?^svElement"],link:function($scope,$element,$attrs,$ctrl){$element.addClass("sv-helper").addClass("ng-hide"),$ctrl[1]?$ctrl[1].helper=$element:$ctrl[0]&&($ctrl[0].helper=$element)}}}),module.directive("svPlaceholder",function(){return{require:["?^svPart","?^svElement"],link:function($scope,$element,$attrs,$ctrl){if($element.addClass("sv-placeholder").addClass("ng-hide"),$ctrl[1]&&$ctrl[0])for(var p=$element.parent();p.length>0;){if(p[0].hasAttribute("sv-element"))return void($ctrl[1].placeholder=$element);if(p[0].hasAttribute("sv-part"))return void($ctrl[0].placeholder=$element);p=p.parent()}else $ctrl[1]?$ctrl[1].placeholder=$element:$ctrl[0]&&($ctrl[0].placeholder=$element)}}}),module.service("svDragging",function(){this.isDragging=!1}),angular.element(document.head).append(["<style>.sv-helper{position: fixed !important;z-index: 99999;margin: 0 !important;}.sv-candidate{}.sv-placeholder{}.sv-sorting-in-progress{-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}.sv-visibility-hidden{visibility: hidden !important;opacity: 0 !important;}</style>"].join(""));var dde=document.documentElement,matchingFunction=dde.matches?"matches":dde.matchesSelector?"matchesSelector":dde.webkitMatches?"webkitMatches":dde.webkitMatchesSelector?"webkitMatchesSelector":dde.msMatches?"msMatches":dde.msMatchesSelector?"msMatchesSelector":dde.mozMatches?"mozMatches":dde.mozMatchesSelector?"mozMatchesSelector":null;if(null==matchingFunction)throw"This browser doesn't support the HTMLElement.matches method";var closestElement=angular.element.prototype.closest||function(selector){for(var el=this[0].parentNode;el!==document.documentElement&&!el[matchingFunction](selector);)el=el.parentNode;return el[matchingFunction](selector)?angular.element(el):angular.element()};"function"!=typeof angular.element.prototype.add&&(angular.element.prototype.add=function(elem){var i,res=angular.element();for(elem=angular.element(elem),i=0;i<this.length;i++)res.push(this[i]);for(i=0;i<elem.length;i++)res.push(elem[i]);return res})}(window,window.angular),function(window,document,undefined){function bsCompilerService($q,$http,$injector,$compile,$controller,$templateCache){function findElement(query,element){return angular.element((element||document).querySelectorAll(query))}function fetchTemplate(template){return fetchPromises[template]?fetchPromises[template]:fetchPromises[template]=$http.get(template,{cache:$templateCache}).then(function(res){return res.data})}this.compile=function(options){options.template&&/\.html$/.test(options.template)&&(console.warn("Deprecated use of `template` option to pass a file. Please use the `templateUrl` option instead."),options.templateUrl=options.template,options.template="");var templateUrl=options.templateUrl,template=options.template||"",controller=options.controller,controllerAs=options.controllerAs,resolve=angular.copy(options.resolve||{}),locals=angular.copy(options.locals||{}),transformTemplate=options.transformTemplate||angular.identity,bindToController=options.bindToController;if(angular.forEach(resolve,function(value,key){angular.isString(value)?resolve[key]=$injector.get(value):resolve[key]=$injector.invoke(value)}),angular.extend(resolve,locals),template)resolve.$template=$q.when(template);else{if(!templateUrl)throw new Error("Missing `template` / `templateUrl` option.");resolve.$template=fetchTemplate(templateUrl)}return options.titleTemplate&&(resolve.$template=$q.all([resolve.$template,fetchTemplate(options.titleTemplate)]).then(function(templates){var templateEl=angular.element(templates[0]);return findElement('[ng-bind="title"]',templateEl[0]).removeAttr("ng-bind").html(templates[1]),templateEl[0].outerHTML})),options.contentTemplate&&(resolve.$template=$q.all([resolve.$template,fetchTemplate(options.contentTemplate)]).then(function(templates){var templateEl=angular.element(templates[0]),contentEl=findElement('[ng-bind="content"]',templateEl[0]).removeAttr("ng-bind").html(templates[1]);return options.templateUrl||contentEl.next().remove(),templateEl[0].outerHTML})),$q.all(resolve).then(function(locals){var template=transformTemplate(locals.$template);options.html&&(template=template.replace(/ng-bind="/gi,'ng-bind-html="'));var element=angular.element("<div>").html(template.trim()).contents(),linkFn=$compile(element);return{locals:locals,element:element,link:function(scope){if(locals.$scope=scope,controller){var invokeCtrl=$controller(controller,locals,!0);bindToController&&angular.extend(invokeCtrl.instance,locals);var ctrl=angular.isObject(invokeCtrl)?invokeCtrl:invokeCtrl();element.data("$ngControllerController",ctrl),element.children().data("$ngControllerController",ctrl),controllerAs&&(scope[controllerAs]=ctrl)}return linkFn.apply(null,arguments)}}})};var fetchPromises={}}bsCompilerService.$inject=["$q","$http","$injector","$compile","$controller","$templateCache"],angular.module("mgcrea.ngStrap.tooltip",["mgcrea.ngStrap.core","mgcrea.ngStrap.helpers.dimensions"]).provider("$tooltip",function(){var defaults=this.defaults={animation:"am-fade",customClass:"",prefixClass:"tooltip",prefixEvent:"tooltip",container:!1,target:!1,placement:"top",templateUrl:"tooltip/tooltip.tpl.html",template:"",titleTemplate:!1,trigger:"hover focus",keyboard:!1,html:!1,show:!1,title:"",type:"",delay:0,autoClose:!1,bsEnabled:!0,viewport:{selector:"body",padding:0}};this.$get=["$window","$rootScope","$bsCompiler","$q","$templateCache","$http","$animate","$sce","dimensions","$$rAF","$timeout",function($window,$rootScope,$bsCompiler,$q,$templateCache,$http,$animate,$sce,dimensions,$$rAF,$timeout){function TooltipFactory(element,config){function enterAnimateCallback(){scope.$emit(options.prefixEvent+".show",$tooltip)}function leaveAnimateCallback(){if(scope.$emit(options.prefixEvent+".hide",$tooltip),tipElement===_tipToHide){if(_blur&&"focus"===options.trigger)return element[0].blur();destroyTipElement()}}function bindTriggerEvents(){var triggers=options.trigger.split(" ");angular.forEach(triggers,function(trigger){"click"===trigger||"contextmenu"===trigger?element.on(trigger,$tooltip.toggle):"manual"!==trigger&&(element.on("hover"===trigger?"mouseenter":"focus",$tooltip.enter),element.on("hover"===trigger?"mouseleave":"blur",$tooltip.leave),"button"===nodeName&&"hover"!==trigger&&element.on(isTouch?"touchstart":"mousedown",$tooltip.$onFocusElementMouseDown))})}function unbindTriggerEvents(){for(var triggers=options.trigger.split(" "),i=triggers.length;i--;){var trigger=triggers[i];"click"===trigger||"contextmenu"===trigger?element.off(trigger,$tooltip.toggle):"manual"!==trigger&&(element.off("hover"===trigger?"mouseenter":"focus",$tooltip.enter),element.off("hover"===trigger?"mouseleave":"blur",$tooltip.leave),"button"===nodeName&&"hover"!==trigger&&element.off(isTouch?"touchstart":"mousedown",$tooltip.$onFocusElementMouseDown))}}function bindKeyboardEvents(){"focus"!==options.trigger?tipElement.on("keyup",$tooltip.$onKeyUp):element.on("keyup",$tooltip.$onFocusKeyUp)}function unbindKeyboardEvents(){"focus"!==options.trigger?tipElement.off("keyup",$tooltip.$onKeyUp):element.off("keyup",$tooltip.$onFocusKeyUp)}function bindAutoCloseEvents(){$timeout(function(){tipElement.on("click",stopEventPropagation),$body.on("click",$tooltip.hide),_autoCloseEventsBinded=!0},0,!1)}function unbindAutoCloseEvents(){_autoCloseEventsBinded&&(tipElement.off("click",stopEventPropagation),$body.off("click",$tooltip.hide),_autoCloseEventsBinded=!1)}function stopEventPropagation(event){event.stopPropagation()}function getPosition($element){$element=$element||options.target||element;var el=$element[0],isBody="BODY"===el.tagName,elRect=el.getBoundingClientRect(),rect={};for(var p in elRect)rect[p]=elRect[p];null===rect.width&&(rect=angular.extend({},rect,{width:elRect.right-elRect.left,height:elRect.bottom-elRect.top}));var elOffset=isBody?{top:0,left:0}:dimensions.offset(el),scroll={scroll:isBody?document.documentElement.scrollTop||document.body.scrollTop:$element.prop("scrollTop")||0},outerDims=isBody?{width:document.documentElement.clientWidth,height:$window.innerHeight}:null;return angular.extend({},rect,scroll,outerDims,elOffset)}function getCalculatedOffset(placement,position,actualWidth,actualHeight){var offset,split=placement.split("-");switch(split[0]){case"right":offset={top:position.top+position.height/2-actualHeight/2,left:position.left+position.width};break;case"bottom":offset={top:position.top+position.height,left:position.left+position.width/2-actualWidth/2};break;case"left":offset={top:position.top+position.height/2-actualHeight/2,left:position.left-actualWidth};break;default:offset={top:position.top-actualHeight,left:position.left+position.width/2-actualWidth/2}}if(!split[1])return offset;if("top"===split[0]||"bottom"===split[0])switch(split[1]){case"left":offset.left=position.left;break;case"right":offset.left=position.left+position.width-actualWidth}else if("left"===split[0]||"right"===split[0])switch(split[1]){case"top":offset.top=position.top-actualHeight+position.height;break;case"bottom":offset.top=position.top}return offset}function applyPlacement(offset,placement){var tip=tipElement[0],width=tip.offsetWidth,height=tip.offsetHeight,marginTop=parseInt(dimensions.css(tip,"margin-top"),10),marginLeft=parseInt(dimensions.css(tip,"margin-left"),10);isNaN(marginTop)&&(marginTop=0),isNaN(marginLeft)&&(marginLeft=0),offset.top=offset.top+marginTop,offset.left=offset.left+marginLeft,dimensions.setOffset(tip,angular.extend({using:function(props){tipElement.css({top:Math.round(props.top)+"px",left:Math.round(props.left)+"px",right:""})}},offset),0);var actualWidth=tip.offsetWidth,actualHeight=tip.offsetHeight;if("top"===placement&&actualHeight!==height&&(offset.top=offset.top+height-actualHeight),!/top-left|top-right|bottom-left|bottom-right/.test(placement)){var delta=getViewportAdjustedDelta(placement,offset,actualWidth,actualHeight);if(delta.left?offset.left+=delta.left:offset.top+=delta.top,dimensions.setOffset(tip,offset),/top|right|bottom|left/.test(placement)){var isVertical=/top|bottom/.test(placement),arrowDelta=isVertical?2*delta.left-width+actualWidth:2*delta.top-height+actualHeight,arrowOffsetPosition=isVertical?"offsetWidth":"offsetHeight";replaceArrow(arrowDelta,tip[arrowOffsetPosition],isVertical)}}}function getViewportAdjustedDelta(placement,position,actualWidth,actualHeight){var delta={top:0,left:0};if(!$tooltip.$viewport)return delta;var viewportPadding=options.viewport&&options.viewport.padding||0,viewportDimensions=getPosition($tooltip.$viewport);if(/right|left/.test(placement)){var topEdgeOffset=position.top-viewportPadding-viewportDimensions.scroll,bottomEdgeOffset=position.top+viewportPadding-viewportDimensions.scroll+actualHeight;topEdgeOffset<viewportDimensions.top?delta.top=viewportDimensions.top-topEdgeOffset:bottomEdgeOffset>viewportDimensions.top+viewportDimensions.height&&(delta.top=viewportDimensions.top+viewportDimensions.height-bottomEdgeOffset)}else{var leftEdgeOffset=position.left-viewportPadding,rightEdgeOffset=position.left+viewportPadding+actualWidth;leftEdgeOffset<viewportDimensions.left?delta.left=viewportDimensions.left-leftEdgeOffset:rightEdgeOffset>viewportDimensions.right&&(delta.left=viewportDimensions.left+viewportDimensions.width-rightEdgeOffset)}return delta}function replaceArrow(delta,dimension,isHorizontal){var $arrow=findElement(".tooltip-arrow, .arrow",tipElement[0]);$arrow.css(isHorizontal?"left":"top",50*(1-delta/dimension)+"%").css(isHorizontal?"top":"left","")}function destroyTipElement(){clearTimeout(timeout),$tooltip.$isShown&&null!==tipElement&&(options.autoClose&&unbindAutoCloseEvents(),options.keyboard&&unbindKeyboardEvents()),tipScope&&(tipScope.$destroy(),tipScope=null),tipElement&&(tipElement.remove(),tipElement=$tooltip.$element=null)}var $tooltip={},options=$tooltip.$options=angular.extend({},defaults,config),promise=$tooltip.$promise=$bsCompiler.compile(options),scope=$tooltip.$scope=options.scope&&options.scope.$new()||$rootScope.$new(),nodeName=element[0].nodeName.toLowerCase();if(options.delay&&angular.isString(options.delay)){var split=options.delay.split(",").map(parseFloat);options.delay=split.length>1?{show:split[0],hide:split[1]}:split[0]}$tooltip.$id=options.id||element.attr("id")||"",options.title&&(scope.title=$sce.trustAsHtml(options.title)),scope.$setEnabled=function(isEnabled){scope.$$postDigest(function(){$tooltip.setEnabled(isEnabled)})},scope.$hide=function(){scope.$$postDigest(function(){$tooltip.hide()})},scope.$show=function(){scope.$$postDigest(function(){$tooltip.show()})},scope.$toggle=function(){scope.$$postDigest(function(){$tooltip.toggle()})},$tooltip.$isShown=scope.$isShown=!1;var timeout,hoverState,compileData,tipElement,tipContainer,tipScope;promise.then(function(data){compileData=data,$tooltip.init()}),$tooltip.init=function(){options.delay&&angular.isNumber(options.delay)&&(options.delay={show:options.delay,hide:options.delay}),"self"===options.container?tipContainer=element:angular.isElement(options.container)?tipContainer=options.container:options.container&&(tipContainer=findElement(options.container)),bindTriggerEvents(),options.target&&(options.target=angular.isElement(options.target)?options.target:findElement(options.target)),options.show&&scope.$$postDigest(function(){"focus"===options.trigger?element[0].focus():$tooltip.show()})},$tooltip.destroy=function(){unbindTriggerEvents(),destroyTipElement(),scope.$destroy()},$tooltip.enter=function(){return clearTimeout(timeout),hoverState="in",options.delay&&options.delay.show?void(timeout=setTimeout(function(){"in"===hoverState&&$tooltip.show()},options.delay.show)):$tooltip.show()},$tooltip.show=function(){if(options.bsEnabled&&!$tooltip.$isShown){scope.$emit(options.prefixEvent+".show.before",$tooltip);var parent,after;options.container?(parent=tipContainer,after=tipContainer[0].lastChild?angular.element(tipContainer[0].lastChild):null):(parent=null,after=element),tipElement&&destroyTipElement(),tipScope=$tooltip.$scope.$new(),tipElement=$tooltip.$element=compileData.link(tipScope,function(clonedElement,scope){}),tipElement.css({top:"-9999px",left:"-9999px",right:"auto",display:"block",visibility:"hidden"}),options.animation&&tipElement.addClass(options.animation),options.type&&tipElement.addClass(options.prefixClass+"-"+options.type),options.customClass&&tipElement.addClass(options.customClass),after?after.after(tipElement):parent.prepend(tipElement),$tooltip.$isShown=scope.$isShown=!0,safeDigest(scope),$tooltip.$applyPlacement(),angular.version.minor<=2?$animate.enter(tipElement,parent,after,enterAnimateCallback):$animate.enter(tipElement,parent,after).then(enterAnimateCallback),safeDigest(scope),$$rAF(function(){tipElement&&tipElement.css({visibility:"visible"}),options.keyboard&&("focus"!==options.trigger&&$tooltip.focus(),bindKeyboardEvents())}),options.autoClose&&bindAutoCloseEvents()}},$tooltip.leave=function(){return clearTimeout(timeout),hoverState="out",options.delay&&options.delay.hide?void(timeout=setTimeout(function(){"out"===hoverState&&$tooltip.hide()},options.delay.hide)):$tooltip.hide()};var _blur,_tipToHide;$tooltip.hide=function(blur){$tooltip.$isShown&&(scope.$emit(options.prefixEvent+".hide.before",$tooltip),_blur=blur,_tipToHide=tipElement,angular.version.minor<=2?$animate.leave(tipElement,leaveAnimateCallback):$animate.leave(tipElement).then(leaveAnimateCallback),$tooltip.$isShown=scope.$isShown=!1,safeDigest(scope),options.keyboard&&null!==tipElement&&unbindKeyboardEvents(),options.autoClose&&null!==tipElement&&unbindAutoCloseEvents())},$tooltip.toggle=function(evt){evt&&evt.preventDefault(),$tooltip.$isShown?$tooltip.leave():$tooltip.enter()},$tooltip.focus=function(){tipElement[0].focus()},$tooltip.setEnabled=function(isEnabled){options.bsEnabled=isEnabled},$tooltip.setViewport=function(viewport){options.viewport=viewport},$tooltip.$applyPlacement=function(){if(tipElement){var placement=options.placement,autoToken=/\s?auto?\s?/i,autoPlace=autoToken.test(placement);autoPlace&&(placement=placement.replace(autoToken,"")||defaults.placement),tipElement.addClass(options.placement);var elementPosition=getPosition(),tipWidth=tipElement.prop("offsetWidth"),tipHeight=tipElement.prop("offsetHeight");if($tooltip.$viewport=options.viewport&&findElement(options.viewport.selector||options.viewport),autoPlace){var originalPlacement=placement,viewportPosition=getPosition($tooltip.$viewport);/bottom/.test(originalPlacement)&&elementPosition.bottom+tipHeight>viewportPosition.bottom?placement=originalPlacement.replace("bottom","top"):/top/.test(originalPlacement)&&elementPosition.top-tipHeight<viewportPosition.top&&(placement=originalPlacement.replace("top","bottom")),/left/.test(originalPlacement)&&elementPosition.left-tipWidth<viewportPosition.left?placement=placement.replace("left","right"):/right/.test(originalPlacement)&&elementPosition.right+tipWidth>viewportPosition.width&&(placement=placement.replace("right","left")),tipElement.removeClass(originalPlacement).addClass(placement)}var tipPosition=getCalculatedOffset(placement,elementPosition,tipWidth,tipHeight);applyPlacement(tipPosition,placement)}},$tooltip.$onKeyUp=function(evt){27===evt.which&&$tooltip.$isShown&&($tooltip.hide(),evt.stopPropagation())},$tooltip.$onFocusKeyUp=function(evt){27===evt.which&&(element[0].blur(),evt.stopPropagation())},$tooltip.$onFocusElementMouseDown=function(evt){evt.preventDefault(),evt.stopPropagation(),$tooltip.$isShown?element[0].blur():element[0].focus()};var _autoCloseEventsBinded=!1;return $tooltip}function safeDigest(scope){scope.$$phase||scope.$root&&scope.$root.$$phase||scope.$digest()}function findElement(query,element){return angular.element((element||document).querySelectorAll(query))}var isTouch="createTouch"in $window.document,$body=angular.element($window.document);return TooltipFactory}]}).directive("bsTooltip",["$window","$location","$sce","$tooltip","$$rAF",function($window,$location,$sce,$tooltip,$$rAF){return{restrict:"EAC",scope:!0,link:function(scope,element,attr,transclusion){var tooltip,options={scope:scope};angular.forEach(["template","templateUrl","controller","controllerAs","titleTemplate","placement","container","delay","trigger","html","animation","backdropAnimation","type","customClass","id"],function(key){angular.isDefined(attr[key])&&(options[key]=attr[key])});var falseValueRegExp=/^(false|0|)$/i;angular.forEach(["html","container"],function(key){angular.isDefined(attr[key])&&falseValueRegExp.test(attr[key])&&(options[key]=!1)});var dataTarget=element.attr("data-target");angular.isDefined(dataTarget)&&(falseValueRegExp.test(dataTarget)?options.target=!1:options.target=dataTarget),scope.hasOwnProperty("title")||(scope.title=""),attr.$observe("title",function(newValue){if(angular.isDefined(newValue)||!scope.hasOwnProperty("title")){var oldValue=scope.title;scope.title=$sce.trustAsHtml(newValue),angular.isDefined(oldValue)&&$$rAF(function(){tooltip&&tooltip.$applyPlacement()})}}),attr.$observe("disabled",function(newValue){newValue&&tooltip.$isShown&&tooltip.hide()}),attr.bsTooltip&&scope.$watch(attr.bsTooltip,function(newValue,oldValue){angular.isObject(newValue)?angular.extend(scope,newValue):scope.title=newValue,angular.isDefined(oldValue)&&$$rAF(function(){tooltip&&tooltip.$applyPlacement()})},!0),attr.bsShow&&scope.$watch(attr.bsShow,function(newValue,oldValue){tooltip&&angular.isDefined(newValue)&&(angular.isString(newValue)&&(newValue=!!newValue.match(/true|,?(tooltip),?/i)),newValue===!0?tooltip.show():tooltip.hide())}),attr.bsEnabled&&scope.$watch(attr.bsEnabled,function(newValue,oldValue){tooltip&&angular.isDefined(newValue)&&(angular.isString(newValue)&&(newValue=!!newValue.match(/true|1|,?(tooltip),?/i)),newValue===!1?tooltip.setEnabled(!1):tooltip.setEnabled(!0))}),attr.viewport&&scope.$watch(attr.viewport,function(newValue){tooltip&&angular.isDefined(newValue)&&tooltip.setViewport(newValue)}),tooltip=$tooltip(element,options),scope.$on("$destroy",function(){tooltip&&tooltip.destroy(),options=null,tooltip=null})}}}]),angular.module("mgcrea.ngStrap.typeahead",["mgcrea.ngStrap.tooltip","mgcrea.ngStrap.helpers.parseOptions"]).provider("$typeahead",function(){var defaults=this.defaults={animation:"am-fade",prefixClass:"typeahead",prefixEvent:"$typeahead",placement:"bottom-left",templateUrl:"typeahead/typeahead.tpl.html",trigger:"focus",container:!1,keyboard:!0,html:!1,delay:0,minLength:1,filter:"bsAsyncFilter",limit:6,autoSelect:!1,comparator:"",trimValue:!0};this.$get=["$window","$rootScope","$tooltip","$$rAF","$timeout",function($window,$rootScope,$tooltip,$$rAF,$timeout){function TypeaheadFactory(element,controller,config){var $typeahead={},options=angular.extend({},defaults,config);$typeahead=$tooltip(element,options);var parentScope=config.scope,scope=$typeahead.$scope;scope.$resetMatches=function(){scope.$matches=[],scope.$activeIndex=options.autoSelect?0:-1},scope.$resetMatches(),scope.$activate=function(index){scope.$$postDigest(function(){$typeahead.activate(index)})},scope.$select=function(index,evt){scope.$$postDigest(function(){$typeahead.select(index)})},scope.$isVisible=function(){return $typeahead.$isVisible()},$typeahead.update=function(matches){scope.$matches=matches,scope.$activeIndex>=matches.length&&(scope.$activeIndex=options.autoSelect?0:-1),safeDigest(scope),$$rAF($typeahead.$applyPlacement)},$typeahead.activate=function(index){scope.$activeIndex=index},$typeahead.select=function(index){if(index!==-1){var value=scope.$matches[index].value;controller.$setViewValue(value),controller.$render(),scope.$resetMatches(),parentScope&&parentScope.$digest(),scope.$emit(options.prefixEvent+".select",value,index,$typeahead)}},$typeahead.$isVisible=function(){return options.minLength&&controller?scope.$matches.length&&angular.isString(controller.$viewValue)&&controller.$viewValue.length>=options.minLength:!!scope.$matches.length},$typeahead.$getIndex=function(value){var index;for(index=scope.$matches.length;index--&&!angular.equals(scope.$matches[index].value,value););return index},$typeahead.$onMouseDown=function(evt){evt.preventDefault(),evt.stopPropagation();
},$typeahead.$onKeyDown=function(evt){/(38|40|13)/.test(evt.keyCode)&&(!$typeahead.$isVisible()||13===evt.keyCode&&scope.$activeIndex===-1||(evt.preventDefault(),evt.stopPropagation()),13===evt.keyCode&&scope.$matches.length?$typeahead.select(scope.$activeIndex):38===evt.keyCode&&scope.$activeIndex>0?scope.$activeIndex--:40===evt.keyCode&&scope.$activeIndex<scope.$matches.length-1?scope.$activeIndex++:angular.isUndefined(scope.$activeIndex)&&(scope.$activeIndex=0),scope.$digest())};var show=$typeahead.show;$typeahead.show=function(){show(),$timeout(function(){$typeahead.$element&&($typeahead.$element.on("mousedown",$typeahead.$onMouseDown),options.keyboard&&element&&element.on("keydown",$typeahead.$onKeyDown))},0,!1)};var hide=$typeahead.hide;return $typeahead.hide=function(){$typeahead.$element&&$typeahead.$element.off("mousedown",$typeahead.$onMouseDown),options.keyboard&&element&&element.off("keydown",$typeahead.$onKeyDown),options.autoSelect||$typeahead.activate(-1),hide()},$typeahead}function safeDigest(scope){scope.$$phase||scope.$root&&scope.$root.$$phase||scope.$digest()}return TypeaheadFactory.defaults=defaults,TypeaheadFactory}]}).filter("bsAsyncFilter",["$filter",function($filter){return function(array,expression,comparator){return array&&angular.isFunction(array.then)?array.then(function(results){return $filter("filter")(results,expression,comparator)}):$filter("filter")(array,expression,comparator)}}]).directive("bsTypeahead",["$window","$parse","$q","$typeahead","$parseOptions",function($window,$parse,$q,$typeahead,$parseOptions){var defaults=$typeahead.defaults;return{restrict:"EAC",require:"ngModel",link:function(scope,element,attr,controller){element.off("change");var options={scope:scope};angular.forEach(["template","templateUrl","controller","controllerAs","placement","container","delay","trigger","keyboard","html","animation","filter","limit","minLength","watchOptions","selectMode","autoSelect","comparator","id","prefixEvent","prefixClass"],function(key){angular.isDefined(attr[key])&&(options[key]=attr[key])});var falseValueRegExp=/^(false|0|)$/i;angular.forEach(["html","container","trimValue","filter"],function(key){angular.isDefined(attr[key])&&falseValueRegExp.test(attr[key])&&(options[key]=!1)}),element.attr("autocomplete")||element.attr("autocomplete","off");var filter=angular.isDefined(options.filter)?options.filter:defaults.filter,limit=options.limit||defaults.limit,comparator=options.comparator||defaults.comparator,bsOptions=attr.bsOptions;filter&&(bsOptions+=" | "+filter+":$viewValue",comparator&&(bsOptions+=":"+comparator)),limit&&(bsOptions+=" | limitTo:"+limit);var parsedOptions=$parseOptions(bsOptions),typeahead=$typeahead(element,controller,options);if(options.watchOptions){var watchedOptions=parsedOptions.$match[7].replace(/\|.+/,"").replace(/\(.*\)/g,"").trim();scope.$watchCollection(watchedOptions,function(newValue,oldValue){parsedOptions.valuesFn(scope,controller).then(function(values){typeahead.update(values),controller.$render()})})}scope.$watch(attr.ngModel,function(newValue,oldValue){scope.$modelValue=newValue,parsedOptions.valuesFn(scope,controller).then(function(values){return options.selectMode&&!values.length&&newValue.length>0?void controller.$setViewValue(controller.$viewValue.substring(0,controller.$viewValue.length-1)):(values.length>limit&&(values=values.slice(0,limit)),typeahead.update(values),void controller.$render())})}),controller.$formatters.push(function(modelValue){var displayValue=parsedOptions.displayValue(modelValue);return displayValue?displayValue:angular.isDefined(modelValue)&&"object"!=typeof modelValue?modelValue:""}),controller.$render=function(){if(controller.$isEmpty(controller.$viewValue))return element.val("");var index=typeahead.$getIndex(controller.$modelValue),selected=index!==-1?typeahead.$scope.$matches[index].label:controller.$viewValue;selected=angular.isObject(selected)?parsedOptions.displayValue(selected):selected;var value=selected?selected.toString().replace(/<(?:.|\n)*?>/gm,""):"";element.val(options.trimValue===!1?value:value.trim())},scope.$on("$destroy",function(){typeahead&&typeahead.destroy(),options=null,typeahead=null})}}}]),angular.module("mgcrea.ngStrap.timepicker",["mgcrea.ngStrap.helpers.dateParser","mgcrea.ngStrap.helpers.dateFormatter","mgcrea.ngStrap.tooltip"]).provider("$timepicker",function(){var defaults=this.defaults={animation:"am-fade",prefixClass:"timepicker",placement:"bottom-left",templateUrl:"timepicker/timepicker.tpl.html",trigger:"focus",container:!1,keyboard:!0,html:!1,delay:0,useNative:!0,timeType:"date",timeFormat:"shortTime",timezone:null,modelTimeFormat:null,autoclose:!1,minTime:-(1/0),maxTime:+(1/0),length:5,hourStep:1,minuteStep:5,secondStep:5,roundDisplay:!1,iconUp:"glyphicon glyphicon-chevron-up",iconDown:"glyphicon glyphicon-chevron-down",arrowBehavior:"pager"};this.$get=["$window","$document","$rootScope","$sce","$dateFormatter","$tooltip","$timeout",function($window,$document,$rootScope,$sce,$dateFormatter,$tooltip,$timeout){function timepickerFactory(element,controller,config){function floorMinutes(time){var coeff=6e4*options.minuteStep;return new Date(Math.floor(time.getTime()/coeff)*coeff)}function createSelection(start,length){var end=start+length;if(element[0].createTextRange){var selRange=element[0].createTextRange();selRange.collapse(!0),selRange.moveStart("character",start),selRange.moveEnd("character",end),selRange.select()}else element[0].setSelectionRange?element[0].setSelectionRange(start,end):angular.isUndefined(element[0].selectionStart)&&(element[0].selectionStart=start,element[0].selectionEnd=end)}function focusElement(){element[0].focus()}var $timepicker=$tooltip(element,angular.extend({},defaults,config)),parentScope=config.scope,options=$timepicker.$options,scope=$timepicker.$scope,lang=options.lang,formatDate=function(date,format,timezone){return $dateFormatter.formatDate(date,format,lang,timezone)},selectedIndex=0,defaultDate=options.roundDisplay?floorMinutes(new Date):new Date,startDate=controller.$dateValue||defaultDate,viewDate={hour:startDate.getHours(),meridian:startDate.getHours()<12,minute:startDate.getMinutes(),second:startDate.getSeconds(),millisecond:startDate.getMilliseconds()},format=$dateFormatter.getDatetimeFormat(options.timeFormat,lang),hoursFormat=$dateFormatter.hoursFormat(format),timeSeparator=$dateFormatter.timeSeparator(format),minutesFormat=$dateFormatter.minutesFormat(format),secondsFormat=$dateFormatter.secondsFormat(format),showSeconds=$dateFormatter.showSeconds(format),showAM=$dateFormatter.showAM(format);scope.$iconUp=options.iconUp,scope.$iconDown=options.iconDown,scope.$select=function(date,index){$timepicker.select(date,index)},scope.$moveIndex=function(value,index){$timepicker.$moveIndex(value,index)},scope.$switchMeridian=function(date){$timepicker.switchMeridian(date)},$timepicker.update=function(date){angular.isDate(date)&&!isNaN(date.getTime())?($timepicker.$date=date,angular.extend(viewDate,{hour:date.getHours(),minute:date.getMinutes(),second:date.getSeconds(),millisecond:date.getMilliseconds()}),$timepicker.$build()):$timepicker.$isBuilt||$timepicker.$build()},$timepicker.select=function(date,index,keep){controller.$dateValue&&!isNaN(controller.$dateValue.getTime())||(controller.$dateValue=new Date(1970,0,1)),angular.isDate(date)||(date=new Date(date)),0===index?controller.$dateValue.setHours(date.getHours()):1===index?controller.$dateValue.setMinutes(date.getMinutes()):2===index&&controller.$dateValue.setSeconds(date.getSeconds()),controller.$setViewValue(angular.copy(controller.$dateValue)),controller.$render(),options.autoclose&&!keep&&$timeout(function(){$timepicker.hide(!0)})},$timepicker.switchMeridian=function(date){if(controller.$dateValue&&!isNaN(controller.$dateValue.getTime())){var hours=(date||controller.$dateValue).getHours();controller.$dateValue.setHours(hours<12?hours+12:hours-12),controller.$setViewValue(angular.copy(controller.$dateValue)),controller.$render()}},$timepicker.$build=function(){var i,hour,midIndex=scope.midIndex=parseInt(options.length/2,10),hours=[];for(i=0;i<options.length;i++)hour=new Date(1970,0,1,viewDate.hour-(midIndex-i)*options.hourStep),hours.push({date:hour,label:formatDate(hour,hoursFormat),selected:$timepicker.$date&&$timepicker.$isSelected(hour,0),disabled:$timepicker.$isDisabled(hour,0)});var minute,minutes=[];for(i=0;i<options.length;i++)minute=new Date(1970,0,1,0,viewDate.minute-(midIndex-i)*options.minuteStep),minutes.push({date:minute,label:formatDate(minute,minutesFormat),selected:$timepicker.$date&&$timepicker.$isSelected(minute,1),disabled:$timepicker.$isDisabled(minute,1)});var second,seconds=[];for(i=0;i<options.length;i++)second=new Date(1970,0,1,0,0,viewDate.second-(midIndex-i)*options.secondStep),seconds.push({date:second,label:formatDate(second,secondsFormat),selected:$timepicker.$date&&$timepicker.$isSelected(second,2),disabled:$timepicker.$isDisabled(second,2)});var rows=[];for(i=0;i<options.length;i++)showSeconds?rows.push([hours[i],minutes[i],seconds[i]]):rows.push([hours[i],minutes[i]]);scope.rows=rows,scope.showSeconds=showSeconds,scope.showAM=showAM,scope.isAM=($timepicker.$date||hours[midIndex].date).getHours()<12,scope.timeSeparator=timeSeparator,$timepicker.$isBuilt=!0},$timepicker.$isSelected=function(date,index){return!!$timepicker.$date&&(0===index?date.getHours()===$timepicker.$date.getHours():1===index?date.getMinutes()===$timepicker.$date.getMinutes():2===index?date.getSeconds()===$timepicker.$date.getSeconds():void 0)},$timepicker.$isDisabled=function(date,index){var selectedTime;return 0===index?selectedTime=date.getTime()+6e4*viewDate.minute+1e3*viewDate.second:1===index?selectedTime=date.getTime()+36e5*viewDate.hour+1e3*viewDate.second:2===index&&(selectedTime=date.getTime()+36e5*viewDate.hour+6e4*viewDate.minute),selectedTime<1*options.minTime||selectedTime>1*options.maxTime},scope.$arrowAction=function(value,index){"picker"===options.arrowBehavior?$timepicker.$setTimeByStep(value,index):$timepicker.$moveIndex(value,index)},$timepicker.$setTimeByStep=function(value,index){var newDate=new Date($timepicker.$date||startDate),hours=newDate.getHours(),minutes=newDate.getMinutes(),seconds=newDate.getSeconds();0===index?newDate.setHours(hours-parseInt(options.hourStep,10)*value):1===index?newDate.setMinutes(minutes-parseInt(options.minuteStep,10)*value):2===index&&newDate.setSeconds(seconds-parseInt(options.secondStep,10)*value),$timepicker.select(newDate,index,!0)},$timepicker.$moveIndex=function(value,index){var targetDate;0===index?(targetDate=new Date(1970,0,1,viewDate.hour+value*options.length,viewDate.minute,viewDate.second),angular.extend(viewDate,{hour:targetDate.getHours()})):1===index?(targetDate=new Date(1970,0,1,viewDate.hour,viewDate.minute+value*options.length*options.minuteStep,viewDate.second),angular.extend(viewDate,{minute:targetDate.getMinutes()})):2===index&&(targetDate=new Date(1970,0,1,viewDate.hour,viewDate.minute,viewDate.second+value*options.length*options.secondStep),angular.extend(viewDate,{second:targetDate.getSeconds()})),$timepicker.$build()},$timepicker.$onMouseDown=function(evt){if("input"!==evt.target.nodeName.toLowerCase()&&evt.preventDefault(),evt.stopPropagation(),isTouch){var targetEl=angular.element(evt.target);"button"!==targetEl[0].nodeName.toLowerCase()&&(targetEl=targetEl.parent()),targetEl.triggerHandler("click")}},$timepicker.$onKeyDown=function(evt){if(/(38|37|39|40|13)/.test(evt.keyCode)&&!evt.shiftKey&&!evt.altKey){if(evt.preventDefault(),evt.stopPropagation(),13===evt.keyCode)return void $timepicker.hide(!0);var newDate=new Date($timepicker.$date),hours=newDate.getHours(),hoursLength=formatDate(newDate,hoursFormat).length,minutes=newDate.getMinutes(),minutesLength=formatDate(newDate,minutesFormat).length,seconds=newDate.getSeconds(),secondsLength=formatDate(newDate,secondsFormat).length,sepLength=1,lateralMove=/(37|39)/.test(evt.keyCode),count=2+1*showSeconds+1*showAM;lateralMove&&(37===evt.keyCode?selectedIndex=selectedIndex<1?count-1:selectedIndex-1:39===evt.keyCode&&(selectedIndex=selectedIndex<count-1?selectedIndex+1:0));var selectRange=[0,hoursLength],incr=0;38===evt.keyCode&&(incr=-1),40===evt.keyCode&&(incr=1);var isSeconds=2===selectedIndex&&showSeconds,isMeridian=2===selectedIndex&&!showSeconds||3===selectedIndex&&showSeconds;0===selectedIndex?(newDate.setHours(hours+incr*parseInt(options.hourStep,10)),hoursLength=formatDate(newDate,hoursFormat).length,selectRange=[0,hoursLength]):1===selectedIndex?(newDate.setMinutes(minutes+incr*parseInt(options.minuteStep,10)),minutesLength=formatDate(newDate,minutesFormat).length,selectRange=[hoursLength+sepLength,minutesLength]):isSeconds?(newDate.setSeconds(seconds+incr*parseInt(options.secondStep,10)),secondsLength=formatDate(newDate,secondsFormat).length,selectRange=[hoursLength+sepLength+minutesLength+sepLength,secondsLength]):isMeridian&&(lateralMove||$timepicker.switchMeridian(),selectRange=[hoursLength+sepLength+minutesLength+sepLength+(secondsLength+sepLength)*showSeconds,2]),$timepicker.select(newDate,selectedIndex,!0),createSelection(selectRange[0],selectRange[1]),parentScope.$digest()}};var _init=$timepicker.init;$timepicker.init=function(){return isNative&&options.useNative?(element.prop("type","time"),void element.css("-webkit-appearance","textfield")):(isTouch&&(element.prop("type","text"),element.attr("readonly","true"),element.on("click",focusElement)),void _init())};var _destroy=$timepicker.destroy;$timepicker.destroy=function(){isNative&&options.useNative&&element.off("click",focusElement),_destroy()};var _show=$timepicker.show;$timepicker.show=function(){!isTouch&&element.attr("readonly")||element.attr("disabled")||(_show(),$timeout(function(){$timepicker.$element&&$timepicker.$element.on(isTouch?"touchstart":"mousedown",$timepicker.$onMouseDown),options.keyboard&&element&&element.on("keydown",$timepicker.$onKeyDown)},0,!1))};var _hide=$timepicker.hide;return $timepicker.hide=function(blur){$timepicker.$isShown&&($timepicker.$element&&$timepicker.$element.off(isTouch?"touchstart":"mousedown",$timepicker.$onMouseDown),options.keyboard&&element&&element.off("keydown",$timepicker.$onKeyDown),_hide(blur))},$timepicker}var isNative=/(ip[ao]d|iphone|android)/gi.test($window.navigator.userAgent),isTouch="createTouch"in $window.document&&isNative;return defaults.lang||(defaults.lang=$dateFormatter.getDefaultLocale()),timepickerFactory.defaults=defaults,timepickerFactory}]}).directive("bsTimepicker",["$window","$parse","$q","$dateFormatter","$dateParser","$timepicker",function($window,$parse,$q,$dateFormatter,$dateParser,$timepicker){var defaults=$timepicker.defaults,isNative=/(ip[ao]d|iphone|android)/gi.test($window.navigator.userAgent);return{restrict:"EAC",require:"ngModel",link:function(scope,element,attr,controller){function validateAgainstMinMaxTime(parsedTime){if(angular.isDate(parsedTime)){var isMinValid=isNaN(options.minTime)||new Date(parsedTime.getTime()).setFullYear(1970,0,1)>=options.minTime,isMaxValid=isNaN(options.maxTime)||new Date(parsedTime.getTime()).setFullYear(1970,0,1)<=options.maxTime,isValid=isMinValid&&isMaxValid;controller.$setValidity("date",isValid),controller.$setValidity("min",isMinValid),controller.$setValidity("max",isMaxValid),isValid&&(controller.$dateValue=parsedTime)}}function getTimeFormattedString(){return!controller.$dateValue||isNaN(controller.$dateValue.getTime())?"":formatDate(controller.$dateValue,options.timeFormat)}var options={scope:scope};angular.forEach(["template","templateUrl","controller","controllerAs","placement","container","delay","trigger","keyboard","html","animation","autoclose","timeType","timeFormat","timezone","modelTimeFormat","useNative","hourStep","minuteStep","secondStep","length","arrowBehavior","iconUp","iconDown","roundDisplay","id","prefixClass","prefixEvent"],function(key){angular.isDefined(attr[key])&&(options[key]=attr[key])});var falseValueRegExp=/^(false|0|)$/i;angular.forEach(["html","container","autoclose","useNative","roundDisplay"],function(key){angular.isDefined(attr[key])&&falseValueRegExp.test(attr[key])&&(options[key]=!1)}),isNative&&(options.useNative||defaults.useNative)&&(options.timeFormat="HH:mm");var timepicker=$timepicker(element,controller,options);options=timepicker.$options;var lang=options.lang,formatDate=function(date,format,timezone){return $dateFormatter.formatDate(date,format,lang,timezone)};attr.bsShow&&scope.$watch(attr.bsShow,function(newValue,oldValue){timepicker&&angular.isDefined(newValue)&&(angular.isString(newValue)&&(newValue=!!newValue.match(/true|,?(timepicker),?/i)),newValue===!0?timepicker.show():timepicker.hide())});var dateParser=$dateParser({format:options.timeFormat,lang:lang});angular.forEach(["minTime","maxTime"],function(key){angular.isDefined(attr[key])&&attr.$observe(key,function(newValue){timepicker.$options[key]=dateParser.getTimeForAttribute(key,newValue),isNaN(timepicker.$options[key])||timepicker.$build(),validateAgainstMinMaxTime(controller.$dateValue)})}),scope.$watch(attr.ngModel,function(newValue,oldValue){timepicker.update(controller.$dateValue)},!0),controller.$parsers.unshift(function(viewValue){var date;if(!viewValue)return controller.$setValidity("date",!0),null;var parsedTime=angular.isDate(viewValue)?viewValue:dateParser.parse(viewValue,controller.$dateValue);return!parsedTime||isNaN(parsedTime.getTime())?(controller.$setValidity("date",!1),undefined):(validateAgainstMinMaxTime(parsedTime),"string"===options.timeType?(date=dateParser.timezoneOffsetAdjust(parsedTime,options.timezone,!0),formatDate(date,options.modelTimeFormat||options.timeFormat)):(date=dateParser.timezoneOffsetAdjust(controller.$dateValue,options.timezone,!0),"number"===options.timeType?date.getTime():"unix"===options.timeType?date.getTime()/1e3:"iso"===options.timeType?date.toISOString():new Date(date)))}),controller.$formatters.push(function(modelValue){var date;return date=angular.isUndefined(modelValue)||null===modelValue?NaN:angular.isDate(modelValue)?modelValue:"string"===options.timeType?dateParser.parse(modelValue,null,options.modelTimeFormat):"unix"===options.timeType?new Date(1e3*modelValue):new Date(modelValue),controller.$dateValue=dateParser.timezoneOffsetAdjust(date,options.timezone),getTimeFormattedString()}),controller.$render=function(){element.val(getTimeFormattedString())},scope.$on("$destroy",function(){timepicker&&timepicker.destroy(),options=null,timepicker=null})}}}]),angular.module("mgcrea.ngStrap.tab",[]).provider("$tab",function(){var defaults=this.defaults={animation:"am-fade",template:"tab/tab.tpl.html",navClass:"nav-tabs",activeClass:"active"},controller=this.controller=function($scope,$element,$attrs){var self=this;self.$options=angular.copy(defaults),angular.forEach(["animation","navClass","activeClass"],function(key){angular.isDefined($attrs[key])&&(self.$options[key]=$attrs[key])}),$scope.$navClass=self.$options.navClass,$scope.$activeClass=self.$options.activeClass,self.$panes=$scope.$panes=[],self.$activePaneChangeListeners=self.$viewChangeListeners=[],self.$push=function(pane){angular.isUndefined(self.$panes.$active)&&$scope.$setActive(pane.name||0),self.$panes.push(pane)},self.$remove=function(pane){var activeIndex,index=self.$panes.indexOf(pane),active=self.$panes.$active;activeIndex=angular.isString(active)?self.$panes.map(function(pane){return pane.name}).indexOf(active):self.$panes.$active,self.$panes.splice(index,1),index<activeIndex?activeIndex--:index===activeIndex&&activeIndex===self.$panes.length&&activeIndex--,activeIndex>=0&&activeIndex<self.$panes.length?self.$setActive(self.$panes[activeIndex].name||activeIndex):self.$setActive()},self.$setActive=$scope.$setActive=function(value){self.$panes.$active=value,self.$activePaneChangeListeners.forEach(function(fn){fn()})},self.$isActive=$scope.$isActive=function($pane,$index){return self.$panes.$active===$pane.name||self.$panes.$active===$index}};this.$get=function(){var $tab={};return $tab.defaults=defaults,$tab.controller=controller,$tab}}).directive("bsTabs",["$window","$animate","$tab","$parse",function($window,$animate,$tab,$parse){var defaults=$tab.defaults;return{require:["?ngModel","bsTabs"],transclude:!0,scope:!0,controller:["$scope","$element","$attrs",$tab.controller],templateUrl:function(element,attr){return attr.template||defaults.template},link:function(scope,element,attrs,controllers){var ngModelCtrl=controllers[0],bsTabsCtrl=controllers[1];if(ngModelCtrl&&(bsTabsCtrl.$activePaneChangeListeners.push(function(){ngModelCtrl.$setViewValue(bsTabsCtrl.$panes.$active)}),ngModelCtrl.$formatters.push(function(modelValue){return bsTabsCtrl.$setActive(modelValue),modelValue})),attrs.bsActivePane){var parsedBsActivePane=$parse(attrs.bsActivePane);bsTabsCtrl.$activePaneChangeListeners.push(function(){parsedBsActivePane.assign(scope,bsTabsCtrl.$panes.$active)}),scope.$watch(attrs.bsActivePane,function(newValue,oldValue){bsTabsCtrl.$setActive(newValue)},!0)}}}}]).directive("bsPane",["$window","$animate","$sce",function($window,$animate,$sce){return{require:["^?ngModel","^bsTabs"],scope:!0,link:function(scope,element,attrs,controllers){function render(){var index=bsTabsCtrl.$panes.indexOf(scope);$animate[bsTabsCtrl.$isActive(scope,index)?"addClass":"removeClass"](element,bsTabsCtrl.$options.activeClass)}var bsTabsCtrl=controllers[1];element.addClass("tab-pane"),attrs.$observe("title",function(newValue,oldValue){scope.title=$sce.trustAsHtml(newValue)}),scope.name=attrs.name,bsTabsCtrl.$options.animation&&element.addClass(bsTabsCtrl.$options.animation),attrs.$observe("disabled",function(newValue,oldValue){scope.disabled=scope.$eval(newValue)}),bsTabsCtrl.$push(scope),scope.$on("$destroy",function(){bsTabsCtrl.$remove(scope)}),bsTabsCtrl.$activePaneChangeListeners.push(function(){render()}),render()}}}]),angular.module("mgcrea.ngStrap.select",["mgcrea.ngStrap.tooltip","mgcrea.ngStrap.helpers.parseOptions"]).provider("$select",function(){var defaults=this.defaults={animation:"am-fade",prefixClass:"select",prefixEvent:"$select",placement:"bottom-left",templateUrl:"select/select.tpl.html",trigger:"focus",container:!1,keyboard:!0,html:!1,delay:0,multiple:!1,allNoneButtons:!1,sort:!0,caretHtml:'&nbsp;<span class="caret"></span>',placeholder:"Choose among the following...",allText:"All",noneText:"None",maxLength:3,maxLengthHtml:"selected",iconCheckmark:"glyphicon glyphicon-ok"};this.$get=["$window","$document","$rootScope","$tooltip","$timeout",function($window,$document,$rootScope,$tooltip,$timeout){function SelectFactory(element,controller,config){var $select={},options=angular.extend({},defaults,config);$select=$tooltip(element,options);var scope=$select.$scope;scope.$matches=[],options.multiple?scope.$activeIndex=[]:scope.$activeIndex=-1,scope.$isMultiple=options.multiple,scope.$showAllNoneButtons=options.allNoneButtons&&options.multiple,scope.$iconCheckmark=options.iconCheckmark,scope.$allText=options.allText,scope.$noneText=options.noneText,scope.$activate=function(index){scope.$$postDigest(function(){$select.activate(index)})},scope.$select=function(index,evt){scope.$$postDigest(function(){$select.select(index)})},scope.$isVisible=function(){return $select.$isVisible()},scope.$isActive=function(index){return $select.$isActive(index)},scope.$selectAll=function(){for(var i=0;i<scope.$matches.length;i++)scope.$isActive(i)||scope.$select(i)},scope.$selectNone=function(){for(var i=0;i<scope.$matches.length;i++)scope.$isActive(i)&&scope.$select(i)},$select.update=function(matches){scope.$matches=matches,$select.$updateActiveIndex()},$select.activate=function(index){return options.multiple?($select.$isActive(index)?scope.$activeIndex.splice(scope.$activeIndex.indexOf(index),1):scope.$activeIndex.push(index),options.sort&&scope.$activeIndex.sort(function(a,b){return a-b})):scope.$activeIndex=index,scope.$activeIndex},$select.select=function(index){var value=scope.$matches[index].value;scope.$apply(function(){$select.activate(index),options.multiple?controller.$setViewValue(scope.$activeIndex.map(function(index){return angular.isUndefined(scope.$matches[index])?null:scope.$matches[index].value})):(controller.$setViewValue(value),$select.hide())}),scope.$emit(options.prefixEvent+".select",value,index,$select)},$select.$updateActiveIndex=function(){options.multiple?angular.isArray(controller.$modelValue)?scope.$activeIndex=controller.$modelValue.map(function(value){return $select.$getIndex(value)}):scope.$activeIndex=[]:angular.isDefined(controller.$modelValue)&&scope.$matches.length?scope.$activeIndex=$select.$getIndex(controller.$modelValue):scope.$activeIndex=-1},$select.$isVisible=function(){return options.minLength&&controller?scope.$matches.length&&controller.$viewValue.length>=options.minLength:scope.$matches.length},$select.$isActive=function(index){return options.multiple?scope.$activeIndex.indexOf(index)!==-1:scope.$activeIndex===index},$select.$getIndex=function(value){var index;for(index=scope.$matches.length;index--&&!angular.equals(scope.$matches[index].value,value););return index},$select.$onMouseDown=function(evt){if(evt.preventDefault(),evt.stopPropagation(),isTouch){var targetEl=angular.element(evt.target);targetEl.triggerHandler("click")}},$select.$onKeyDown=function(evt){if(/(9|13|38|40)/.test(evt.keyCode))return 9!==evt.keyCode&&(evt.preventDefault(),evt.stopPropagation()),options.multiple&&9===evt.keyCode?$select.hide():options.multiple||13!==evt.keyCode&&9!==evt.keyCode?void(options.multiple||(38===evt.keyCode&&scope.$activeIndex>0?scope.$activeIndex--:38===evt.keyCode&&scope.$activeIndex<0?scope.$activeIndex=scope.$matches.length-1:40===evt.keyCode&&scope.$activeIndex<scope.$matches.length-1?scope.$activeIndex++:angular.isUndefined(scope.$activeIndex)&&(scope.$activeIndex=0),scope.$digest())):$select.select(scope.$activeIndex)},$select.$isIE=function(){var ua=$window.navigator.userAgent;return ua.indexOf("MSIE ")>0||ua.indexOf("Trident/")>0||ua.indexOf("Edge/")>0},$select.$selectScrollFix=function(e){"UL"===$document[0].activeElement.tagName&&(e.preventDefault(),e.stopImmediatePropagation(),e.target.focus())};var _show=$select.show;$select.show=function(){_show(),options.multiple&&$select.$element.addClass("select-multiple"),$timeout(function(){$select.$element.on(isTouch?"touchstart":"mousedown",$select.$onMouseDown),options.keyboard&&element.on("keydown",$select.$onKeyDown)},0,!1)};var _hide=$select.hide;return $select.hide=function(){!options.multiple&&angular.isUndefined(controller.$modelValue)&&(scope.$activeIndex=-1),$select.$element.off(isTouch?"touchstart":"mousedown",$select.$onMouseDown),options.keyboard&&element.off("keydown",$select.$onKeyDown),_hide(!0)},$select}var isNative=/(ip[ao]d|iphone|android)/gi.test($window.navigator.userAgent),isTouch="createTouch"in $window.document&&isNative;return SelectFactory.defaults=defaults,SelectFactory}]}).directive("bsSelect",["$window","$parse","$q","$select","$parseOptions",function($window,$parse,$q,$select,$parseOptions){var defaults=$select.defaults;return{restrict:"EAC",require:"ngModel",link:function(scope,element,attr,controller){var options={scope:scope,placeholder:defaults.placeholder};angular.forEach(["template","templateUrl","controller","controllerAs","placement","container","delay","trigger","keyboard","html","animation","placeholder","allNoneButtons","maxLength","maxLengthHtml","allText","noneText","iconCheckmark","autoClose","id","sort","caretHtml","prefixClass","prefixEvent"],function(key){angular.isDefined(attr[key])&&(options[key]=attr[key])});var falseValueRegExp=/^(false|0|)$/i;angular.forEach(["html","container","allNoneButtons","sort"],function(key){angular.isDefined(attr[key])&&falseValueRegExp.test(attr[key])&&(options[key]=!1)});var dataMultiple=element.attr("data-multiple");if(angular.isDefined(dataMultiple)&&(falseValueRegExp.test(dataMultiple)?options.multiple=!1:options.multiple=dataMultiple),"select"===element[0].nodeName.toLowerCase()){var inputEl=element;inputEl.css("display","none"),element=angular.element('<button type="button" class="btn btn-default"></button>'),inputEl.after(element)}var parsedOptions=$parseOptions(attr.bsOptions),select=$select(element,controller,options);select.$isIE()&&element[0].addEventListener("blur",select.$selectScrollFix);var watchedOptions=parsedOptions.$match[7].replace(/\|.+/,"").trim();scope.$watch(watchedOptions,function(newValue,oldValue){parsedOptions.valuesFn(scope,controller).then(function(values){select.update(values),controller.$render()})},!0),scope.$watch(attr.ngModel,function(newValue,oldValue){select.$updateActiveIndex(),controller.$render()},!0),controller.$render=function(){var selected,index;options.multiple&&angular.isArray(controller.$modelValue)?(selected=controller.$modelValue.map(function(value){return index=select.$getIndex(value),index!==-1&&select.$scope.$matches[index].label}).filter(angular.isDefined),selected=selected.length>(options.maxLength||defaults.maxLength)?selected.length+" "+(options.maxLengthHtml||defaults.maxLengthHtml):selected.join(", ")):(index=select.$getIndex(controller.$modelValue),selected=index!==-1&&select.$scope.$matches[index].label),element.html((selected||options.placeholder)+(options.caretHtml||defaults.caretHtml))},options.multiple&&(controller.$isEmpty=function(value){return!value||0===value.length}),scope.$on("$destroy",function(){select&&select.destroy(),options=null,select=null})}}}]),angular.module("mgcrea.ngStrap.scrollspy",["mgcrea.ngStrap.helpers.debounce","mgcrea.ngStrap.helpers.dimensions"]).provider("$scrollspy",function(){var spies=this.$$spies={},defaults=this.defaults={debounce:150,throttle:100,offset:100};this.$get=["$window","$document","$rootScope","dimensions","debounce","throttle",function($window,$document,$rootScope,dimensions,debounce,throttle){function nodeName(element,name){return element[0].nodeName&&element[0].nodeName.toLowerCase()===name.toLowerCase()}function ScrollSpyFactory(config){var options=angular.extend({},defaults,config);options.element||(options.element=bodyEl);var isWindowSpy=nodeName(options.element,"body"),scrollEl=isWindowSpy?windowEl:options.element,scrollId=isWindowSpy?"window":options.id;if(spies[scrollId])return spies[scrollId].$$count++,spies[scrollId];var unbindViewContentLoaded,unbindIncludeContentLoaded,activeTarget,debouncedCheckPosition,throttledCheckPosition,debouncedCheckOffsets,viewportHeight,scrollTop,$scrollspy={},trackedElements=$scrollspy.$trackedElements=[],sortedElements=[];return $scrollspy.init=function(){this.$$count=1,debouncedCheckPosition=debounce(this.checkPosition,options.debounce),throttledCheckPosition=throttle(this.checkPosition,options.throttle),scrollEl.on("click",this.checkPositionWithEventLoop),windowEl.on("resize",debouncedCheckPosition),scrollEl.on("scroll",throttledCheckPosition),debouncedCheckOffsets=debounce(this.checkOffsets,options.debounce),unbindViewContentLoaded=$rootScope.$on("$viewContentLoaded",debouncedCheckOffsets),unbindIncludeContentLoaded=$rootScope.$on("$includeContentLoaded",debouncedCheckOffsets),debouncedCheckOffsets(),scrollId&&(spies[scrollId]=$scrollspy)},$scrollspy.destroy=function(){this.$$count--,this.$$count>0||(scrollEl.off("click",this.checkPositionWithEventLoop),windowEl.off("resize",debouncedCheckPosition),scrollEl.off("scroll",throttledCheckPosition),unbindViewContentLoaded(),unbindIncludeContentLoaded(),scrollId&&delete spies[scrollId])},$scrollspy.checkPosition=function(){if(sortedElements.length){if(scrollTop=(isWindowSpy?$window.pageYOffset:scrollEl.prop("scrollTop"))||0,viewportHeight=Math.max($window.innerHeight,docEl.prop("clientHeight")),scrollTop<sortedElements[0].offsetTop&&activeTarget!==sortedElements[0].target)return $scrollspy.$activateElement(sortedElements[0]);for(var i=sortedElements.length;i--;)if(!angular.isUndefined(sortedElements[i].offsetTop)&&null!==sortedElements[i].offsetTop&&activeTarget!==sortedElements[i].target&&!(scrollTop<sortedElements[i].offsetTop||sortedElements[i+1]&&scrollTop>sortedElements[i+1].offsetTop))return $scrollspy.$activateElement(sortedElements[i]);
}},$scrollspy.checkPositionWithEventLoop=function(){setTimeout($scrollspy.checkPosition,1)},$scrollspy.$activateElement=function(element){if(activeTarget){var activeElement=$scrollspy.$getTrackedElement(activeTarget);activeElement&&(activeElement.source.removeClass("active"),nodeName(activeElement.source,"li")&&nodeName(activeElement.source.parent().parent(),"li")&&activeElement.source.parent().parent().removeClass("active"))}activeTarget=element.target,element.source.addClass("active"),nodeName(element.source,"li")&&nodeName(element.source.parent().parent(),"li")&&element.source.parent().parent().addClass("active")},$scrollspy.$getTrackedElement=function(target){return trackedElements.filter(function(obj){return obj.target===target})[0]},$scrollspy.checkOffsets=function(){angular.forEach(trackedElements,function(trackedElement){var targetElement=document.querySelector(trackedElement.target);trackedElement.offsetTop=targetElement?dimensions.offset(targetElement).top:null,options.offset&&null!==trackedElement.offsetTop&&(trackedElement.offsetTop-=1*options.offset)}),sortedElements=trackedElements.filter(function(el){return null!==el.offsetTop}).sort(function(a,b){return a.offsetTop-b.offsetTop}),debouncedCheckPosition()},$scrollspy.trackElement=function(target,source){trackedElements.push({target:target,source:source})},$scrollspy.untrackElement=function(target,source){for(var toDelete,i=trackedElements.length;i--;)if(trackedElements[i].target===target&&trackedElements[i].source===source){toDelete=i;break}trackedElements.splice(toDelete,1)},$scrollspy.activate=function(i){trackedElements[i].addClass("active")},$scrollspy.init(),$scrollspy}var windowEl=angular.element($window),docEl=angular.element($document.prop("documentElement")),bodyEl=angular.element($window.document.body);return ScrollSpyFactory}]}).directive("bsScrollspy",["$rootScope","debounce","dimensions","$scrollspy",function($rootScope,debounce,dimensions,$scrollspy){return{restrict:"EAC",link:function(scope,element,attr){var options={scope:scope};angular.forEach(["offset","target"],function(key){angular.isDefined(attr[key])&&(options[key]=attr[key])});var scrollspy=$scrollspy(options);scrollspy.trackElement(options.target,element),scope.$on("$destroy",function(){scrollspy&&(scrollspy.untrackElement(options.target,element),scrollspy.destroy()),options=null,scrollspy=null})}}}]).directive("bsScrollspyList",["$rootScope","debounce","dimensions","$scrollspy",function($rootScope,debounce,dimensions,$scrollspy){return{restrict:"A",compile:function(element,attr){var children=element[0].querySelectorAll("li > a[href]");angular.forEach(children,function(child){var childEl=angular.element(child);childEl.parent().attr("bs-scrollspy","").attr("data-target",childEl.attr("href"))})}}}]),angular.module("mgcrea.ngStrap.popover",["mgcrea.ngStrap.tooltip"]).provider("$popover",function(){var defaults=this.defaults={animation:"am-fade",customClass:"",container:!1,target:!1,placement:"right",templateUrl:"popover/popover.tpl.html",contentTemplate:!1,trigger:"click",keyboard:!0,html:!1,title:"",content:"",delay:0,autoClose:!1};this.$get=["$tooltip",function($tooltip){function PopoverFactory(element,config){var options=angular.extend({},defaults,config),$popover=$tooltip(element,options);return options.content&&($popover.$scope.content=options.content),$popover}return PopoverFactory}]}).directive("bsPopover",["$window","$sce","$popover",function($window,$sce,$popover){var requestAnimationFrame=$window.requestAnimationFrame||$window.setTimeout;return{restrict:"EAC",scope:!0,link:function(scope,element,attr){var popover,options={scope:scope};angular.forEach(["template","templateUrl","controller","controllerAs","contentTemplate","placement","container","delay","trigger","html","animation","customClass","autoClose","id","prefixClass","prefixEvent"],function(key){angular.isDefined(attr[key])&&(options[key]=attr[key])});var falseValueRegExp=/^(false|0|)$/i;angular.forEach(["html","container","autoClose"],function(key){angular.isDefined(attr[key])&&falseValueRegExp.test(attr[key])&&(options[key]=!1)});var dataTarget=element.attr("data-target");angular.isDefined(dataTarget)&&(falseValueRegExp.test(dataTarget)?options.target=!1:options.target=dataTarget),angular.forEach(["title","content"],function(key){attr[key]&&attr.$observe(key,function(newValue,oldValue){scope[key]=$sce.trustAsHtml(newValue),angular.isDefined(oldValue)&&requestAnimationFrame(function(){popover&&popover.$applyPlacement()})})}),attr.bsPopover&&scope.$watch(attr.bsPopover,function(newValue,oldValue){angular.isObject(newValue)?angular.extend(scope,newValue):scope.content=newValue,angular.isDefined(oldValue)&&requestAnimationFrame(function(){popover&&popover.$applyPlacement()})},!0),attr.bsShow&&scope.$watch(attr.bsShow,function(newValue,oldValue){popover&&angular.isDefined(newValue)&&(angular.isString(newValue)&&(newValue=!!newValue.match(/true|,?(popover),?/i)),newValue===!0?popover.show():popover.hide())}),attr.viewport&&scope.$watch(attr.viewport,function(newValue){popover&&angular.isDefined(newValue)&&popover.setViewport(newValue)}),popover=$popover(element,options),scope.$on("$destroy",function(){popover&&popover.destroy(),options=null,popover=null})}}}]),angular.module("mgcrea.ngStrap.navbar",[]).provider("$navbar",function(){var defaults=this.defaults={activeClass:"active",routeAttr:"data-match-route",strict:!1};this.$get=function(){return{defaults:defaults}}}).directive("bsNavbar",["$window","$location","$navbar",function($window,$location,$navbar){var defaults=$navbar.defaults;return{restrict:"A",link:function(scope,element,attr,controller){var options=angular.copy(defaults);angular.forEach(Object.keys(defaults),function(key){angular.isDefined(attr[key])&&(options[key]=attr[key])}),scope.$watch(function(){return $location.path()},function(newValue,oldValue){var liElements=element[0].querySelectorAll("li["+options.routeAttr+"]");angular.forEach(liElements,function(li){var liElement=angular.element(li),pattern=liElement.attr(options.routeAttr).replace("/","\\/");options.strict&&(pattern="^"+pattern+"$");var regexp=new RegExp(pattern,"i");regexp.test(newValue)?liElement.addClass(options.activeClass):liElement.removeClass(options.activeClass)})})}}}]),angular.module("mgcrea.ngStrap.dropdown",["mgcrea.ngStrap.tooltip"]).provider("$dropdown",function(){var defaults=this.defaults={animation:"am-fade",prefixClass:"dropdown",prefixEvent:"dropdown",placement:"bottom-left",templateUrl:"dropdown/dropdown.tpl.html",trigger:"click",container:!1,keyboard:!0,html:!1,delay:0};this.$get=["$window","$rootScope","$tooltip","$timeout",function($window,$rootScope,$tooltip,$timeout){function DropdownFactory(element,config){function onBodyClick(evt){if(evt.target!==element[0])return evt.target!==element[0]&&$dropdown.hide()}var $dropdown={},options=angular.extend({},defaults,config);$dropdown.$scope=options.scope&&options.scope.$new()||$rootScope.$new(),$dropdown=$tooltip(element,options);var parentEl=element.parent();$dropdown.$onKeyDown=function(evt){if(/(38|40)/.test(evt.keyCode)){evt.preventDefault(),evt.stopPropagation();var items=angular.element($dropdown.$element[0].querySelectorAll("li:not(.divider) a"));if(items.length){var index;angular.forEach(items,function(el,i){matchesSelector&&matchesSelector.call(el,":focus")&&(index=i)}),38===evt.keyCode&&index>0?index--:40===evt.keyCode&&index<items.length-1?index++:angular.isUndefined(index)&&(index=0),items.eq(index)[0].focus()}}};var show=$dropdown.show;$dropdown.show=function(){show(),$timeout(function(){options.keyboard&&$dropdown.$element&&$dropdown.$element.on("keydown",$dropdown.$onKeyDown),bodyEl.on("click",onBodyClick)},0,!1),parentEl.hasClass("dropdown")&&parentEl.addClass("open")};var hide=$dropdown.hide;$dropdown.hide=function(){$dropdown.$isShown&&(options.keyboard&&$dropdown.$element&&$dropdown.$element.off("keydown",$dropdown.$onKeyDown),bodyEl.off("click",onBodyClick),parentEl.hasClass("dropdown")&&parentEl.removeClass("open"),hide())};var destroy=$dropdown.destroy;return $dropdown.destroy=function(){bodyEl.off("click",onBodyClick),destroy()},$dropdown}var bodyEl=angular.element($window.document.body),matchesSelector=Element.prototype.matchesSelector||Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector;return DropdownFactory}]}).directive("bsDropdown",["$window","$sce","$dropdown",function($window,$sce,$dropdown){return{restrict:"EAC",scope:!0,compile:function(tElement,tAttrs){if(!tAttrs.bsDropdown){for(var nextSibling=tElement[0].nextSibling;nextSibling&&1!==nextSibling.nodeType;)nextSibling=nextSibling.nextSibling;nextSibling&&nextSibling.className.split(" ").indexOf("dropdown-menu")>=0&&(tAttrs.template=nextSibling.outerHTML,tAttrs.templateUrl=undefined,nextSibling.parentNode.removeChild(nextSibling))}return function(scope,element,attr){var options={scope:scope};angular.forEach(["template","templateUrl","controller","controllerAs","placement","container","delay","trigger","keyboard","html","animation","id","autoClose"],function(key){angular.isDefined(tAttrs[key])&&(options[key]=tAttrs[key])});var falseValueRegExp=/^(false|0|)$/i;angular.forEach(["html","container"],function(key){angular.isDefined(attr[key])&&falseValueRegExp.test(attr[key])&&(options[key]=!1)}),attr.bsDropdown&&scope.$watch(attr.bsDropdown,function(newValue,oldValue){scope.content=newValue},!0);var dropdown=$dropdown(element,options);attr.bsShow&&scope.$watch(attr.bsShow,function(newValue,oldValue){dropdown&&angular.isDefined(newValue)&&(angular.isString(newValue)&&(newValue=!!newValue.match(/true|,?(dropdown),?/i)),newValue===!0?dropdown.show():dropdown.hide())}),scope.$on("$destroy",function(){dropdown&&dropdown.destroy(),options=null,dropdown=null})}}}}]),angular.module("mgcrea.ngStrap.modal",["mgcrea.ngStrap.core","mgcrea.ngStrap.helpers.dimensions"]).provider("$modal",function(){var defaults=this.defaults={animation:"am-fade",backdropAnimation:"am-fade",customClass:"",prefixClass:"modal",prefixEvent:"modal",placement:"top",templateUrl:"modal/modal.tpl.html",template:"",contentTemplate:!1,container:!1,element:null,backdrop:!0,keyboard:!0,html:!1,show:!0,size:null};this.$get=["$window","$rootScope","$bsCompiler","$animate","$timeout","$sce","dimensions",function($window,$rootScope,$bsCompiler,$animate,$timeout,$sce,dimensions){function ModalFactory(config){function enterAnimateCallback(){scope.$emit(options.prefixEvent+".show",$modal)}function leaveAnimateCallback(){scope.$emit(options.prefixEvent+".hide",$modal),bodyElement.removeClass(options.prefixClass+"-open"),options.animation&&bodyElement.removeClass(options.prefixClass+"-with-"+options.animation)}function bindBackdropEvents(){options.backdrop&&(modalElement.on("click",hideOnBackdropClick),backdropElement.on("click",hideOnBackdropClick),backdropElement.on("wheel",preventEventDefault))}function unbindBackdropEvents(){options.backdrop&&(modalElement.off("click",hideOnBackdropClick),backdropElement.off("click",hideOnBackdropClick),backdropElement.off("wheel",preventEventDefault))}function bindKeyboardEvents(){options.keyboard&&modalElement.on("keyup",$modal.$onKeyUp)}function unbindKeyboardEvents(){options.keyboard&&modalElement.off("keyup",$modal.$onKeyUp)}function hideOnBackdropClick(evt){evt.target===evt.currentTarget&&("static"===options.backdrop?$modal.focus():$modal.hide())}function preventEventDefault(evt){evt.preventDefault()}function destroyModalElement(){$modal.$isShown&&null!==modalElement&&(unbindBackdropEvents(),unbindKeyboardEvents()),modalScope&&(modalScope.$destroy(),modalScope=null),modalElement&&(modalElement.remove(),modalElement=$modal.$element=null)}var $modal={},options=$modal.$options=angular.extend({},defaults,config),promise=$modal.$promise=$bsCompiler.compile(options),scope=$modal.$scope=options.scope&&options.scope.$new()||$rootScope.$new();options.element||options.container||(options.container="body"),$modal.$id=options.id||options.element&&options.element.attr("id")||"",forEach(["title","content"],function(key){options[key]&&(scope[key]=$sce.trustAsHtml(options[key]))}),scope.$hide=function(){scope.$$postDigest(function(){$modal.hide()})},scope.$show=function(){scope.$$postDigest(function(){$modal.show()})},scope.$toggle=function(){scope.$$postDigest(function(){$modal.toggle()})},$modal.$isShown=scope.$isShown=!1;var compileData,modalElement,modalScope,backdropElement=angular.element('<div class="'+options.prefixClass+'-backdrop"/>');return backdropElement.css({position:"fixed",top:"0px",left:"0px",bottom:"0px",right:"0px"}),promise.then(function(data){compileData=data,$modal.init()}),$modal.init=function(){options.show&&scope.$$postDigest(function(){$modal.show()})},$modal.destroy=function(){destroyModalElement(),backdropElement&&(backdropElement.remove(),backdropElement=null),scope.$destroy()},$modal.show=function(){if(!$modal.$isShown){var parent,after;if(angular.isElement(options.container)?(parent=options.container,after=options.container[0].lastChild?angular.element(options.container[0].lastChild):null):options.container?(parent=findElement(options.container),after=parent[0]&&parent[0].lastChild?angular.element(parent[0].lastChild):null):(parent=null,after=options.element),modalElement&&destroyModalElement(),modalScope=$modal.$scope.$new(),modalElement=$modal.$element=compileData.link(modalScope,function(clonedElement,scope){}),options.backdrop&&(modalElement.css({"z-index":dialogBaseZindex+20*backdropCount}),backdropElement.css({"z-index":backdropBaseZindex+20*backdropCount}),backdropCount++),!scope.$emit(options.prefixEvent+".show.before",$modal).defaultPrevented){modalElement.css({display:"block"}).addClass(options.placement),options.customClass&&modalElement.addClass(options.customClass),options.size&&validSizes[options.size]&&angular.element(findElement(".modal-dialog",modalElement[0])).addClass(validSizes[options.size]),options.animation&&(options.backdrop&&backdropElement.addClass(options.backdropAnimation),modalElement.addClass(options.animation)),options.backdrop&&$animate.enter(backdropElement,bodyElement,null),angular.version.minor<=2?$animate.enter(modalElement,parent,after,enterAnimateCallback):$animate.enter(modalElement,parent,after).then(enterAnimateCallback),$modal.$isShown=scope.$isShown=!0,safeDigest(scope);var el=modalElement[0];requestAnimationFrame(function(){el.focus()}),bodyElement.addClass(options.prefixClass+"-open"),options.animation&&bodyElement.addClass(options.prefixClass+"-with-"+options.animation),bindBackdropEvents(),bindKeyboardEvents()}}},$modal.hide=function(){$modal.$isShown&&(options.backdrop&&backdropCount--,scope.$emit(options.prefixEvent+".hide.before",$modal).defaultPrevented||(angular.version.minor<=2?$animate.leave(modalElement,leaveAnimateCallback):$animate.leave(modalElement).then(leaveAnimateCallback),options.backdrop&&$animate.leave(backdropElement),$modal.$isShown=scope.$isShown=!1,safeDigest(scope),unbindBackdropEvents(),unbindKeyboardEvents()))},$modal.toggle=function(){$modal.$isShown?$modal.hide():$modal.show()},$modal.focus=function(){modalElement[0].focus()},$modal.$onKeyUp=function(evt){27===evt.which&&$modal.$isShown&&($modal.hide(),evt.stopPropagation())},$modal}function safeDigest(scope){scope.$$phase||scope.$root&&scope.$root.$$phase||scope.$digest()}function findElement(query,element){return angular.element((element||document).querySelectorAll(query))}var forEach=angular.forEach,requestAnimationFrame=$window.requestAnimationFrame||$window.setTimeout,bodyElement=angular.element($window.document.body),backdropCount=0,dialogBaseZindex=1050,backdropBaseZindex=1040,validSizes={lg:"modal-lg",sm:"modal-sm"};return ModalFactory}]}).directive("bsModal",["$window","$sce","$modal",function($window,$sce,$modal){return{restrict:"EAC",scope:!0,link:function(scope,element,attr,transclusion){var options={scope:scope,element:element,show:!1};angular.forEach(["template","templateUrl","controller","controllerAs","contentTemplate","placement","backdrop","keyboard","html","container","animation","backdropAnimation","id","prefixEvent","prefixClass","customClass","modalClass","size"],function(key){angular.isDefined(attr[key])&&(options[key]=attr[key])}),options.modalClass&&(options.customClass=options.modalClass);var falseValueRegExp=/^(false|0|)$/i;angular.forEach(["backdrop","keyboard","html","container"],function(key){angular.isDefined(attr[key])&&falseValueRegExp.test(attr[key])&&(options[key]=!1)}),angular.forEach(["title","content"],function(key){attr[key]&&attr.$observe(key,function(newValue,oldValue){scope[key]=$sce.trustAsHtml(newValue)})}),attr.bsModal&&scope.$watch(attr.bsModal,function(newValue,oldValue){angular.isObject(newValue)?angular.extend(scope,newValue):scope.content=newValue},!0);var modal=$modal(options);element.on(attr.trigger||"click",modal.toggle),scope.$on("$destroy",function(){modal&&modal.destroy(),options=null,modal=null})}}}]),angular.version.minor<3&&angular.version.dot<14&&angular.module("ng").factory("$$rAF",["$window","$timeout",function($window,$timeout){var requestAnimationFrame=$window.requestAnimationFrame||$window.webkitRequestAnimationFrame||$window.mozRequestAnimationFrame,cancelAnimationFrame=$window.cancelAnimationFrame||$window.webkitCancelAnimationFrame||$window.mozCancelAnimationFrame||$window.webkitCancelRequestAnimationFrame,rafSupported=!!requestAnimationFrame,raf=rafSupported?function(fn){var id=requestAnimationFrame(fn);return function(){cancelAnimationFrame(id)}}:function(fn){var timer=$timeout(fn,16.66,!1);return function(){$timeout.cancel(timer)}};return raf.supported=rafSupported,raf}]),angular.module("mgcrea.ngStrap.helpers.parseOptions",[]).provider("$parseOptions",function(){var defaults=this.defaults={regexp:/^\s*(.*?)(?:\s+as\s+(.*?))?(?:\s+group\s+by\s+(.*))?\s+for\s+(?:([\$\w][\$\w]*)|(?:\(\s*([\$\w][\$\w]*)\s*,\s*([\$\w][\$\w]*)\s*\)))\s+in\s+(.*?)(?:\s+track\s+by\s+(.*?))?$/};this.$get=["$parse","$q",function($parse,$q){function ParseOptionsFactory(attr,config){function parseValues(values,scope){return values.map(function(match,index){var label,value,locals={};return locals[valueName]=match,label=displayFn(scope,locals),value=valueFn(scope,locals),{label:label,value:value,index:index}})}var $parseOptions={},options=angular.extend({},defaults,config);$parseOptions.$values=[];var match,displayFn,valueName,keyName,groupByFn,valueFn,valuesFn;return $parseOptions.init=function(){$parseOptions.$match=match=attr.match(options.regexp),displayFn=$parse(match[2]||match[1]),valueName=match[4]||match[6],keyName=match[5],groupByFn=$parse(match[3]||""),valueFn=$parse(match[2]?match[1]:valueName),valuesFn=$parse(match[7])},$parseOptions.valuesFn=function(scope,controller){return $q.when(valuesFn(scope,controller)).then(function(values){return angular.isArray(values)||(values=[]),$parseOptions.$values=values.length?parseValues(values,scope):[],$parseOptions.$values})},$parseOptions.displayValue=function(modelValue){var scope={};return scope[valueName]=modelValue,displayFn(scope)},$parseOptions.init(),$parseOptions}return ParseOptionsFactory}]}),angular.module("mgcrea.ngStrap.helpers.dimensions",[]).factory("dimensions",function(){function offsetParentElement(element){var docElement=element.ownerDocument,offsetParent=element.offsetParent||docElement;if(nodeName(offsetParent,"#document"))return docElement.documentElement;for(;offsetParent&&!nodeName(offsetParent,"html")&&"static"===fn.css(offsetParent,"position");)offsetParent=offsetParent.offsetParent;return offsetParent||docElement.documentElement}var fn={},nodeName=fn.nodeName=function(element,name){return element.nodeName&&element.nodeName.toLowerCase()===name.toLowerCase()};return fn.css=function(element,prop,extra){var value;return value=element.currentStyle?element.currentStyle[prop]:window.getComputedStyle?window.getComputedStyle(element)[prop]:element.style[prop],extra===!0?parseFloat(value)||0:value},fn.offset=function(element){var boxRect=element.getBoundingClientRect(),docElement=element.ownerDocument;return{width:boxRect.width||element.offsetWidth,height:boxRect.height||element.offsetHeight,top:boxRect.top+(window.pageYOffset||docElement.documentElement.scrollTop)-(docElement.documentElement.clientTop||0),left:boxRect.left+(window.pageXOffset||docElement.documentElement.scrollLeft)-(docElement.documentElement.clientLeft||0)}},fn.setOffset=function(element,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=fn.css(element,"position"),curElem=angular.element(element),props={};"static"===position&&(element.style.position="relative"),curOffset=fn.offset(element),curCSSTop=fn.css(element,"top"),curCSSLeft=fn.css(element,"left"),calculatePosition=("absolute"===position||"fixed"===position)&&(curCSSTop+curCSSLeft).indexOf("auto")>-1,calculatePosition?(curPosition=fn.position(element),curTop=curPosition.top,curLeft=curPosition.left):(curTop=parseFloat(curCSSTop)||0,curLeft=parseFloat(curCSSLeft)||0),angular.isFunction(options)&&(options=options.call(element,i,curOffset)),null!==options.top&&(props.top=options.top-curOffset.top+curTop),null!==options.left&&(props.left=options.left-curOffset.left+curLeft),"using"in options?options.using.call(curElem,props):curElem.css({top:props.top+"px",left:props.left+"px"})},fn.position=function(element){var offsetParentEl,offset,offsetParentRect={top:0,left:0};return"fixed"===fn.css(element,"position")?offset=element.getBoundingClientRect():(offsetParentEl=offsetParentElement(element),offset=fn.offset(element),nodeName(offsetParentEl,"html")||(offsetParentRect=fn.offset(offsetParentEl)),offsetParentRect.top+=fn.css(offsetParentEl,"borderTopWidth",!0),offsetParentRect.left+=fn.css(offsetParentEl,"borderLeftWidth",!0)),{width:element.offsetWidth,height:element.offsetHeight,top:offset.top-offsetParentRect.top-fn.css(element,"marginTop",!0),left:offset.left-offsetParentRect.left-fn.css(element,"marginLeft",!0)}},fn.height=function(element,outer){var value=element.offsetHeight;return outer?value+=fn.css(element,"marginTop",!0)+fn.css(element,"marginBottom",!0):value-=fn.css(element,"paddingTop",!0)+fn.css(element,"paddingBottom",!0)+fn.css(element,"borderTopWidth",!0)+fn.css(element,"borderBottomWidth",!0),value},fn.width=function(element,outer){var value=element.offsetWidth;return outer?value+=fn.css(element,"marginLeft",!0)+fn.css(element,"marginRight",!0):value-=fn.css(element,"paddingLeft",!0)+fn.css(element,"paddingRight",!0)+fn.css(element,"borderLeftWidth",!0)+fn.css(element,"borderRightWidth",!0),value},fn}),angular.module("mgcrea.ngStrap.helpers.debounce",[]).factory("debounce",["$timeout",function($timeout){return function(func,wait,immediate){var timeout=null;return function(){var context=this,args=arguments,callNow=immediate&&!timeout;return timeout&&$timeout.cancel(timeout),timeout=$timeout(function(){timeout=null,immediate||func.apply(context,args)},wait,!1),callNow&&func.apply(context,args),timeout}}}]).factory("throttle",["$timeout",function($timeout){return function(func,wait,options){var timeout=null;return options||(options={}),function(){var context=this,args=arguments;timeout||(options.leading!==!1&&func.apply(context,args),timeout=$timeout(function(){timeout=null,options.trailing!==!1&&func.apply(context,args)},wait,!1))}}}]),angular.module("mgcrea.ngStrap.helpers.dateParser",[]).provider("$dateParser",["$localeProvider",function($localeProvider){function ParseDate(){this.year=1970,this.month=0,this.day=1,this.hours=0,this.minutes=0,this.seconds=0,this.milliseconds=0}function noop(){}function isNumeric(n){return!isNaN(parseFloat(n))&&isFinite(n)}function indexOfCaseInsensitive(array,value){for(var len=array.length,str=value.toString().toLowerCase(),i=0;i<len;i++)if(array[i].toLowerCase()===str)return i;return-1}ParseDate.prototype.setMilliseconds=function(value){this.milliseconds=value},ParseDate.prototype.setSeconds=function(value){this.seconds=value},ParseDate.prototype.setMinutes=function(value){this.minutes=value},ParseDate.prototype.setHours=function(value){this.hours=value},ParseDate.prototype.getHours=function(){return this.hours},ParseDate.prototype.setDate=function(value){this.day=value},ParseDate.prototype.setMonth=function(value){this.month=value},ParseDate.prototype.setFullYear=function(value){this.year=value},ParseDate.prototype.fromDate=function(value){return this.year=value.getFullYear(),this.month=value.getMonth(),this.day=value.getDate(),this.hours=value.getHours(),this.minutes=value.getMinutes(),this.seconds=value.getSeconds(),this.milliseconds=value.getMilliseconds(),this},ParseDate.prototype.toDate=function(){return new Date(this.year,this.month,this.day,this.hours,this.minutes,this.seconds,this.milliseconds)};var proto=ParseDate.prototype,defaults=this.defaults={format:"shortDate",strict:!1};this.$get=["$locale","dateFilter",function($locale,dateFilter){var DateParserFactory=function(config){function regExpForFormat(format){var re=buildDateAbstractRegex(format);return buildDateParseRegex(re)}function buildDateAbstractRegex(format){var escapedFormat=escapeReservedSymbols(format),escapedLiteralFormat=escapedFormat.replace(/''/g,"\\'"),literalRegex=/('(?:\\'|.)*?')/,formatParts=escapedLiteralFormat.split(literalRegex),dateElements=Object.keys(regExpMap),dateRegexParts=[];return angular.forEach(formatParts,function(part){if(isFormatStringLiteral(part))part=trimLiteralEscapeChars(part);else for(var i=0;i<dateElements.length;i++)part=part.split(dateElements[i]).join("${"+i+"}");dateRegexParts.push(part)}),dateRegexParts.join("")}function escapeReservedSymbols(text){return text.replace(/\\/g,"[\\\\]").replace(/-/g,"[-]").replace(/\./g,"[.]").replace(/\*/g,"[*]").replace(/\+/g,"[+]").replace(/\?/g,"[?]").replace(/\$/g,"[$]").replace(/\^/g,"[^]").replace(/\//g,"[/]").replace(/\\s/g,"[\\s]")}function isFormatStringLiteral(text){return/^'.*'$/.test(text)}function trimLiteralEscapeChars(text){return text.replace(/^'(.*)'$/,"$1")}function buildDateParseRegex(abstractRegex){for(var dateElements=Object.keys(regExpMap),re=abstractRegex,i=0;i<dateElements.length;i++)re=re.split("${"+i+"}").join("("+regExpMap[dateElements[i]]+")");return new RegExp("^"+re+"$",["i"])}function setMapForFormat(format){var re=buildDateAbstractRegex(format);return buildDateParseValuesMap(re)}function buildDateParseValuesMap(abstractRegex){for(var valuesMatch,keyIndex,valueKey,valueFunction,dateElements=Object.keys(regExpMap),valuesRegex=new RegExp("\\${(\\d+)}","g"),valuesFunctionMap=[];null!==(valuesMatch=valuesRegex.exec(abstractRegex));)keyIndex=valuesMatch[1],valueKey=dateElements[keyIndex],valueFunction=setFnMap[valueKey],valuesFunctionMap.push(valueFunction);return valuesFunctionMap}var regex,setMap,options=angular.extend({},defaults,config),$dateParser={},regExpMap={sss:"[0-9]{3}",ss:"[0-5][0-9]",s:options.strict?"[1-5]?[0-9]":"[0-9]|[0-5][0-9]",mm:"[0-5][0-9]",m:options.strict?"[1-5]?[0-9]":"[0-9]|[0-5][0-9]",HH:"[01][0-9]|2[0-3]",H:options.strict?"1?[0-9]|2[0-3]":"[01]?[0-9]|2[0-3]",hh:"[0][1-9]|[1][012]",h:options.strict?"[1-9]|1[012]":"0?[1-9]|1[012]",a:"AM|PM",EEEE:$locale.DATETIME_FORMATS.DAY.join("|"),EEE:$locale.DATETIME_FORMATS.SHORTDAY.join("|"),dd:"0[1-9]|[12][0-9]|3[01]",d:options.strict?"[1-9]|[1-2][0-9]|3[01]":"0?[1-9]|[1-2][0-9]|3[01]",MMMM:$locale.DATETIME_FORMATS.MONTH.join("|"),MMM:$locale.DATETIME_FORMATS.SHORTMONTH.join("|"),MM:"0[1-9]|1[012]",M:options.strict?"[1-9]|1[012]":"0?[1-9]|1[012]",yyyy:"[1]{1}[0-9]{3}|[2]{1}[0-9]{3}",yy:"[0-9]{2}",y:options.strict?"-?(0|[1-9][0-9]{0,3})":"-?0*[0-9]{1,4}"},setFnMap={sss:proto.setMilliseconds,ss:proto.setSeconds,s:proto.setSeconds,mm:proto.setMinutes,m:proto.setMinutes,HH:proto.setHours,H:proto.setHours,hh:proto.setHours,h:proto.setHours,EEEE:noop,EEE:noop,dd:proto.setDate,d:proto.setDate,a:function(value){var hours=this.getHours()%12;return this.setHours(value.match(/pm/i)?hours+12:hours)},MMMM:function(value){return this.setMonth(indexOfCaseInsensitive($locale.DATETIME_FORMATS.MONTH,value))},MMM:function(value){return this.setMonth(indexOfCaseInsensitive($locale.DATETIME_FORMATS.SHORTMONTH,value))},MM:function(value){return this.setMonth(1*value-1)},M:function(value){return this.setMonth(1*value-1)},yyyy:proto.setFullYear,yy:function(value){return this.setFullYear(2e3+1*value)},y:function(value){return 1*value<=50&&2===value.length?this.setFullYear(2e3+1*value):this.setFullYear(1*value)}};return $dateParser.init=function(){$dateParser.$format=$locale.DATETIME_FORMATS[options.format]||options.format,regex=regExpForFormat($dateParser.$format),setMap=setMapForFormat($dateParser.$format)},$dateParser.isValid=function(date){return angular.isDate(date)?!isNaN(date.getTime()):regex.test(date)},$dateParser.parse=function(value,baseDate,format,timezone){format&&(format=$locale.DATETIME_FORMATS[format]||format),angular.isDate(value)&&(value=dateFilter(value,format||$dateParser.$format,timezone));var formatRegex=format?regExpForFormat(format):regex,formatSetMap=format?setMapForFormat(format):setMap,matches=formatRegex.exec(value);if(!matches)return!1;for(var date=baseDate&&!isNaN(baseDate.getTime())?(new ParseDate).fromDate(baseDate):(new ParseDate).fromDate(new Date(1970,0,1,0)),i=0;i<matches.length-1;i++)formatSetMap[i]&&formatSetMap[i].call(date,matches[i+1]);var newDate=date.toDate();return parseInt(date.day,10)===newDate.getDate()&&newDate},$dateParser.getDateForAttribute=function(key,value){var date;if("today"===value){var today=new Date;date=new Date(today.getFullYear(),today.getMonth(),today.getDate()+("maxDate"===key?1:0),0,0,0,"minDate"===key?0:-1)}else date=angular.isString(value)&&value.match(/^".+"$/)?new Date(value.substr(1,value.length-2)):isNumeric(value)?new Date(parseInt(value,10)):angular.isString(value)&&0===value.length?"minDate"===key?-(1/0):+(1/0):new Date(value);return date},$dateParser.getTimeForAttribute=function(key,value){var time;return time="now"===value?(new Date).setFullYear(1970,0,1):angular.isString(value)&&value.match(/^".+"$/)?new Date(value.substr(1,value.length-2)).setFullYear(1970,0,1):isNumeric(value)?new Date(parseInt(value,10)).setFullYear(1970,0,1):angular.isString(value)&&0===value.length?"minTime"===key?-(1/0):+(1/0):$dateParser.parse(value,new Date(1970,0,1,0))},$dateParser.daylightSavingAdjust=function(date){return date?(date.setHours(date.getHours()>12?date.getHours()+2:0),date):null},$dateParser.timezoneOffsetAdjust=function(date,timezone,undo){return date?(timezone&&"UTC"===timezone&&(date=new Date(date.getTime()),date.setMinutes(date.getMinutes()+(undo?-1:1)*date.getTimezoneOffset())),date):null},$dateParser.init(),$dateParser};return DateParserFactory}]}]),angular.module("mgcrea.ngStrap.helpers.dateFormatter",[]).service("$dateFormatter",["$locale","dateFilter",function($locale,dateFilter){function splitTimeFormat(format){return/(h+)([:\.])?(m+)([:\.])?(s*)[ ]?(a?)/i.exec(format).slice(1)}this.getDefaultLocale=function(){return $locale.id},this.getDatetimeFormat=function(format,lang){return $locale.DATETIME_FORMATS[format]||format},this.weekdaysShort=function(lang){return $locale.DATETIME_FORMATS.SHORTDAY},this.hoursFormat=function(timeFormat){return splitTimeFormat(timeFormat)[0]},this.minutesFormat=function(timeFormat){return splitTimeFormat(timeFormat)[2]},this.secondsFormat=function(timeFormat){return splitTimeFormat(timeFormat)[4]},this.timeSeparator=function(timeFormat){return splitTimeFormat(timeFormat)[1]},this.showSeconds=function(timeFormat){return!!splitTimeFormat(timeFormat)[4]},this.showAM=function(timeFormat){return!!splitTimeFormat(timeFormat)[5]},this.formatDate=function(date,format,lang,timezone){return dateFilter(date,format,timezone)}}]),angular.module("mgcrea.ngStrap.core",[]).service("$bsCompiler",bsCompilerService),angular.module("mgcrea.ngStrap.datepicker",["mgcrea.ngStrap.helpers.dateParser","mgcrea.ngStrap.helpers.dateFormatter","mgcrea.ngStrap.tooltip"]).provider("$datepicker",function(){
var defaults=this.defaults={animation:"am-fade",prefixClass:"datepicker",placement:"bottom-left",templateUrl:"datepicker/datepicker.tpl.html",trigger:"focus",container:!1,keyboard:!0,html:!1,delay:0,useNative:!1,dateType:"date",dateFormat:"shortDate",timezone:null,modelDateFormat:null,dayFormat:"dd",monthFormat:"MMM",yearFormat:"yyyy",monthTitleFormat:"MMMM yyyy",yearTitleFormat:"yyyy",strictFormat:!1,autoclose:!1,minDate:-(1/0),maxDate:+(1/0),startView:0,minView:0,startWeek:0,daysOfWeekDisabled:"",iconLeft:"glyphicon glyphicon-chevron-left",iconRight:"glyphicon glyphicon-chevron-right"};this.$get=["$window","$document","$rootScope","$sce","$dateFormatter","datepickerViews","$tooltip","$timeout",function($window,$document,$rootScope,$sce,$dateFormatter,datepickerViews,$tooltip,$timeout){function DatepickerFactory(element,controller,config){function updateSelected(el){el.selected=$datepicker.$isSelected(el.date)}function focusElement(){element[0].focus()}var $datepicker=$tooltip(element,angular.extend({},defaults,config)),parentScope=config.scope,options=$datepicker.$options,scope=$datepicker.$scope;options.startView&&(options.startView-=options.minView);var pickerViews=datepickerViews($datepicker);$datepicker.$views=pickerViews.views;var viewDate=pickerViews.viewDate;scope.$mode=options.startView,scope.$iconLeft=options.iconLeft,scope.$iconRight=options.iconRight;var $picker=$datepicker.$views[scope.$mode];scope.$select=function(date){$datepicker.select(date)},scope.$selectPane=function(value){$datepicker.$selectPane(value)},scope.$toggleMode=function(){$datepicker.setMode((scope.$mode+1)%$datepicker.$views.length)},$datepicker.update=function(date){angular.isDate(date)&&!isNaN(date.getTime())&&($datepicker.$date=date,$picker.update.call($picker,date)),$datepicker.$build(!0)},$datepicker.updateDisabledDates=function(dateRanges){options.disabledDateRanges=dateRanges;for(var i=0,l=scope.rows.length;i<l;i++)angular.forEach(scope.rows[i],$datepicker.$setDisabledEl)},$datepicker.select=function(date,keep){angular.isDate(controller.$dateValue)||(controller.$dateValue=new Date(date)),!scope.$mode||keep?(controller.$setViewValue(angular.copy(date)),controller.$render(),options.autoclose&&!keep&&$timeout(function(){$datepicker.hide(!0)})):(angular.extend(viewDate,{year:date.getFullYear(),month:date.getMonth(),date:date.getDate()}),$datepicker.setMode(scope.$mode-1),$datepicker.$build())},$datepicker.setMode=function(mode){scope.$mode=mode,$picker=$datepicker.$views[scope.$mode],$datepicker.$build()},$datepicker.$build=function(pristine){pristine===!0&&$picker.built||(pristine!==!1||$picker.built)&&$picker.build.call($picker)},$datepicker.$updateSelected=function(){for(var i=0,l=scope.rows.length;i<l;i++)angular.forEach(scope.rows[i],updateSelected)},$datepicker.$isSelected=function(date){return $picker.isSelected(date)},$datepicker.$setDisabledEl=function(el){el.disabled=$picker.isDisabled(el.date)},$datepicker.$selectPane=function(value){var steps=$picker.steps,targetDate=new Date(Date.UTC(viewDate.year+(steps.year||0)*value,viewDate.month+(steps.month||0)*value,1));angular.extend(viewDate,{year:targetDate.getUTCFullYear(),month:targetDate.getUTCMonth(),date:targetDate.getUTCDate()}),$datepicker.$build()},$datepicker.$onMouseDown=function(evt){if(evt.preventDefault(),evt.stopPropagation(),isTouch){var targetEl=angular.element(evt.target);"button"!==targetEl[0].nodeName.toLowerCase()&&(targetEl=targetEl.parent()),targetEl.triggerHandler("click")}},$datepicker.$onKeyDown=function(evt){if(/(38|37|39|40|13)/.test(evt.keyCode)&&!evt.shiftKey&&!evt.altKey){if(evt.preventDefault(),evt.stopPropagation(),13===evt.keyCode)return void(scope.$mode?scope.$apply(function(){$datepicker.setMode(scope.$mode-1)}):$datepicker.hide(!0));$picker.onKeyDown(evt),parentScope.$digest()}};var _init=$datepicker.init;$datepicker.init=function(){return isNative&&options.useNative?(element.prop("type","date"),void element.css("-webkit-appearance","textfield")):(isTouch&&(element.prop("type","text"),element.attr("readonly","true"),element.on("click",focusElement)),void _init())};var _destroy=$datepicker.destroy;$datepicker.destroy=function(){isNative&&options.useNative&&element.off("click",focusElement),_destroy()};var _show=$datepicker.show;$datepicker.show=function(){!isTouch&&element.attr("readonly")||element.attr("disabled")||(_show(),$timeout(function(){$datepicker.$isShown&&($datepicker.$element.on(isTouch?"touchstart":"mousedown",$datepicker.$onMouseDown),options.keyboard&&element.on("keydown",$datepicker.$onKeyDown))},0,!1))};var _hide=$datepicker.hide;return $datepicker.hide=function(blur){$datepicker.$isShown&&($datepicker.$element.off(isTouch?"touchstart":"mousedown",$datepicker.$onMouseDown),options.keyboard&&element.off("keydown",$datepicker.$onKeyDown),_hide(blur))},$datepicker}var isNative=/(ip[ao]d|iphone|android)/gi.test($window.navigator.userAgent),isTouch="createTouch"in $window.document&&isNative;return defaults.lang||(defaults.lang=$dateFormatter.getDefaultLocale()),DatepickerFactory.defaults=defaults,DatepickerFactory}]}).directive("bsDatepicker",["$window","$parse","$q","$dateFormatter","$dateParser","$datepicker",function($window,$parse,$q,$dateFormatter,$dateParser,$datepicker){var isNative=/(ip[ao]d|iphone|android)/gi.test($window.navigator.userAgent);return{restrict:"EAC",require:"ngModel",link:function(scope,element,attr,controller){function normalizeDateRanges(ranges){return ranges&&ranges.length?ranges:null}function validateAgainstMinMaxDate(parsedDate){if(angular.isDate(parsedDate)){var isMinValid=isNaN(datepicker.$options.minDate)||parsedDate.getTime()>=datepicker.$options.minDate,isMaxValid=isNaN(datepicker.$options.maxDate)||parsedDate.getTime()<=datepicker.$options.maxDate,isValid=isMinValid&&isMaxValid;controller.$setValidity("date",isValid),controller.$setValidity("min",isMinValid),controller.$setValidity("max",isMaxValid),isValid&&(controller.$dateValue=parsedDate)}}function getDateFormattedString(){return!controller.$dateValue||isNaN(controller.$dateValue.getTime())?"":formatDate(controller.$dateValue,options.dateFormat)}var options={scope:scope};angular.forEach(["template","templateUrl","controller","controllerAs","placement","container","delay","trigger","html","animation","autoclose","dateType","dateFormat","timezone","modelDateFormat","dayFormat","strictFormat","startWeek","startDate","useNative","lang","startView","minView","iconLeft","iconRight","daysOfWeekDisabled","id","prefixClass","prefixEvent"],function(key){angular.isDefined(attr[key])&&(options[key]=attr[key])});var falseValueRegExp=/^(false|0|)$/i;angular.forEach(["html","container","autoclose","useNative"],function(key){angular.isDefined(attr[key])&&falseValueRegExp.test(attr[key])&&(options[key]=!1)});var datepicker=$datepicker(element,controller,options);options=datepicker.$options,isNative&&options.useNative&&(options.dateFormat="yyyy-MM-dd");var lang=options.lang,formatDate=function(date,format){return $dateFormatter.formatDate(date,format,lang)},dateParser=$dateParser({format:options.dateFormat,lang:lang,strict:options.strictFormat});attr.bsShow&&scope.$watch(attr.bsShow,function(newValue,oldValue){datepicker&&angular.isDefined(newValue)&&(angular.isString(newValue)&&(newValue=!!newValue.match(/true|,?(datepicker),?/i)),newValue===!0?datepicker.show():datepicker.hide())}),angular.forEach(["minDate","maxDate"],function(key){angular.isDefined(attr[key])&&attr.$observe(key,function(newValue){datepicker.$options[key]=dateParser.getDateForAttribute(key,newValue),isNaN(datepicker.$options[key])||datepicker.$build(!1),validateAgainstMinMaxDate(controller.$dateValue)})}),angular.isDefined(attr.dateFormat)&&attr.$observe("dateFormat",function(newValue){datepicker.$options.dateFormat=newValue}),scope.$watch(attr.ngModel,function(newValue,oldValue){datepicker.update(controller.$dateValue)},!0),angular.isDefined(attr.disabledDates)&&scope.$watch(attr.disabledDates,function(disabledRanges,previousValue){disabledRanges=normalizeDateRanges(disabledRanges),previousValue=normalizeDateRanges(previousValue),disabledRanges&&datepicker.updateDisabledDates(disabledRanges)}),controller.$parsers.unshift(function(viewValue){var date;if(!viewValue)return controller.$setValidity("date",!0),null;var parsedDate=dateParser.parse(viewValue,controller.$dateValue);return!parsedDate||isNaN(parsedDate.getTime())?void controller.$setValidity("date",!1):(validateAgainstMinMaxDate(parsedDate),"string"===options.dateType?(date=dateParser.timezoneOffsetAdjust(parsedDate,options.timezone,!0),formatDate(date,options.modelDateFormat||options.dateFormat)):(date=dateParser.timezoneOffsetAdjust(controller.$dateValue,options.timezone,!0),"number"===options.dateType?date.getTime():"unix"===options.dateType?date.getTime()/1e3:"iso"===options.dateType?date.toISOString():new Date(date)))}),controller.$formatters.push(function(modelValue){var date;return date=angular.isUndefined(modelValue)||null===modelValue?NaN:angular.isDate(modelValue)?modelValue:"string"===options.dateType?dateParser.parse(modelValue,null,options.modelDateFormat):"unix"===options.dateType?new Date(1e3*modelValue):new Date(modelValue),controller.$dateValue=dateParser.timezoneOffsetAdjust(date,options.timezone),getDateFormattedString()}),controller.$render=function(){element.val(getDateFormattedString())},scope.$on("$destroy",function(){datepicker&&datepicker.destroy(),options=null,datepicker=null})}}}]).provider("datepickerViews",function(){function split(arr,size){for(var arrays=[];arr.length>0;)arrays.push(arr.splice(0,size));return arrays}function mod(n,m){return(n%m+m)%m}this.$get=["$dateFormatter","$dateParser","$sce",function($dateFormatter,$dateParser,$sce){return function(picker){var scope=picker.$scope,options=picker.$options,lang=options.lang,formatDate=function(date,format){return $dateFormatter.formatDate(date,format,lang)},dateParser=$dateParser({format:options.dateFormat,lang:lang,strict:options.strictFormat}),weekDaysMin=$dateFormatter.weekdaysShort(lang),weekDaysLabels=weekDaysMin.slice(options.startWeek).concat(weekDaysMin.slice(0,options.startWeek)),weekDaysLabelsHtml=$sce.trustAsHtml('<th class="dow text-center">'+weekDaysLabels.join('</th><th class="dow text-center">')+"</th>"),startDate=picker.$date||(options.startDate?dateParser.getDateForAttribute("startDate",options.startDate):new Date),viewDate={year:startDate.getFullYear(),month:startDate.getMonth(),date:startDate.getDate()},views=[{format:options.dayFormat,split:7,steps:{month:1},update:function(date,force){!this.built||force||date.getFullYear()!==viewDate.year||date.getMonth()!==viewDate.month?(angular.extend(viewDate,{year:picker.$date.getFullYear(),month:picker.$date.getMonth(),date:picker.$date.getDate()}),picker.$build()):date.getDate()===viewDate.date&&1!==date.getDate()||(viewDate.date=picker.$date.getDate(),picker.$updateSelected())},build:function(){var firstDayOfMonth=new Date(viewDate.year,viewDate.month,1),firstDayOfMonthOffset=firstDayOfMonth.getTimezoneOffset(),firstDate=new Date(+firstDayOfMonth-864e5*mod(firstDayOfMonth.getDay()-options.startWeek,7)),firstDateOffset=firstDate.getTimezoneOffset(),today=dateParser.timezoneOffsetAdjust(new Date,options.timezone).toDateString();firstDateOffset!==firstDayOfMonthOffset&&(firstDate=new Date(+firstDate+6e4*(firstDateOffset-firstDayOfMonthOffset)));for(var day,days=[],i=0;i<42;i++)day=dateParser.daylightSavingAdjust(new Date(firstDate.getFullYear(),firstDate.getMonth(),firstDate.getDate()+i)),days.push({date:day,isToday:day.toDateString()===today,label:formatDate(day,this.format),selected:picker.$date&&this.isSelected(day),muted:day.getMonth()!==viewDate.month,disabled:this.isDisabled(day)});scope.title=formatDate(firstDayOfMonth,options.monthTitleFormat),scope.showLabels=!0,scope.labels=weekDaysLabelsHtml,scope.rows=split(days,this.split),this.built=!0},isSelected:function(date){return picker.$date&&date.getFullYear()===picker.$date.getFullYear()&&date.getMonth()===picker.$date.getMonth()&&date.getDate()===picker.$date.getDate()},isDisabled:function(date){var time=date.getTime();if(time<options.minDate||time>options.maxDate)return!0;if(options.daysOfWeekDisabled.indexOf(date.getDay())!==-1)return!0;if(options.disabledDateRanges)for(var i=0;i<options.disabledDateRanges.length;i++)if(time>=options.disabledDateRanges[i].start&&time<=options.disabledDateRanges[i].end)return!0;return!1},onKeyDown:function(evt){if(picker.$date){var newDate,actualTime=picker.$date.getTime();37===evt.keyCode?newDate=new Date(actualTime-864e5):38===evt.keyCode?newDate=new Date(actualTime-6048e5):39===evt.keyCode?newDate=new Date(actualTime+864e5):40===evt.keyCode&&(newDate=new Date(actualTime+6048e5)),this.isDisabled(newDate)||picker.select(newDate,!0)}}},{name:"month",format:options.monthFormat,split:4,steps:{year:1},update:function(date,force){this.built&&date.getFullYear()===viewDate.year?date.getMonth()!==viewDate.month&&(angular.extend(viewDate,{month:picker.$date.getMonth(),date:picker.$date.getDate()}),picker.$updateSelected()):(angular.extend(viewDate,{year:picker.$date.getFullYear(),month:picker.$date.getMonth(),date:picker.$date.getDate()}),picker.$build())},build:function(){for(var month,months=[],i=0;i<12;i++)month=new Date(viewDate.year,i,1),months.push({date:month,label:formatDate(month,this.format),selected:picker.$isSelected(month),disabled:this.isDisabled(month)});scope.title=formatDate(month,options.yearTitleFormat),scope.showLabels=!1,scope.rows=split(months,this.split),this.built=!0},isSelected:function(date){return picker.$date&&date.getFullYear()===picker.$date.getFullYear()&&date.getMonth()===picker.$date.getMonth()},isDisabled:function(date){var lastDate=+new Date(date.getFullYear(),date.getMonth()+1,0);return lastDate<options.minDate||date.getTime()>options.maxDate},onKeyDown:function(evt){if(picker.$date){var actualMonth=picker.$date.getMonth(),newDate=new Date(picker.$date);37===evt.keyCode?newDate.setMonth(actualMonth-1):38===evt.keyCode?newDate.setMonth(actualMonth-4):39===evt.keyCode?newDate.setMonth(actualMonth+1):40===evt.keyCode&&newDate.setMonth(actualMonth+4),this.isDisabled(newDate)||picker.select(newDate,!0)}}},{name:"year",format:options.yearFormat,split:4,steps:{year:12},update:function(date,force){!this.built||force||parseInt(date.getFullYear()/20,10)!==parseInt(viewDate.year/20,10)?(angular.extend(viewDate,{year:picker.$date.getFullYear(),month:picker.$date.getMonth(),date:picker.$date.getDate()}),picker.$build()):date.getFullYear()!==viewDate.year&&(angular.extend(viewDate,{year:picker.$date.getFullYear(),month:picker.$date.getMonth(),date:picker.$date.getDate()}),picker.$updateSelected())},build:function(){for(var year,firstYear=viewDate.year-viewDate.year%(3*this.split),years=[],i=0;i<12;i++)year=new Date(firstYear+i,0,1),years.push({date:year,label:formatDate(year,this.format),selected:picker.$isSelected(year),disabled:this.isDisabled(year)});scope.title=years[0].label+"-"+years[years.length-1].label,scope.showLabels=!1,scope.rows=split(years,this.split),this.built=!0},isSelected:function(date){return picker.$date&&date.getFullYear()===picker.$date.getFullYear()},isDisabled:function(date){var lastDate=+new Date(date.getFullYear()+1,0,0);return lastDate<options.minDate||date.getTime()>options.maxDate},onKeyDown:function(evt){if(picker.$date){var actualYear=picker.$date.getFullYear(),newDate=new Date(picker.$date);37===evt.keyCode?newDate.setYear(actualYear-1):38===evt.keyCode?newDate.setYear(actualYear-4):39===evt.keyCode?newDate.setYear(actualYear+1):40===evt.keyCode&&newDate.setYear(actualYear+4),this.isDisabled(newDate)||picker.select(newDate,!0)}}}];return{views:options.minView?Array.prototype.slice.call(views,options.minView):views,viewDate:viewDate}}}]}),angular.module("mgcrea.ngStrap.collapse",[]).provider("$collapse",function(){var defaults=this.defaults={animation:"am-collapse",disallowToggle:!1,activeClass:"in",startCollapsed:!1,allowMultiple:!1},controller=this.controller=function($scope,$element,$attrs){function fixActiveItemIndexes(index){for(var activeIndexes=self.$targets.$active,i=0;i<activeIndexes.length;i++)index<activeIndexes[i]&&(activeIndexes[i]=activeIndexes[i]-1),activeIndexes[i]===self.$targets.length&&(activeIndexes[i]=self.$targets.length-1)}function isActive(value){var activeItems=self.$targets.$active;return activeItems.indexOf(value)!==-1}function deactivateItem(value){var index=self.$targets.$active.indexOf(value);index!==-1&&self.$targets.$active.splice(index,1)}function activateItem(value){self.$options.allowMultiple||self.$targets.$active.splice(0,1),self.$targets.$active.indexOf(value)===-1&&self.$targets.$active.push(value)}var self=this;self.$options=angular.copy(defaults),angular.forEach(["animation","disallowToggle","activeClass","startCollapsed","allowMultiple"],function(key){angular.isDefined($attrs[key])&&(self.$options[key]=$attrs[key])});var falseValueRegExp=/^(false|0|)$/i;angular.forEach(["disallowToggle","startCollapsed","allowMultiple"],function(key){angular.isDefined($attrs[key])&&falseValueRegExp.test($attrs[key])&&(self.$options[key]=!1)}),self.$toggles=[],self.$targets=[],self.$viewChangeListeners=[],self.$registerToggle=function(element){self.$toggles.push(element)},self.$registerTarget=function(element){self.$targets.push(element)},self.$unregisterToggle=function(element){var index=self.$toggles.indexOf(element);self.$toggles.splice(index,1)},self.$unregisterTarget=function(element){var index=self.$targets.indexOf(element);self.$targets.splice(index,1),self.$options.allowMultiple&&deactivateItem(element),fixActiveItemIndexes(index),self.$viewChangeListeners.forEach(function(fn){fn()})},self.$targets.$active=self.$options.startCollapsed?[]:[0],self.$setActive=$scope.$setActive=function(value){angular.isArray(value)?self.$targets.$active=value:!self.$options.disallowToggle&&isActive(value)?deactivateItem(value):activateItem(value),self.$viewChangeListeners.forEach(function(fn){fn()})},self.$activeIndexes=function(){return self.$options.allowMultiple?self.$targets.$active:1===self.$targets.$active.length?self.$targets.$active[0]:-1}};this.$get=function(){var $collapse={};return $collapse.defaults=defaults,$collapse.controller=controller,$collapse}}).directive("bsCollapse",["$window","$animate","$collapse",function($window,$animate,$collapse){return{require:["?ngModel","bsCollapse"],controller:["$scope","$element","$attrs",$collapse.controller],link:function(scope,element,attrs,controllers){var ngModelCtrl=controllers[0],bsCollapseCtrl=controllers[1];ngModelCtrl&&(bsCollapseCtrl.$viewChangeListeners.push(function(){ngModelCtrl.$setViewValue(bsCollapseCtrl.$activeIndexes())}),ngModelCtrl.$formatters.push(function(modelValue){if(angular.isArray(modelValue))bsCollapseCtrl.$setActive(modelValue);else{var activeIndexes=bsCollapseCtrl.$activeIndexes();angular.isArray(activeIndexes)?activeIndexes.indexOf(1*modelValue)===-1&&bsCollapseCtrl.$setActive(1*modelValue):activeIndexes!==1*modelValue&&bsCollapseCtrl.$setActive(1*modelValue)}return modelValue}))}}}]).directive("bsCollapseToggle",function(){return{require:["^?ngModel","^bsCollapse"],link:function(scope,element,attrs,controllers){var bsCollapseCtrl=controllers[1];element.attr("data-toggle","collapse"),bsCollapseCtrl.$registerToggle(element),scope.$on("$destroy",function(){bsCollapseCtrl.$unregisterToggle(element)}),element.on("click",function(){if(!attrs.disabled){var index=attrs.bsCollapseToggle&&"bs-collapse-toggle"!==attrs.bsCollapseToggle?attrs.bsCollapseToggle:bsCollapseCtrl.$toggles.indexOf(element);bsCollapseCtrl.$setActive(1*index),scope.$apply()}})}}}).directive("bsCollapseTarget",["$animate",function($animate){return{require:["^?ngModel","^bsCollapse"],link:function(scope,element,attrs,controllers){function render(){var index=bsCollapseCtrl.$targets.indexOf(element),active=bsCollapseCtrl.$activeIndexes(),action="removeClass";angular.isArray(active)?active.indexOf(index)!==-1&&(action="addClass"):index===active&&(action="addClass"),$animate[action](element,bsCollapseCtrl.$options.activeClass)}var bsCollapseCtrl=controllers[1];element.addClass("collapse"),bsCollapseCtrl.$options.animation&&element.addClass(bsCollapseCtrl.$options.animation),bsCollapseCtrl.$registerTarget(element),scope.$on("$destroy",function(){bsCollapseCtrl.$unregisterTarget(element)}),bsCollapseCtrl.$viewChangeListeners.push(function(){render()}),render()}}}]),angular.module("mgcrea.ngStrap.button",[]).provider("$button",function(){var defaults=this.defaults={activeClass:"active",toggleEvent:"click"};this.$get=function(){return{defaults:defaults}}}).directive("bsCheckboxGroup",function(){return{restrict:"A",require:"ngModel",compile:function(element,attr){element.attr("data-toggle","buttons"),element.removeAttr("ng-model");var children=element[0].querySelectorAll('input[type="checkbox"]');angular.forEach(children,function(child){var childEl=angular.element(child);childEl.attr("bs-checkbox",""),childEl.attr("ng-model",attr.ngModel+"."+childEl.attr("value"))})}}}).directive("bsCheckbox",["$button","$$rAF",function($button,$$rAF){var defaults=$button.defaults,constantValueRegExp=/^(true|false|\d+)$/;return{restrict:"A",require:"ngModel",link:function(scope,element,attr,controller){var options=defaults,isInput="INPUT"===element[0].nodeName,activeElement=isInput?element.parent():element,trueValue=!angular.isDefined(attr.trueValue)||attr.trueValue;constantValueRegExp.test(attr.trueValue)&&(trueValue=scope.$eval(attr.trueValue));var falseValue=!!angular.isDefined(attr.falseValue)&&attr.falseValue;constantValueRegExp.test(attr.falseValue)&&(falseValue=scope.$eval(attr.falseValue));var hasExoticValues="boolean"!=typeof trueValue||"boolean"!=typeof falseValue;hasExoticValues&&(controller.$parsers.push(function(viewValue){return viewValue?trueValue:falseValue}),controller.$formatters.push(function(modelValue){return angular.equals(modelValue,trueValue)}),scope.$watch(attr.ngModel,function(newValue,oldValue){controller.$render()})),controller.$render=function(){var isActive=angular.equals(controller.$modelValue,trueValue);$$rAF(function(){isInput&&(element[0].checked=isActive),activeElement.toggleClass(options.activeClass,isActive)})},element.bind(options.toggleEvent,function(){scope.$apply(function(){isInput||controller.$setViewValue(!activeElement.hasClass("active")),hasExoticValues||controller.$render()})})}}}]).directive("bsRadioGroup",function(){return{restrict:"A",require:"ngModel",compile:function(element,attr){element.attr("data-toggle","buttons"),element.removeAttr("ng-model");var children=element[0].querySelectorAll('input[type="radio"]');angular.forEach(children,function(child){angular.element(child).attr("bs-radio",""),angular.element(child).attr("ng-model",attr.ngModel)})}}}).directive("bsRadio",["$button","$$rAF",function($button,$$rAF){var defaults=$button.defaults,constantValueRegExp=/^(true|false|\d+)$/;return{restrict:"A",require:"ngModel",link:function(scope,element,attr,controller){var value,options=defaults,isInput="INPUT"===element[0].nodeName,activeElement=isInput?element.parent():element;attr.$observe("value",function(v){value="boolean"!=typeof v&&constantValueRegExp.test(v)?scope.$eval(v):v,controller.$render()}),controller.$render=function(){var isActive=angular.equals(controller.$modelValue,value);$$rAF(function(){isInput&&(element[0].checked=isActive),activeElement.toggleClass(options.activeClass,isActive)})},element.bind(options.toggleEvent,function(){scope.$apply(function(){controller.$setViewValue(value),controller.$render()})})}}}]),angular.module("mgcrea.ngStrap.alert",["mgcrea.ngStrap.modal"]).provider("$alert",function(){var defaults=this.defaults={animation:"am-fade",prefixClass:"alert",prefixEvent:"alert",placement:null,templateUrl:"alert/alert.tpl.html",container:!1,element:null,backdrop:!1,keyboard:!0,show:!0,duration:!1,type:!1,dismissable:!0};this.$get=["$modal","$timeout",function($modal,$timeout){function AlertFactory(config){var $alert={},options=angular.extend({},defaults,config);$alert=$modal(options),$alert.$scope.dismissable=!!options.dismissable,options.type&&($alert.$scope.type=options.type);var show=$alert.show;return options.duration&&($alert.show=function(){show(),$timeout(function(){$alert.hide()},1e3*options.duration)}),$alert}return AlertFactory}]}).directive("bsAlert",["$window","$sce","$alert",function($window,$sce,$alert){return{restrict:"EAC",scope:!0,link:function(scope,element,attr,transclusion){var options={scope:scope,element:element,show:!1};angular.forEach(["template","templateUrl","controller","controllerAs","placement","keyboard","html","container","animation","duration","dismissable"],function(key){angular.isDefined(attr[key])&&(options[key]=attr[key])});var falseValueRegExp=/^(false|0|)$/i;angular.forEach(["keyboard","html","container","dismissable"],function(key){angular.isDefined(attr[key])&&falseValueRegExp.test(attr[key])&&(options[key]=!1)}),scope.hasOwnProperty("title")||(scope.title=""),angular.forEach(["title","content","type"],function(key){attr[key]&&attr.$observe(key,function(newValue,oldValue){scope[key]=$sce.trustAsHtml(newValue)})}),attr.bsAlert&&scope.$watch(attr.bsAlert,function(newValue,oldValue){angular.isObject(newValue)?angular.extend(scope,newValue):scope.content=newValue},!0);var alert=$alert(options);element.on(attr.trigger||"click",alert.toggle),scope.$on("$destroy",function(){alert&&alert.destroy(),options=null,alert=null})}}}]),angular.module("mgcrea.ngStrap.aside",["mgcrea.ngStrap.modal"]).provider("$aside",function(){var defaults=this.defaults={animation:"am-fade-and-slide-right",prefixClass:"aside",prefixEvent:"aside",placement:"right",templateUrl:"aside/aside.tpl.html",contentTemplate:!1,container:!1,element:null,backdrop:!0,keyboard:!0,html:!1,show:!0};this.$get=["$modal",function($modal){function AsideFactory(config){var $aside={},options=angular.extend({},defaults,config);return $aside=$modal(options)}return AsideFactory}]}).directive("bsAside",["$window","$sce","$aside",function($window,$sce,$aside){return{restrict:"EAC",scope:!0,link:function(scope,element,attr,transclusion){var options={scope:scope,element:element,show:!1};angular.forEach(["template","templateUrl","controller","controllerAs","contentTemplate","placement","backdrop","keyboard","html","container","animation"],function(key){angular.isDefined(attr[key])&&(options[key]=attr[key])});var falseValueRegExp=/^(false|0|)$/i;angular.forEach(["backdrop","keyboard","html","container"],function(key){angular.isDefined(attr[key])&&falseValueRegExp.test(attr[key])&&(options[key]=!1)}),angular.forEach(["title","content"],function(key){attr[key]&&attr.$observe(key,function(newValue,oldValue){scope[key]=$sce.trustAsHtml(newValue)})}),attr.bsAside&&scope.$watch(attr.bsAside,function(newValue,oldValue){angular.isObject(newValue)?angular.extend(scope,newValue):scope.content=newValue},!0);var aside=$aside(options);element.on(attr.trigger||"click",aside.toggle),scope.$on("$destroy",function(){aside&&aside.destroy(),options=null,aside=null})}}}]),angular.module("mgcrea.ngStrap.affix",["mgcrea.ngStrap.helpers.dimensions","mgcrea.ngStrap.helpers.debounce"]).provider("$affix",function(){var defaults=this.defaults={offsetTop:"auto",inlineStyles:!0};this.$get=["$window","debounce","dimensions",function($window,debounce,dimensions){function AffixFactory(element,config){function getRequiredAffixClass(_unpin,position,elementHeight){var scrollTop=getScrollTop(),scrollHeight=getScrollHeight();return scrollTop<=offsetTop?"top":null!==_unpin&&scrollTop+_unpin<=position.top?"middle":null!==offsetBottom&&position.top+elementHeight+initialAffixTop>=scrollHeight-offsetBottom?"bottom":"middle"}function getScrollTop(){return targetEl[0]===$window?$window.pageYOffset:targetEl[0].scrollTop}function getScrollHeight(){return targetEl[0]===$window?$window.document.body.scrollHeight:targetEl[0].scrollHeight}var $affix={},options=angular.extend({},defaults,config),targetEl=options.target,reset="affix affix-top affix-bottom",setWidth=!1,initialAffixTop=0,initialOffsetTop=0,offsetTop=0,offsetBottom=0,affixed=null,unpin=null,parent=element.parent();if(options.offsetParent)if(options.offsetParent.match(/^\d+$/))for(var i=0;i<1*options.offsetParent-1;i++)parent=parent.parent();else parent=angular.element(options.offsetParent);return $affix.init=function(){this.$parseOffsets(),initialOffsetTop=dimensions.offset(element[0]).top+initialAffixTop,setWidth=!element[0].style.width,targetEl.on("scroll",this.checkPosition),targetEl.on("click",this.checkPositionWithEventLoop),windowEl.on("resize",this.$debouncedOnResize),this.checkPosition(),this.checkPositionWithEventLoop()},$affix.destroy=function(){targetEl.off("scroll",this.checkPosition),targetEl.off("click",this.checkPositionWithEventLoop),windowEl.off("resize",this.$debouncedOnResize)},$affix.checkPositionWithEventLoop=function(){setTimeout($affix.checkPosition,1)},$affix.checkPosition=function(){var scrollTop=getScrollTop(),position=dimensions.offset(element[0]),elementHeight=dimensions.height(element[0]),affix=getRequiredAffixClass(unpin,position,elementHeight);affixed!==affix&&(affixed=affix,"top"===affix?(unpin=null,setWidth&&element.css("width",""),options.inlineStyles&&(element.css("position",options.offsetParent?"":"relative"),element.css("top",""))):"bottom"===affix?(unpin=options.offsetUnpin?-(1*options.offsetUnpin):position.top-scrollTop,setWidth&&element.css("width",""),options.inlineStyles&&(element.css("position",options.offsetParent?"":"relative"),element.css("top",options.offsetParent?"":bodyEl[0].offsetHeight-offsetBottom-elementHeight-initialOffsetTop+"px"))):(unpin=null,setWidth&&element.css("width",element[0].offsetWidth+"px"),options.inlineStyles&&(element.css("position","fixed"),element.css("top",initialAffixTop+"px"))),element.removeClass(reset).addClass("affix"+("middle"!==affix?"-"+affix:"")))},$affix.$onResize=function(){$affix.$parseOffsets(),$affix.checkPosition()},$affix.$debouncedOnResize=debounce($affix.$onResize,50),$affix.$parseOffsets=function(){var initialPosition=element.css("position");options.inlineStyles&&element.css("position",options.offsetParent?"":"relative"),options.offsetTop&&("auto"===options.offsetTop&&(options.offsetTop="+0"),options.offsetTop.match(/^[-+]\d+$/)?(initialAffixTop=1*-options.offsetTop,offsetTop=options.offsetParent?dimensions.offset(parent[0]).top+1*options.offsetTop:dimensions.offset(element[0]).top-dimensions.css(element[0],"marginTop",!0)+1*options.offsetTop):offsetTop=1*options.offsetTop),options.offsetBottom&&(offsetBottom=options.offsetParent&&options.offsetBottom.match(/^[-+]\d+$/)?getScrollHeight()-(dimensions.offset(parent[0]).top+dimensions.height(parent[0]))+1*options.offsetBottom+1:1*options.offsetBottom),options.inlineStyles&&element.css("position",initialPosition)},$affix.init(),$affix}var bodyEl=angular.element($window.document.body),windowEl=angular.element($window);return AffixFactory}]}).directive("bsAffix",["$affix","$window",function($affix,$window){return{restrict:"EAC",require:"^?bsAffixTarget",link:function(scope,element,attr,affixTarget){var options={scope:scope,target:affixTarget?affixTarget.$element:angular.element($window)};angular.forEach(["offsetTop","offsetBottom","offsetParent","offsetUnpin","inlineStyles"],function(key){if(angular.isDefined(attr[key])){var option=attr[key];/true/i.test(option)&&(option=!0),/false/i.test(option)&&(option=!1),options[key]=option}});var affix=$affix(element,options);scope.$on("$destroy",function(){affix&&affix.destroy(),options=null,affix=null})}}}]).directive("bsAffixTarget",function(){return{controller:["$element",function($element){this.$element=$element}]}}),angular.module("mgcrea.ngStrap",["mgcrea.ngStrap.modal","mgcrea.ngStrap.aside","mgcrea.ngStrap.alert","mgcrea.ngStrap.button","mgcrea.ngStrap.select","mgcrea.ngStrap.datepicker","mgcrea.ngStrap.timepicker","mgcrea.ngStrap.navbar","mgcrea.ngStrap.tooltip","mgcrea.ngStrap.popover","mgcrea.ngStrap.dropdown","mgcrea.ngStrap.typeahead","mgcrea.ngStrap.scrollspy","mgcrea.ngStrap.affix","mgcrea.ngStrap.tab","mgcrea.ngStrap.collapse"]);
}(window,document),function(window,document,undefined){angular.module("mgcrea.ngStrap.aside").run(["$templateCache",function($templateCache){$templateCache.put("aside/aside.tpl.html",'<div class="aside" tabindex="-1" role="dialog"><div class="aside-dialog"><div class="aside-content"><div class="aside-header" ng-show="title"><button type="button" class="close" ng-click="$hide()">&times;</button><h4 class="aside-title" ng-bind="title"></h4></div><div class="aside-body" ng-bind="content"></div><div class="aside-footer"><button type="button" class="btn btn-default" ng-click="$hide()">Close</button></div></div></div></div>')}]),angular.module("mgcrea.ngStrap.alert").run(["$templateCache",function($templateCache){$templateCache.put("alert/alert.tpl.html",'<div class="alert" ng-class="[type ? \'alert-\' + type : null]"><button type="button" class="close" ng-if="dismissable" ng-click="$hide()">&times;</button> <strong ng-bind="title"></strong>&nbsp;<span ng-bind-html="content"></span></div>')}]),angular.module("mgcrea.ngStrap.datepicker").run(["$templateCache",function($templateCache){$templateCache.put("datepicker/datepicker.tpl.html",'<div class="dropdown-menu datepicker" ng-class="\'datepicker-mode-\' + $mode" style="max-width: 320px"><table style="table-layout: fixed; height: 100%; width: 100%"><thead><tr class="text-center"><th><button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$selectPane(-1)"><i class="{{$iconLeft}}"></i></button></th><th colspan="{{ rows[0].length - 2 }}"><button tabindex="-1" type="button" class="btn btn-default btn-block text-strong" ng-click="$toggleMode()"><strong style="text-transform: capitalize" ng-bind="title"></strong></button></th><th><button tabindex="-1" type="button" class="btn btn-default pull-right" ng-click="$selectPane(+1)"><i class="{{$iconRight}}"></i></button></th></tr><tr ng-if="showLabels" ng-bind-html="labels"></tr></thead><tbody><tr ng-repeat="(i, row) in rows" height="{{ 100 / rows.length }}%"><td class="text-center" ng-repeat="(j, el) in row"><button tabindex="-1" type="button" class="btn btn-default" style="width: 100%" ng-class="{\'btn-primary\': el.selected, \'btn-info btn-today\': el.isToday && !el.selected}" ng-click="$select(el.date)" ng-disabled="el.disabled"><span ng-class="{\'text-muted\': el.muted}" ng-bind="el.label"></span></button></td></tr></tbody></table></div>')}]),angular.module("mgcrea.ngStrap.modal").run(["$templateCache",function($templateCache){$templateCache.put("modal/modal.tpl.html",'<div class="modal" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header" ng-show="title"><button type="button" class="close" aria-label="Close" ng-click="$hide()"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" ng-bind="title"></h4></div><div class="modal-body" ng-bind="content"></div><div class="modal-footer"><button type="button" class="btn btn-default" ng-click="$hide()">Close</button></div></div></div></div>')}]),angular.module("mgcrea.ngStrap.dropdown").run(["$templateCache",function($templateCache){$templateCache.put("dropdown/dropdown.tpl.html",'<ul tabindex="-1" class="dropdown-menu" role="menu" ng-show="content && content.length"><li role="presentation" ng-class="{divider: item.divider, active: item.active}" ng-repeat="item in content"><a role="menuitem" tabindex="-1" ng-href="{{item.href}}" ng-if="!item.divider && item.href" target="{{item.target || \'\'}}" ng-bind="item.text"></a> <a role="menuitem" tabindex="-1" href="javascript:void(0)" ng-if="!item.divider && item.click" ng-click="$eval(item.click);$hide()" ng-bind="item.text"></a></li></ul>')}]),angular.module("mgcrea.ngStrap.popover").run(["$templateCache",function($templateCache){$templateCache.put("popover/popover.tpl.html",'<div class="popover" tabindex="-1"><div class="arrow"></div><h3 class="popover-title" ng-bind="title" ng-show="title"></h3><div class="popover-content" ng-bind="content"></div></div>')}]),angular.module("mgcrea.ngStrap.select").run(["$templateCache",function($templateCache){$templateCache.put("select/select.tpl.html",'<ul tabindex="-1" class="select dropdown-menu" ng-show="$isVisible()" role="select"><li ng-if="$showAllNoneButtons"><div class="btn-group" style="margin-bottom: 5px; margin-left: 5px"><button type="button" class="btn btn-default btn-xs" ng-click="$selectAll()">{{$allText}}</button> <button type="button" class="btn btn-default btn-xs" ng-click="$selectNone()">{{$noneText}}</button></div></li><li role="presentation" ng-repeat="match in $matches" ng-class="{active: $isActive($index)}"><a style="cursor: default" role="menuitem" tabindex="-1" ng-click="$select($index, $event)"><i class="{{$iconCheckmark}} pull-right" ng-if="$isMultiple && $isActive($index)"></i> <span ng-bind="match.label"></span></a></li></ul>')}]),angular.module("mgcrea.ngStrap.tab").run(["$templateCache",function($templateCache){$templateCache.put("tab/tab.tpl.html",'<ul class="nav" ng-class="$navClass" role="tablist"><li role="presentation" ng-repeat="$pane in $panes track by $index" ng-class="[ $isActive($pane, $index) ? $activeClass : \'\', $pane.disabled ? \'disabled\' : \'\' ]"><a role="tab" data-toggle="tab" ng-click="!$pane.disabled && $setActive($pane.name || $index)" data-index="{{ $index }}" ng-bind-html="$pane.title" aria-controls="$pane.title"></a></li></ul><div ng-transclude class="tab-content"></div>')}]),angular.module("mgcrea.ngStrap.timepicker").run(["$templateCache",function($templateCache){$templateCache.put("timepicker/timepicker.tpl.html",'<div class="dropdown-menu timepicker" style="min-width: 0px;width: auto"><table height="100%"><thead><tr class="text-center"><th><button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(-1, 0)"><i class="{{ $iconUp }}"></i></button></th><th>&nbsp;</th><th><button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(-1, 1)"><i class="{{ $iconUp }}"></i></button></th><th ng-if="showSeconds">&nbsp;</th><th ng-if="showSeconds"><button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(-1, 2)"><i class="{{ $iconUp }}"></i></button></th></tr></thead><tbody><tr ng-repeat="(i, row) in rows"><td class="text-center"><button tabindex="-1" style="width: 100%" type="button" class="btn btn-default" ng-class="{\'btn-primary\': row[0].selected}" ng-click="$select(row[0].date, 0)" ng-disabled="row[0].disabled"><span ng-class="{\'text-muted\': row[0].muted}" ng-bind="row[0].label"></span></button></td><td><span ng-bind="i == midIndex ? timeSeparator : \' \'"></span></td><td class="text-center"><button tabindex="-1" ng-if="row[1].date" style="width: 100%" type="button" class="btn btn-default" ng-class="{\'btn-primary\': row[1].selected}" ng-click="$select(row[1].date, 1)" ng-disabled="row[1].disabled"><span ng-class="{\'text-muted\': row[1].muted}" ng-bind="row[1].label"></span></button></td><td ng-if="showSeconds"><span ng-bind="i == midIndex ? timeSeparator : \' \'"></span></td><td ng-if="showSeconds" class="text-center"><button tabindex="-1" ng-if="row[2].date" style="width: 100%" type="button" class="btn btn-default" ng-class="{\'btn-primary\': row[2].selected}" ng-click="$select(row[2].date, 2)" ng-disabled="row[2].disabled"><span ng-class="{\'text-muted\': row[2].muted}" ng-bind="row[2].label"></span></button></td><td ng-if="showAM">&nbsp;</td><td ng-if="showAM"><button tabindex="-1" ng-show="i == midIndex - !isAM * 1" style="width: 100%" type="button" ng-class="{\'btn-primary\': !!isAM}" class="btn btn-default" ng-click="$switchMeridian()" ng-disabled="el.disabled">AM</button> <button tabindex="-1" ng-show="i == midIndex + 1 - !isAM * 1" style="width: 100%" type="button" ng-class="{\'btn-primary\': !isAM}" class="btn btn-default" ng-click="$switchMeridian()" ng-disabled="el.disabled">PM</button></td></tr></tbody><tfoot><tr class="text-center"><th><button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(1, 0)"><i class="{{ $iconDown }}"></i></button></th><th>&nbsp;</th><th><button tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(1, 1)"><i class="{{ $iconDown }}"></i></button></th><th ng-if="showSeconds">&nbsp;</th><th ng-if="showSeconds"><button ng-if="showSeconds" tabindex="-1" type="button" class="btn btn-default pull-left" ng-click="$arrowAction(1, 2)"><i class="{{ $iconDown }}"></i></button></th></tr></tfoot></table></div>')}]),angular.module("mgcrea.ngStrap.typeahead").run(["$templateCache",function($templateCache){$templateCache.put("typeahead/typeahead.tpl.html",'<ul tabindex="-1" class="typeahead dropdown-menu" ng-show="$isVisible()" role="select"><li role="presentation" ng-repeat="match in $matches" ng-class="{active: $index == $activeIndex}"><a role="menuitem" tabindex="-1" ng-click="$select($index, $event)" ng-bind="match.label"></a></li></ul>')}]),angular.module("mgcrea.ngStrap.tooltip").run(["$templateCache",function($templateCache){$templateCache.put("tooltip/tooltip.tpl.html",'<div class="tooltip in" ng-show="title"><div class="tooltip-arrow"></div><div class="tooltip-inner" ng-bind="title"></div></div>')}])}(window,document),function(){angular.module("ui.tree",[]).constant("treeConfig",{treeClass:"angular-ui-tree",emptyTreeClass:"angular-ui-tree-empty",hiddenClass:"angular-ui-tree-hidden",nodesClass:"angular-ui-tree-nodes",nodeClass:"angular-ui-tree-node",handleClass:"angular-ui-tree-handle",placeholderClass:"angular-ui-tree-placeholder",dragClass:"angular-ui-tree-drag",dragThreshold:3,levelThreshold:30,defaultCollapsed:!1})}(),function(){angular.module("ui.tree").controller("TreeHandleController",["$scope","$element",function($scope,$element){this.scope=$scope,$scope.$element=$element,$scope.$nodeScope=null,$scope.$type="uiTreeHandle"}])}(),function(){angular.module("ui.tree").controller("TreeNodeController",["$scope","$element",function($scope,$element){function countSubTreeDepth(scope){var i,thisLevelDepth=0,childNodes=scope.childNodes();if(!childNodes||0===childNodes.length)return 0;for(i=childNodes.length-1;i>=0;i--)thisLevelDepth=Math.max(thisLevelDepth,1+countSubTreeDepth(childNodes[i]));return thisLevelDepth}this.scope=$scope,$scope.$element=$element,$scope.$modelValue=null,$scope.$parentNodeScope=null,$scope.$childNodesScope=null,$scope.$parentNodesScope=null,$scope.$treeScope=null,$scope.$handleScope=null,$scope.$type="uiTreeNode",$scope.$$allowNodeDrop=!1,$scope.collapsed=!1,$scope.init=function(controllersArr){var treeNodesCtrl=controllersArr[0];$scope.$treeScope=controllersArr[1]?controllersArr[1].scope:null,$scope.$parentNodeScope=treeNodesCtrl.scope.$nodeScope,$scope.$modelValue=treeNodesCtrl.scope.$modelValue[$scope.$index],$scope.$parentNodesScope=treeNodesCtrl.scope,treeNodesCtrl.scope.initSubNode($scope),$element.on("$destroy",function(){treeNodesCtrl.scope.destroySubNode($scope)})},$scope.index=function(){return $scope.$parentNodesScope.$modelValue.indexOf($scope.$modelValue)},$scope.dragEnabled=function(){return!($scope.$treeScope&&!$scope.$treeScope.dragEnabled)},$scope.isSibling=function(targetNode){return $scope.$parentNodesScope===targetNode.$parentNodesScope},$scope.isChild=function(targetNode){var nodes=$scope.childNodes();return nodes&&nodes.indexOf(targetNode)>-1},$scope.prev=function(){var index=$scope.index();return index>0?$scope.siblings()[index-1]:null},$scope.siblings=function(){return $scope.$parentNodesScope.childNodes()},$scope.childNodesCount=function(){return $scope.childNodes()?$scope.childNodes().length:0},$scope.hasChild=function(){return $scope.childNodesCount()>0},$scope.childNodes=function(){return $scope.$childNodesScope&&$scope.$childNodesScope.$modelValue?$scope.$childNodesScope.childNodes():null},$scope.accept=function(sourceNode,destIndex){return $scope.$childNodesScope&&$scope.$childNodesScope.$modelValue&&$scope.$childNodesScope.accept(sourceNode,destIndex)},$scope.remove=function(){return $scope.$parentNodesScope.removeNode($scope)},$scope.toggle=function(){$scope.collapsed=!$scope.collapsed},$scope.collapse=function(){$scope.collapsed=!0},$scope.expand=function(){$scope.collapsed=!1},$scope.depth=function(){var parentNode=$scope.$parentNodeScope;return parentNode?parentNode.depth()+1:1},$scope.maxSubDepth=function(){return $scope.$childNodesScope?countSubTreeDepth($scope.$childNodesScope):0}}])}(),function(){angular.module("ui.tree").controller("TreeNodesController",["$scope","$element",function($scope,$element){this.scope=$scope,$scope.$element=$element,$scope.$modelValue=null,$scope.$nodeScope=null,$scope.$treeScope=null,$scope.$type="uiTreeNodes",$scope.$nodesMap={},$scope.nodropEnabled=!1,$scope.maxDepth=0,$scope.cloneEnabled=!1,$scope.initSubNode=function(subNode){return subNode.$modelValue?void($scope.$nodesMap[subNode.$modelValue.$$hashKey]=subNode):null},$scope.destroySubNode=function(subNode){return subNode.$modelValue?void($scope.$nodesMap[subNode.$modelValue.$$hashKey]=null):null},$scope.accept=function(sourceNode,destIndex){return $scope.$treeScope.$callbacks.accept(sourceNode,$scope,destIndex)},$scope.beforeDrag=function(sourceNode){return $scope.$treeScope.$callbacks.beforeDrag(sourceNode)},$scope.isParent=function(node){return node.$parentNodesScope===$scope},$scope.hasChild=function(){return $scope.$modelValue.length>0},$scope.safeApply=function(fn){var phase=this.$root.$$phase;"$apply"===phase||"$digest"===phase?fn&&"function"==typeof fn&&fn():this.$apply(fn)},$scope.removeNode=function(node){var index=$scope.$modelValue.indexOf(node.$modelValue);return index>-1?($scope.safeApply(function(){$scope.$modelValue.splice(index,1)}),$scope.$treeScope.$callbacks.removed(node)):null},$scope.insertNode=function(index,nodeData){$scope.safeApply(function(){$scope.$modelValue.splice(index,0,nodeData)})},$scope.childNodes=function(){var i,nodes=[];if($scope.$modelValue)for(i=0;i<$scope.$modelValue.length;i++)nodes.push($scope.$nodesMap[$scope.$modelValue[i].$$hashKey]);return nodes},$scope.depth=function(){return $scope.$nodeScope?$scope.$nodeScope.depth():0},$scope.outOfDepth=function(sourceNode){var maxDepth=$scope.maxDepth||$scope.$treeScope.maxDepth;return maxDepth>0&&$scope.depth()+sourceNode.maxSubDepth()+1>maxDepth}}])}(),function(){angular.module("ui.tree").controller("TreeController",["$scope","$element",function($scope,$element){this.scope=$scope,$scope.$element=$element,$scope.$nodesScope=null,$scope.$type="uiTree",$scope.$emptyElm=null,$scope.$callbacks=null,$scope.dragEnabled=!0,$scope.emptyPlaceholderEnabled=!0,$scope.maxDepth=0,$scope.dragDelay=0,$scope.cloneEnabled=!1,$scope.nodropEnabled=!1,$scope.isEmpty=function(){return $scope.$nodesScope&&$scope.$nodesScope.$modelValue&&0===$scope.$nodesScope.$modelValue.length},$scope.place=function(placeElm){$scope.$nodesScope.$element.append(placeElm),$scope.$emptyElm.remove()},this.resetEmptyElement=function(){$scope.$nodesScope.$modelValue&&0!==$scope.$nodesScope.$modelValue.length||!$scope.emptyPlaceholderEnabled?$scope.$emptyElm.remove():$element.append($scope.$emptyElm)},$scope.resetEmptyElement=this.resetEmptyElement}])}(),function(){angular.module("ui.tree").directive("uiTree",["treeConfig","$window",function(treeConfig,$window){return{restrict:"A",scope:!0,controller:"TreeController",link:function(scope,element,attrs,ctrl){var tdElm,$trElm,emptyElmColspan,callbacks={accept:null,beforeDrag:null},config={};angular.extend(config,treeConfig),config.treeClass&&element.addClass(config.treeClass),"table"===element.prop("tagName").toLowerCase()?(scope.$emptyElm=angular.element($window.document.createElement("tr")),$trElm=element.find("tr"),emptyElmColspan=$trElm.length>0?angular.element($trElm).children().length:1e6,tdElm=angular.element($window.document.createElement("td")).attr("colspan",emptyElmColspan),scope.$emptyElm.append(tdElm)):scope.$emptyElm=angular.element($window.document.createElement("div")),config.emptyTreeClass&&scope.$emptyElm.addClass(config.emptyTreeClass),scope.$watch("$nodesScope.$modelValue.length",function(val){angular.isNumber(val)&&ctrl.resetEmptyElement()},!0),scope.$watch(attrs.dragEnabled,function(val){"boolean"==typeof val&&(scope.dragEnabled=val)}),scope.$watch(attrs.emptyPlaceholderEnabled,function(val){"boolean"==typeof val&&(scope.emptyPlaceholderEnabled=val,ctrl.resetEmptyElement())}),scope.$watch(attrs.nodropEnabled,function(val){"boolean"==typeof val&&(scope.nodropEnabled=val)}),scope.$watch(attrs.cloneEnabled,function(val){"boolean"==typeof val&&(scope.cloneEnabled=val)}),scope.$watch(attrs.maxDepth,function(val){"number"==typeof val&&(scope.maxDepth=val)}),scope.$watch(attrs.dragDelay,function(val){"number"==typeof val&&(scope.dragDelay=val)}),callbacks.accept=function(sourceNodeScope,destNodesScope,destIndex){return!(destNodesScope.nodropEnabled||destNodesScope.$treeScope.nodropEnabled||destNodesScope.outOfDepth(sourceNodeScope))},callbacks.beforeDrag=function(sourceNodeScope){return!0},callbacks.removed=function(node){},callbacks.dropped=function(event){},callbacks.dragStart=function(event){},callbacks.dragMove=function(event){},callbacks.dragStop=function(event){},callbacks.beforeDrop=function(event){},scope.$watch(attrs.uiTree,function(newVal,oldVal){angular.forEach(newVal,function(value,key){callbacks[key]&&"function"==typeof value&&(callbacks[key]=value)}),scope.$callbacks=callbacks},!0)}}}])}(),function(){angular.module("ui.tree").directive("uiTreeHandle",["treeConfig",function(treeConfig){return{require:"^uiTreeNode",restrict:"A",scope:!0,controller:"TreeHandleController",link:function(scope,element,attrs,treeNodeCtrl){var config={};angular.extend(config,treeConfig),config.handleClass&&element.addClass(config.handleClass),scope!==treeNodeCtrl.scope&&(scope.$nodeScope=treeNodeCtrl.scope,treeNodeCtrl.scope.$handleScope=scope)}}}])}(),function(){angular.module("ui.tree").directive("uiTreeNode",["treeConfig","UiTreeHelper","$window","$document","$timeout","$q","$rootElement",function(treeConfig,UiTreeHelper,$window,$document,$timeout,$q,$rootElement){return{require:["^uiTreeNodes","^uiTree"],restrict:"A",controller:"TreeNodeController",link:function(scope,element,attrs,controllersArr){var firstMoving,dragInfo,pos,placeElm,hiddenPlaceElm,dragElm,elements,document_height,document_width,dragStart,dragMove,dragEnd,dragStartEvent,dragMoveEvent,dragEndEvent,dragCancelEvent,dragDelay,bindDragStartEvents,bindDragMoveEvents,unbindDragMoveEvents,keydownHandler,outOfBounds,isHandleChild,el,config={},hasTouch="ontouchstart"in window,treeScope=null,body=document.body,html=document.documentElement;angular.extend(config,treeConfig),config.nodeClass&&element.addClass(config.nodeClass),scope.init(controllersArr),scope.collapsed=!!UiTreeHelper.getNodeAttribute(scope,"collapsed")||treeConfig.defaultCollapsed,scope.sourceOnly=scope.nodropEnabled||scope.$treeScope.nodropEnabled,scope.$watch(attrs.collapsed,function(val){"boolean"==typeof val&&(scope.collapsed=val)}),scope.$watch("collapsed",function(val){UiTreeHelper.setNodeAttribute(scope,"collapsed",val),attrs.$set("collapsed",val)}),scope.$on("angular-ui-tree:collapse-all",function(){scope.collapsed=!0}),scope.$on("angular-ui-tree:expand-all",function(){scope.collapsed=!1}),dragStart=function(e){if((hasTouch||2!==e.button&&3!==e.which)&&!(e.uiTreeDragging||e.originalEvent&&e.originalEvent.uiTreeDragging)){var isHandleChild,cloneElm,eventElmTagName,tagName,eventObj,tdElm,hStyle,isTreeNode,isTreeNodeHandle,eventElm=angular.element(e.target);if(isHandleChild=UiTreeHelper.treeNodeHandlerContainerOfElement(eventElm),isHandleChild&&(eventElm=angular.element(isHandleChild)),cloneElm=element.clone(),isTreeNode=UiTreeHelper.elementIsTreeNode(eventElm),isTreeNodeHandle=UiTreeHelper.elementIsTreeNodeHandle(eventElm),(isTreeNode||isTreeNodeHandle)&&!(isTreeNode&&UiTreeHelper.elementContainsTreeNodeHandler(eventElm)||(eventElmTagName=eventElm.prop("tagName").toLowerCase(),"input"===eventElmTagName||"textarea"===eventElmTagName||"button"===eventElmTagName||"select"===eventElmTagName))){for(el=angular.element(e.target);el&&el[0]&&el[0]!==element;){if(UiTreeHelper.nodrag(el))return;el=el.parent()}scope.beforeDrag(scope)&&(e.uiTreeDragging=!0,e.originalEvent&&(e.originalEvent.uiTreeDragging=!0),e.preventDefault(),eventObj=UiTreeHelper.eventObj(e),firstMoving=!0,dragInfo=UiTreeHelper.dragInfo(scope),tagName=element.prop("tagName"),"tr"===tagName.toLowerCase()?(placeElm=angular.element($window.document.createElement(tagName)),tdElm=angular.element($window.document.createElement("td")).addClass(config.placeholderClass).attr("colspan",element[0].children.length),placeElm.append(tdElm)):placeElm=angular.element($window.document.createElement(tagName)).addClass(config.placeholderClass),hiddenPlaceElm=angular.element($window.document.createElement(tagName)),config.hiddenClass&&hiddenPlaceElm.addClass(config.hiddenClass),pos=UiTreeHelper.positionStarted(eventObj,element),placeElm.css("height",UiTreeHelper.height(element)+"px"),dragElm=angular.element($window.document.createElement(scope.$parentNodesScope.$element.prop("tagName"))).addClass(scope.$parentNodesScope.$element.attr("class")).addClass(config.dragClass),dragElm.css("width",UiTreeHelper.width(element)+"px"),dragElm.css("z-index",9999),hStyle=(element[0].querySelector(".angular-ui-tree-handle")||element[0]).currentStyle,hStyle&&(document.body.setAttribute("ui-tree-cursor",$document.find("body").css("cursor")||""),$document.find("body").css({cursor:hStyle.cursor+"!important"})),scope.sourceOnly&&placeElm.css("display","none"),element.after(placeElm),element.after(hiddenPlaceElm),dragInfo.isClone()&&scope.sourceOnly?dragElm.append(cloneElm):dragElm.append(element),$rootElement.append(dragElm),dragElm.css({left:eventObj.pageX-pos.offsetX+"px",top:eventObj.pageY-pos.offsetY+"px"}),elements={placeholder:placeElm,dragging:dragElm},bindDragMoveEvents(),scope.$apply(function(){scope.$treeScope.$callbacks.dragStart(dragInfo.eventArgs(elements,pos))}),document_height=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight),document_width=Math.max(body.scrollWidth,body.offsetWidth,html.clientWidth,html.scrollWidth,html.offsetWidth))}}},dragMove=function(e){var prev,next,leftElmPos,topElmPos,top_scroll,bottom_scroll,target,decrease,targetX,targetY,displayElm,targetNode,targetElm,isEmpty,targetOffset,targetBefore,eventObj=UiTreeHelper.eventObj(e);if(dragElm){if(e.preventDefault(),$window.getSelection?$window.getSelection().removeAllRanges():$window.document.selection&&$window.document.selection.empty(),leftElmPos=eventObj.pageX-pos.offsetX,topElmPos=eventObj.pageY-pos.offsetY,leftElmPos<0&&(leftElmPos=0),topElmPos<0&&(topElmPos=0),topElmPos+10>document_height&&(topElmPos=document_height-10),leftElmPos+10>document_width&&(leftElmPos=document_width-10),dragElm.css({left:leftElmPos+"px",top:topElmPos+"px"}),top_scroll=window.pageYOffset||$window.document.documentElement.scrollTop,bottom_scroll=top_scroll+(window.innerHeight||$window.document.clientHeight||$window.document.clientHeight),bottom_scroll<eventObj.pageY&&bottom_scroll<=document_height&&window.scrollBy(0,10),top_scroll>eventObj.pageY&&window.scrollBy(0,-10),UiTreeHelper.positionMoved(e,pos,firstMoving),firstMoving)return void(firstMoving=!1);if(decrease=UiTreeHelper.offset(dragElm).left-UiTreeHelper.offset(placeElm).left>=config.threshold,targetX=eventObj.pageX-($window.pageXOffset||$window.document.body.scrollLeft||$window.document.documentElement.scrollLeft)-($window.document.documentElement.clientLeft||0),targetY=eventObj.pageY-($window.pageYOffset||$window.document.body.scrollTop||$window.document.documentElement.scrollTop)-($window.document.documentElement.clientTop||0),angular.isFunction(dragElm.hide)?dragElm.hide():(displayElm=dragElm[0].style.display,dragElm[0].style.display="none"),$window.document.elementFromPoint(targetX,targetY),targetElm=angular.element($window.document.elementFromPoint(targetX,targetY)),isHandleChild=UiTreeHelper.treeNodeHandlerContainerOfElement(targetElm),isHandleChild&&(targetElm=angular.element(isHandleChild)),angular.isFunction(dragElm.show)?dragElm.show():dragElm[0].style.display=displayElm,outOfBounds=!(UiTreeHelper.elementIsTreeNodeHandle(targetElm)||UiTreeHelper.elementIsTreeNode(targetElm)||UiTreeHelper.elementIsTreeNodes(targetElm)||UiTreeHelper.elementIsTree(targetElm)||UiTreeHelper.elementIsPlaceholder(targetElm)),outOfBounds&&(placeElm.remove(),treeScope&&(treeScope.resetEmptyElement(),treeScope=null)),pos.dirAx&&pos.distAxX>=config.levelThreshold&&(pos.distAxX=0,pos.distX>0&&(prev=dragInfo.prev(),prev&&!prev.collapsed&&prev.accept(scope,prev.childNodesCount())&&(prev.$childNodesScope.$element.append(placeElm),dragInfo.moveTo(prev.$childNodesScope,prev.childNodes(),prev.childNodesCount()))),pos.distX<0&&(next=dragInfo.next(),next||(target=dragInfo.parentNode(),target&&target.$parentNodesScope.accept(scope,target.index()+1)&&(target.$element.after(placeElm),dragInfo.moveTo(target.$parentNodesScope,target.siblings(),target.index()+1))))),!pos.dirAx){if(UiTreeHelper.elementIsTree(targetElm)?targetNode=targetElm.controller("uiTree").scope:UiTreeHelper.elementIsTreeNodeHandle(targetElm)?targetNode=targetElm.controller("uiTreeHandle").scope:UiTreeHelper.elementIsTreeNode(targetElm)?targetNode=targetElm.controller("uiTreeNode").scope:UiTreeHelper.elementIsTreeNodes(targetElm)?targetNode=targetElm.controller("uiTreeNodes").scope:UiTreeHelper.elementIsPlaceholder(targetElm)?targetNode=targetElm.controller("uiTreeNodes").scope:targetElm.controller("uiTreeNode")&&(targetNode=targetElm.controller("uiTreeNode").scope),isEmpty=!1,!targetNode)return;if(!targetNode.$treeScope||targetNode.$parent.nodropEnabled||targetNode.$treeScope.nodropEnabled||placeElm.css("display",""),"uiTree"===targetNode.$type&&targetNode.dragEnabled&&(isEmpty=targetNode.isEmpty()),"uiTreeHandle"===targetNode.$type&&(targetNode=targetNode.$nodeScope),"uiTreeNode"!==targetNode.$type&&!isEmpty)return;treeScope&&placeElm.parent()[0]!==treeScope.$element[0]&&(treeScope.resetEmptyElement(),treeScope=null),isEmpty?(treeScope=targetNode,targetNode.$nodesScope.accept(scope,0)&&(targetNode.place(placeElm),dragInfo.moveTo(targetNode.$nodesScope,targetNode.$nodesScope.childNodes(),0))):targetNode.dragEnabled()&&(targetElm=targetNode.$element,targetOffset=UiTreeHelper.offset(targetElm),targetBefore=targetNode.horizontal?eventObj.pageX<targetOffset.left+UiTreeHelper.width(targetElm)/2:eventObj.pageY<targetOffset.top+UiTreeHelper.height(targetElm)/2,targetNode.$parentNodesScope.accept(scope,targetNode.index())?targetBefore?(targetElm[0].parentNode.insertBefore(placeElm[0],targetElm[0]),dragInfo.moveTo(targetNode.$parentNodesScope,targetNode.siblings(),targetNode.index())):(targetElm.after(placeElm),dragInfo.moveTo(targetNode.$parentNodesScope,targetNode.siblings(),targetNode.index()+1)):!targetBefore&&targetNode.accept(scope,targetNode.childNodesCount())?(targetNode.$childNodesScope.$element.append(placeElm),dragInfo.moveTo(targetNode.$childNodesScope,targetNode.childNodes(),targetNode.childNodesCount())):outOfBounds=!0)}scope.$apply(function(){scope.$treeScope.$callbacks.dragMove(dragInfo.eventArgs(elements,pos))})}},dragEnd=function(e){var dragEventArgs=dragInfo.eventArgs(elements,pos);e.preventDefault(),unbindDragMoveEvents(),scope.$treeScope.$apply(function(){$q.when(scope.$treeScope.$callbacks.beforeDrop(dragEventArgs)).then(function(allowDrop){allowDrop!==!1&&scope.$$allowNodeDrop&&!outOfBounds?(dragInfo.apply(),scope.$treeScope.$callbacks.dropped(dragEventArgs)):bindDragStartEvents()})["catch"](function(){bindDragStartEvents()})["finally"](function(){hiddenPlaceElm.replaceWith(scope.$element),placeElm.remove(),dragElm&&(dragElm.remove(),dragElm=null),scope.$treeScope.$callbacks.dragStop(dragEventArgs),scope.$$allowNodeDrop=!1,dragInfo=null;var oldCur=document.body.getAttribute("ui-tree-cursor");null!==oldCur&&($document.find("body").css({cursor:oldCur}),document.body.removeAttribute("ui-tree-cursor"))})})},dragStartEvent=function(e){scope.dragEnabled()&&dragStart(e)},dragMoveEvent=function(e){dragMove(e)},dragEndEvent=function(e){scope.$$allowNodeDrop=!0,dragEnd(e)},dragCancelEvent=function(e){dragEnd(e)},dragDelay=function(){var to;return{exec:function(fn,ms){ms||(ms=0),this.cancel(),to=$timeout(fn,ms)},cancel:function(){$timeout.cancel(to)}}}(),bindDragStartEvents=function(){element.bind("touchstart mousedown",function(e){dragDelay.exec(function(){dragStartEvent(e)},scope.dragDelay||0)}),element.bind("touchend touchcancel mouseup",function(){dragDelay.cancel()})},bindDragStartEvents(),bindDragMoveEvents=function(){angular.element($document).bind("touchend",dragEndEvent),angular.element($document).bind("touchcancel",dragEndEvent),angular.element($document).bind("touchmove",dragMoveEvent),angular.element($document).bind("mouseup",dragEndEvent),angular.element($document).bind("mousemove",dragMoveEvent),angular.element($document).bind("mouseleave",dragCancelEvent)},unbindDragMoveEvents=function(){angular.element($document).unbind("touchend",dragEndEvent),angular.element($document).unbind("touchcancel",dragEndEvent),angular.element($document).unbind("touchmove",dragMoveEvent),angular.element($document).unbind("mouseup",dragEndEvent),angular.element($document).unbind("mousemove",dragMoveEvent),angular.element($document).unbind("mouseleave",dragCancelEvent)},keydownHandler=function(e){27===e.keyCode&&(scope.$$allowNodeDrop=!1,dragEnd(e))},angular.element($window.document).bind("keydown",keydownHandler),scope.$on("$destroy",function(){angular.element($window.document).unbind("keydown",keydownHandler)})}}}])}(),function(){angular.module("ui.tree").directive("uiTreeNodes",["treeConfig","$window",function(treeConfig){return{require:["ngModel","?^uiTreeNode","^uiTree"],restrict:"A",scope:!0,controller:"TreeNodesController",link:function(scope,element,attrs,controllersArr){var config={},ngModel=controllersArr[0],treeNodeCtrl=controllersArr[1],treeCtrl=controllersArr[2];angular.extend(config,treeConfig),config.nodesClass&&element.addClass(config.nodesClass),treeNodeCtrl?(treeNodeCtrl.scope.$childNodesScope=scope,scope.$nodeScope=treeNodeCtrl.scope):treeCtrl.scope.$nodesScope=scope,scope.$treeScope=treeCtrl.scope,ngModel&&(ngModel.$render=function(){scope.$modelValue=ngModel.$modelValue}),scope.$watch(function(){return attrs.maxDepth},function(val){"number"==typeof val&&(scope.maxDepth=val)}),scope.$watch(function(){return attrs.nodropEnabled},function(newVal){"undefined"!=typeof newVal&&(scope.nodropEnabled=!0)},!0),attrs.$observe("horizontal",function(val){scope.horizontal="undefined"!=typeof val})}}}])}(),function(){function findFirstParentElementWithAttribute(attributeName,childObj){if(void 0===childObj)return null;for(var testObj=childObj.parentNode,count=1,res="function"==typeof testObj.setAttribute&&testObj.hasAttribute(attributeName)?testObj:null;testObj&&"function"==typeof testObj.setAttribute&&!testObj.hasAttribute(attributeName);){if(testObj=testObj.parentNode,res=testObj,testObj===document.documentElement){res=null;break}count++}return res}angular.module("ui.tree").factory("UiTreeHelper",["$document","$window","treeConfig",function($document,$window,treeConfig){return{nodesData:{},setNodeAttribute:function(scope,attrName,val){if(!scope.$modelValue)return null;var data=this.nodesData[scope.$modelValue.$$hashKey];data||(data={},this.nodesData[scope.$modelValue.$$hashKey]=data),data[attrName]=val},getNodeAttribute:function(scope,attrName){if(!scope.$modelValue)return null;var data=this.nodesData[scope.$modelValue.$$hashKey];return data?data[attrName]:null},nodrag:function(targetElm){return"undefined"!=typeof targetElm.attr("data-nodrag")&&"false"!==targetElm.attr("data-nodrag")},eventObj:function(e){var obj=e;return void 0!==e.targetTouches?obj=e.targetTouches.item(0):void 0!==e.originalEvent&&void 0!==e.originalEvent.targetTouches&&(obj=e.originalEvent.targetTouches.item(0)),
obj},dragInfo:function(node){return{source:node,sourceInfo:{cloneModel:node.$treeScope.cloneEnabled===!0?angular.copy(node.$modelValue):void 0,nodeScope:node,index:node.index(),nodesScope:node.$parentNodesScope},index:node.index(),siblings:node.siblings().slice(0),parent:node.$parentNodesScope,moveTo:function(parent,siblings,index){this.parent=parent,this.siblings=siblings.slice(0);var i=this.siblings.indexOf(this.source);i>-1&&(this.siblings.splice(i,1),this.source.index()<index&&index--),this.siblings.splice(index,0,this.source),this.index=index},parentNode:function(){return this.parent.$nodeScope},prev:function(){return this.index>0?this.siblings[this.index-1]:null},next:function(){return this.index<this.siblings.length-1?this.siblings[this.index+1]:null},isClone:function(){return this.source.$treeScope.cloneEnabled===!0},clonedNode:function(node){return angular.copy(node)},isDirty:function(){return this.source.$parentNodesScope!==this.parent||this.source.index()!==this.index},isForeign:function(){return this.source.$treeScope!==this.parent.$treeScope},eventArgs:function(elements,pos){return{source:this.sourceInfo,dest:{index:this.index,nodesScope:this.parent},elements:elements,pos:pos}},apply:function(){var nodeData=this.source.$modelValue;this.parent.nodropEnabled||this.parent.$treeScope.nodropEnabled||this.isDirty()&&(this.isClone()&&this.isForeign()?this.parent.insertNode(this.index,this.sourceInfo.cloneModel):(this.source.remove(),this.parent.insertNode(this.index,nodeData)))}}},height:function(element){return element.prop("scrollHeight")},width:function(element){return element.prop("scrollWidth")},offset:function(element){var boundingClientRect=element[0].getBoundingClientRect();return{width:element.prop("offsetWidth"),height:element.prop("offsetHeight"),top:boundingClientRect.top+($window.pageYOffset||$document[0].body.scrollTop||$document[0].documentElement.scrollTop),left:boundingClientRect.left+($window.pageXOffset||$document[0].body.scrollLeft||$document[0].documentElement.scrollLeft)}},positionStarted:function(e,target){var pos={},pageX=e.pageX,pageY=e.pageY;return e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches.length>0&&(pageX=e.originalEvent.touches[0].pageX,pageY=e.originalEvent.touches[0].pageY),pos.offsetX=pageX-this.offset(target).left,pos.offsetY=pageY-this.offset(target).top,pos.startX=pos.lastX=pageX,pos.startY=pos.lastY=pageY,pos.nowX=pos.nowY=pos.distX=pos.distY=pos.dirAx=0,pos.dirX=pos.dirY=pos.lastDirX=pos.lastDirY=pos.distAxX=pos.distAxY=0,pos},positionMoved:function(e,pos,firstMoving){var newAx,pageX=e.pageX,pageY=e.pageY;return e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches.length>0&&(pageX=e.originalEvent.touches[0].pageX,pageY=e.originalEvent.touches[0].pageY),pos.lastX=pos.nowX,pos.lastY=pos.nowY,pos.nowX=pageX,pos.nowY=pageY,pos.distX=pos.nowX-pos.lastX,pos.distY=pos.nowY-pos.lastY,pos.lastDirX=pos.dirX,pos.lastDirY=pos.dirY,pos.dirX=0===pos.distX?0:pos.distX>0?1:-1,pos.dirY=0===pos.distY?0:pos.distY>0?1:-1,newAx=Math.abs(pos.distX)>Math.abs(pos.distY)?1:0,firstMoving?(pos.dirAx=newAx,void(pos.moving=!0)):(pos.dirAx!==newAx?(pos.distAxX=0,pos.distAxY=0):(pos.distAxX+=Math.abs(pos.distX),0!==pos.dirX&&pos.dirX!==pos.lastDirX&&(pos.distAxX=0),pos.distAxY+=Math.abs(pos.distY),0!==pos.dirY&&pos.dirY!==pos.lastDirY&&(pos.distAxY=0)),void(pos.dirAx=newAx))},elementIsTreeNode:function(element){return"undefined"!=typeof element.attr("ui-tree-node")},elementIsTreeNodeHandle:function(element){return"undefined"!=typeof element.attr("ui-tree-handle")},elementIsTree:function(element){return"undefined"!=typeof element.attr("ui-tree")},elementIsTreeNodes:function(element){return"undefined"!=typeof element.attr("ui-tree-nodes")},elementIsPlaceholder:function(element){return element.hasClass(treeConfig.placeholderClass)},elementContainsTreeNodeHandler:function(element){return element[0].querySelectorAll("[ui-tree-handle]").length>=1},treeNodeHandlerContainerOfElement:function(element){return findFirstParentElementWithAttribute("ui-tree-handle",element[0])}}}])}(),angular.module("recipes").directive("measureconverter",["MeasureService",function(MeasureService){return{restrict:"AE",scope:{value:"=ngModel",measure:"=",toggle:"=",precision:"="},require:"ngModel",template:'<div ng-show="toggle"><div class="btn-group"><label class="btn btn-default" ng-click="toggle=false"><div ng-hide="measure.step > 0"><i class="glyphicon glyphicon-menu-left"></i> {{measure.caption}}</div><div ng-show="measure.step > 0"><i class="glyphicon glyphicon-menu-left"></i> {{value}} {{measure.caption}}</div></label><div class="btn-group" dropdown><label class="btn btn-default" ng-click="apply()">{{newValue}} {{newCaption}} <i class="glyphicon glyphicon-retweet"></i></label><label class="btn btn-default" dropdown-toggle><span class="caret"></span></label><ul class="dropdown-menu" role="menu"><li role="menuitem" ng-repeat="item in convertList"><a ng-click="selectItem($index)">{{item.value}} {{item.caption}}</a></li></ul></div></div></div>',link:function(scope,iElement,iAttrs,ngModelController){var precision=scope.precision||3;scope.value;scope.$watch("toggle",function(toggle,oldValue){if(toggle){if(scope.convertList=[],!scope.measure)return;if(scope.convertList=scope.getConvertList(),0===scope.convertList.length)return void(scope.toggle=!1);scope.selectItem(0)}}),scope.getConvertList=function(){return scope.measure.converter?scope.measure.converter.map(function(item,i,arr){return{id:item.id,value:!item.uncountable&&scope.value?Number((scope.value*item.rate).toFixed(precision)):void 0,caption:item.caption}}):[]},scope.selectItem=function(index){MeasureService.get({measureId:scope.convertList[index].id}).$promise.then(function(newMeasure){newMeasure&&(scope.newValue=newMeasure.applyValue(scope.convertList[index].value,precision),scope.newCaption=newMeasure.caption,scope.newMeasure=newMeasure)})},scope.apply=function(){ngModelController.$setViewValue(scope.newValue),scope.measure=scope.newMeasure,scope.toggle=!1}}}}]),angular.module("recipes").directive("toggleSwitch",["$compile",function($compile){return{restrict:"EA",replace:!0,require:"ngModel",scope:{isDisabled:"=",onLabel:"@",offLabel:"@",knobLabel:"@",html:"=",onChange:"&"},template:'<div class="ats-switch" ng-click="toggle()" ng-keypress="onKeyPress($event)" ng-class="{ \'disabled\': isDisabled }" role="switch" aria-checked="{{!!model}}"><div class="switch-animate" ng-class="{\'switch-off\': !model, \'switch-on\': model}"><span class="switch-left"></span><span class="knob"></span><span class="switch-right"></span></div></div>',compile:function(element,attrs){return angular.isUndefined(attrs.onLabel)&&(attrs.onLabel="On"),angular.isUndefined(attrs.offLabel)&&(attrs.offLabel="Off"),angular.isUndefined(attrs.knobLabel)&&(attrs.knobLabel=" "),angular.isUndefined(attrs.isDisabled)&&(attrs.isDisabled=!1),angular.isUndefined(attrs.html)&&(attrs.html=!1),angular.isUndefined(attrs.tabindex)&&(attrs.tabindex=0),function(scope,iElement,iAttrs,ngModel){iElement.attr("tabindex",attrs.tabindex),scope.toggle=function(){scope.isDisabled||(scope.model=!scope.model,ngModel.$setViewValue(scope.model)),scope.onChange()};var spaceCharCode=32;scope.onKeyPress=function($event){$event.charCode!==spaceCharCode||$event.altKey||$event.ctrlKey||$event.metaKey||(scope.toggle(),$event.preventDefault())},ngModel.$formatters.push(function(modelValue){return modelValue}),ngModel.$parsers.push(function(viewValue){return viewValue}),ngModel.$viewChangeListeners.push(function(){scope.$eval(attrs.ngChange)}),ngModel.$render=function(){scope.model=ngModel.$viewValue};var bindSpan=function(span,html){span=angular.element(span);var bindAttributeName=html===!0?"ng-bind-html":"ng-bind";span.removeAttr("ng-bind-html"),span.removeAttr("ng-bind"),angular.element(span).hasClass("switch-left")&&span.attr(bindAttributeName,"onLabel"),span.hasClass("knob")&&span.attr(bindAttributeName,"knobLabel"),span.hasClass("switch-right")&&span.attr(bindAttributeName,"offLabel"),$compile(span)(scope,function(cloned,scope){span.replaceWith(cloned)})},bindSwitch=function(iElement,html){angular.forEach(iElement[0].children[0].children,function(span,index){bindSpan(span,html)})};scope.$watch("html",function(newValue){bindSwitch(iElement,newValue)})}}}}]),angular.module("recipes").directive("updowninput",function(){return{restrict:"AE",scope:{value:"=ngModel",convertable:"=",min:"=",step:"=",precision:"=",converter:"=",measure:"=",validatable:"=",validator:"&",validationId:"="},require:"ngModel",template:'<div ng-hide="converter"><div ng-hide="(measure.step > 0) || !measure"><label class="btn btn-default" ng-click="converter=true">{{measure.caption}}</label></div><div ng-show="(measure.step > 0) || !measure"><div ng-hide="form.input"><div class="btn-group"><label ng-show="convertable" class="btn btn-default" ng-click="converter=true">{{measure.caption}}</label><label class="btn btn-default" ng-click="set(-1)"><i class="glyphicon glyphicon-minus"></i></label><label class="btn btn-default" ng-click="form.input = true"><div ng-show="convertable">{{value}}</div><div ng-hide="convertable">{{value}} {{measure.caption}}</div></label><label class="btn btn-default" ng-click="set(1)"><i class="glyphicon glyphicon-plus"></i></label></div></div><div ng-show="form.input"><div class="input-group"><label ng-show="measure" class="input-group-addon">{{measure.caption}}</label><input name="input" min="{{min}}" type="number" ng-model="form.value" class="form-control"><label ng-show="form.alert" class="input-group-addon">{{form.alertText}}</label><label class="input-group-addon" ng-click="set(0,form.value)">OK</label></div></div></div></div>',link:function(scope,iElement,iAttrs,ngModelController){var min,step,precision,newValue;scope.convertable||(min=void 0!==scope.min?scope.min:0,step=void 0!==scope.step?scope.step:1),precision=void 0!==scope.precision?scope.precision:3,scope.$watch("measure",function(measure,oldValue){measure&&(min=measure.min,step=measure.step,scope.convertable&&(scope.convertable=measure.converter))},!0),ngModelController.$render=function(){scope.form={alert:!1,alertText:"",value:scope.value}},scope.set=function(sign,value){scope.form={alert:!1,alertText:"",value:scope.value},newValue=scope.value,void 0!==value?newValue=Number(value.toFixed(precision)):sign<0?newValue=Number((scope.value-step).toFixed(precision)):sign>0&&(newValue=Number((scope.value+step).toFixed(precision))),newValue<min?(newValue=min,scope.form.alert=!0,scope.form.alertText=">="+min+"!"):scope.validatable?scope.validator({id:scope.validationId,value:newValue,oldValue:scope.value})&&(ngModelController.$setViewValue(newValue),scope.form={alert:!1,alertText:"",input:!1,value:newValue}):(ngModelController.$setViewValue(newValue),scope.form={alert:!1,alertText:"",input:!1,value:newValue})}}}}),angular.module("recipes").directive("ngThumb",["$window",function($window){var helper={support:!(!$window.FileReader||!$window.CanvasRenderingContext2D),isFile:function(item){return angular.isObject(item)&&item instanceof $window.File},isImage:function(file){var type="|"+file.type.slice(file.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(type)!==-1}};return{restrict:"A",template:"<canvas/>",link:function(scope,element,attributes){function onLoadFile(event){var img=new Image;img.onload=onLoadImage,img.src=event.target.result}function onLoadImage(){var width=params.width||this.width/this.height*params.height,height=params.height||this.height/this.width*params.width;canvas.attr({width:width,height:height}),canvas[0].getContext("2d").drawImage(this,0,0,width,height)}if(helper.support){var params=scope.$eval(attributes.ngThumb);if(helper.isFile(params.file)&&helper.isImage(params.file)){var canvas=element.find("canvas"),reader=new FileReader;reader.onload=onLoadFile,reader.readAsDataURL(params.file)}}}}}]),function(root,factory){"function"==typeof define&&define.amd?define(["angular"],factory):"object"==typeof module&&module.exports?module.exports=factory(require("angular")):factory(root.angular)}(this,function(angular){var module=angular.module("rzModule",[]).factory("RzSliderOptions",function(){var defaultOptions={floor:0,ceil:null,step:1,precision:0,minRange:0,id:null,translate:null,getLegend:null,stepsArray:null,draggableRange:!1,draggableRangeOnly:!1,showSelectionBar:!1,showSelectionBarEnd:!1,showSelectionBarFromValue:null,hidePointerLabels:!1,hideLimitLabels:!1,readOnly:!1,disabled:!1,interval:350,showTicks:!1,showTicksValues:!1,ticksTooltip:null,ticksValuesTooltip:null,vertical:!1,getSelectionBarColor:null,getPointerColor:null,keyboardSupport:!0,scale:1,enforceStep:!0,enforceRange:!1,noSwitching:!1,onlyBindHandles:!1,onStart:null,onChange:null,onEnd:null,rightToLeft:!1},globalOptions={},factory={};return factory.options=function(value){angular.extend(globalOptions,value)},factory.getOptions=function(options){return angular.extend({},defaultOptions,globalOptions,options)},factory}).factory("rzThrottle",["$timeout",function($timeout){return function(func,wait,options){var context,args,result,getTime=Date.now||function(){return(new Date).getTime()},timeout=null,previous=0;options=options||{};var later=function(){previous=getTime(),timeout=null,result=func.apply(context,args),context=args=null};return function(){var now=getTime(),remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0?($timeout.cancel(timeout),timeout=null,previous=now,result=func.apply(context,args),context=args=null):timeout||options.trailing===!1||(timeout=$timeout(later,remaining)),result}}}]).factory("RzSlider",["$timeout","$document","$window","$compile","RzSliderOptions","rzThrottle",function($timeout,$document,$window,$compile,RzSliderOptions,rzThrottle){var Slider=function(scope,sliderElem){this.scope=scope,this.sliderElem=sliderElem,this.range=void 0!==this.scope.rzSliderModel&&void 0!==this.scope.rzSliderHigh,this.dragging={active:!1,value:0,difference:0,offset:0,lowLimit:0,highLimit:0},this.positionProperty="left",this.dimensionProperty="width",this.handleHalfDim=0,this.maxPos=0,this.precision=0,this.step=1,this.tracking="",this.minValue=0,this.maxValue=0,this.valueRange=0,this.intermediateTicks=!1,this.initHasRun=!1,this.internalChange=!1,this.fullBar=null,this.selBar=null,this.minH=null,this.maxH=null,this.flrLab=null,this.ceilLab=null,this.minLab=null,this.maxLab=null,this.cmbLab=null,this.ticks=null,this.init()};return Slider.prototype={init:function(){var thrLow,thrHigh,self=this,calcDimFn=function(){self.calcViewDimensions()};this.applyOptions(),this.initElemHandles(),this.manageElementsStyle(),this.setDisabledState(),this.calcViewDimensions(),this.setMinAndMax(),this.addAccessibility(),this.updateCeilLab(),this.updateFloorLab(),this.initHandles(),this.manageEventsBindings(),this.scope.$on("reCalcViewDimensions",calcDimFn),angular.element($window).on("resize",calcDimFn),this.initHasRun=!0,thrLow=rzThrottle(function(){self.onLowHandleChange()},self.options.interval),thrHigh=rzThrottle(function(){self.onHighHandleChange()},self.options.interval),this.scope.$on("rzSliderForceRender",function(){self.resetLabelsValue(),thrLow(),self.range&&thrHigh(),self.resetSlider()}),this.scope.$watch("rzSliderOptions()",function(newValue,oldValue){newValue!==oldValue&&(self.applyOptions(),self.resetSlider())},!0),this.scope.$watch("rzSliderModel",function(newValue,oldValue){self.internalChange||newValue!==oldValue&&thrLow()}),this.scope.$watch("rzSliderHigh",function(newValue,oldValue){self.internalChange||newValue!==oldValue&&(null!==newValue&&thrHigh(),(self.range&&null===newValue||!self.range&&null!==newValue)&&(self.applyOptions(),self.resetSlider()))}),this.scope.$on("$destroy",function(){self.unbindEvents(),angular.element($window).off("resize",calcDimFn)})},onLowHandleChange:function(){this.setMinAndMax(),this.updateLowHandle(this.valueToOffset(this.scope.rzSliderModel)),this.updateSelectionBar(),this.updateTicksScale(),this.updateAriaAttributes(),this.range&&this.updateCmbLabel()},onHighHandleChange:function(){this.setMinAndMax(),this.updateHighHandle(this.valueToOffset(this.scope.rzSliderHigh)),this.updateSelectionBar(),this.updateTicksScale(),this.updateCmbLabel(),this.updateAriaAttributes()},applyOptions:function(){var sliderOptions;sliderOptions=this.scope.rzSliderOptions?this.scope.rzSliderOptions():{},this.options=RzSliderOptions.getOptions(sliderOptions),this.options.step<=0&&(this.options.step=1),this.range=void 0!==this.scope.rzSliderModel&&void 0!==this.scope.rzSliderHigh,this.options.draggableRange=this.range&&this.options.draggableRange,this.options.draggableRangeOnly=this.range&&this.options.draggableRangeOnly,this.options.draggableRangeOnly&&(this.options.draggableRange=!0),this.options.showTicks=this.options.showTicks||this.options.showTicksValues,this.scope.showTicks=this.options.showTicks,angular.isNumber(this.options.showTicks)&&(this.intermediateTicks=!0),this.options.showSelectionBar=this.options.showSelectionBar||this.options.showSelectionBarEnd||null!==this.options.showSelectionBarFromValue,this.options.stepsArray?this.parseStepsArray():(this.options.translate?this.customTrFn=this.options.translate:this.customTrFn=function(value){return String(value)},this.options.getLegend&&(this.getLegend=this.options.getLegend)),this.options.vertical&&(this.positionProperty="bottom",this.dimensionProperty="height")},parseStepsArray:function(){this.options.floor=0,this.options.ceil=this.options.stepsArray.length-1,this.options.step=1,this.options.translate?this.customTrFn=this.options.translate:this.customTrFn=function(index){var step=this.options.stepsArray[index];return angular.isObject(step)?step.value:step},this.getLegend=function(index){var step=this.options.stepsArray[index];return angular.isObject(step)?step.legend:null}},resetSlider:function(){this.manageElementsStyle(),this.addAccessibility(),this.setMinAndMax(),this.updateCeilLab(),this.updateFloorLab(),this.unbindEvents(),this.manageEventsBindings(),this.setDisabledState(),this.calcViewDimensions()},initElemHandles:function(){angular.forEach(this.sliderElem.children(),function(elem,index){var jElem=angular.element(elem);switch(index){case 0:this.fullBar=jElem;break;case 1:this.selBar=jElem;break;case 2:this.minH=jElem;break;case 3:this.maxH=jElem;break;case 4:this.flrLab=jElem;break;case 5:this.ceilLab=jElem;break;case 6:this.minLab=jElem;break;case 7:this.maxLab=jElem;break;case 8:this.cmbLab=jElem;break;case 9:this.ticks=jElem}},this),this.selBar.rzsp=0,this.minH.rzsp=0,this.maxH.rzsp=0,this.flrLab.rzsp=0,this.ceilLab.rzsp=0,this.minLab.rzsp=0,this.maxLab.rzsp=0,this.cmbLab.rzsp=0},manageElementsStyle:function(){this.range?this.maxH.css("display",""):this.maxH.css("display","none"),this.alwaysHide(this.flrLab,this.options.showTicksValues||this.options.hideLimitLabels),this.alwaysHide(this.ceilLab,this.options.showTicksValues||this.options.hideLimitLabels);var hideLabelsForTicks=this.options.showTicksValues&&!this.intermediateTicks;this.alwaysHide(this.minLab,hideLabelsForTicks||this.options.hidePointerLabels),this.alwaysHide(this.maxLab,hideLabelsForTicks||!this.range||this.options.hidePointerLabels),this.alwaysHide(this.cmbLab,hideLabelsForTicks||!this.range||this.options.hidePointerLabels),this.alwaysHide(this.selBar,!this.range&&!this.options.showSelectionBar),this.options.vertical&&this.sliderElem.addClass("rz-vertical"),this.options.draggableRange?this.selBar.addClass("rz-draggable"):this.selBar.removeClass("rz-draggable"),this.intermediateTicks&&this.options.showTicksValues&&this.ticks.addClass("rz-ticks-values-under")},alwaysHide:function(el,hide){el.rzAlwaysHide=hide,hide?this.hideEl(el):this.showEl(el)},manageEventsBindings:function(){this.options.disabled||this.options.readOnly?this.unbindEvents():this.bindEvents()},setDisabledState:function(){this.options.disabled?this.sliderElem.attr("disabled","disabled"):this.sliderElem.attr("disabled",null)},resetLabelsValue:function(){this.minLab.rzsv=void 0,this.maxLab.rzsv=void 0},initHandles:function(){this.updateLowHandle(this.valueToOffset(this.scope.rzSliderModel)),this.range&&this.updateHighHandle(this.valueToOffset(this.scope.rzSliderHigh)),this.updateSelectionBar(),this.range&&this.updateCmbLabel(),this.updateTicksScale()},translateFn:function(value,label,which,useCustomTr){useCustomTr=void 0===useCustomTr||useCustomTr;var valStr=String(useCustomTr?this.customTrFn(value,this.options.id,which):value),getDimension=!1;(void 0===label.rzsv||label.rzsv.length!==valStr.length||label.rzsv.length>0&&0===label.rzsd)&&(getDimension=!0,label.rzsv=valStr),label.html(valStr),getDimension&&this.getDimension(label)},setMinAndMax:function(){this.step=+this.options.step,this.precision=+this.options.precision,this.minValue=this.options.floor,this.options.enforceStep&&(this.scope.rzSliderModel=this.roundStep(this.scope.rzSliderModel),this.range&&(this.scope.rzSliderHigh=this.roundStep(this.scope.rzSliderHigh))),null!==this.options.ceil?this.maxValue=this.options.ceil:this.maxValue=this.options.ceil=this.range?this.scope.rzSliderHigh:this.scope.rzSliderModel,this.options.enforceRange&&(this.scope.rzSliderModel=this.sanitizeValue(this.scope.rzSliderModel),this.range&&(this.scope.rzSliderHigh=this.sanitizeValue(this.scope.rzSliderHigh))),this.valueRange=this.maxValue-this.minValue},addAccessibility:function(){this.minH.attr("role","slider"),this.updateAriaAttributes(),!this.options.keyboardSupport||this.options.readOnly||this.options.disabled?this.minH.attr("tabindex",""):this.minH.attr("tabindex","0"),this.options.vertical&&this.minH.attr("aria-orientation","vertical"),this.range&&(this.maxH.attr("role","slider"),!this.options.keyboardSupport||this.options.readOnly||this.options.disabled?this.maxH.attr("tabindex",""):this.maxH.attr("tabindex","0"),this.options.vertical&&this.maxH.attr("aria-orientation","vertical"))},updateAriaAttributes:function(){this.minH.attr({"aria-valuenow":this.scope.rzSliderModel,"aria-valuetext":this.customTrFn(this.scope.rzSliderModel,this.options.id,"model"),"aria-valuemin":this.minValue,"aria-valuemax":this.maxValue}),this.range&&this.maxH.attr({"aria-valuenow":this.scope.rzSliderHigh,"aria-valuetext":this.customTrFn(this.scope.rzSliderHigh,this.options.id,"high"),"aria-valuemin":this.minValue,"aria-valuemax":this.maxValue})},calcViewDimensions:function(){var handleWidth=this.getDimension(this.minH);this.handleHalfDim=handleWidth/2,this.barDimension=this.getDimension(this.fullBar),this.maxPos=this.barDimension-handleWidth,this.getDimension(this.sliderElem),this.sliderElem.rzsp=this.sliderElem[0].getBoundingClientRect()[this.positionProperty],this.initHasRun&&(this.updateFloorLab(),this.updateCeilLab(),this.initHandles())},updateTicksScale:function(){if(this.options.showTicks){var step=this.step;this.intermediateTicks&&(step=this.options.showTicks);var ticksCount=Math.round((this.maxValue-this.minValue)/step)+1;this.scope.ticks=[];for(var i=0;i<ticksCount;i++){var value=this.roundStep(this.minValue+i*step),tick={selected:this.isTickSelected(value)};if(tick.selected&&this.options.getSelectionBarColor&&(tick.style={"background-color":this.getSelectionBarColor()}),this.options.ticksTooltip&&(tick.tooltip=this.options.ticksTooltip(value),tick.tooltipPlacement=this.options.vertical?"right":"top"),this.options.showTicksValues&&(tick.value=this.getDisplayValue(value,"tick-value"),this.options.ticksValuesTooltip&&(tick.valueTooltip=this.options.ticksValuesTooltip(value),tick.valueTooltipPlacement=this.options.vertical?"right":"top")),this.getLegend){var legend=this.getLegend(value,this.options.id);legend&&(tick.legend=legend)}this.options.rightToLeft?this.scope.ticks.unshift(tick):this.scope.ticks.push(tick)}}},isTickSelected:function(value){if(!this.range)if(null!==this.options.showSelectionBarFromValue){var center=this.options.showSelectionBarFromValue;if(this.scope.rzSliderModel>center&&value>=center&&value<=this.scope.rzSliderModel)return!0;if(this.scope.rzSliderModel<center&&value<=center&&value>=this.scope.rzSliderModel)return!0}else if(this.options.showSelectionBarEnd){if(value>=this.scope.rzSliderModel)return!0}else if(this.options.showSelectionBar&&value<=this.scope.rzSliderModel)return!0;return!!(this.range&&value>=this.scope.rzSliderModel&&value<=this.scope.rzSliderHigh)},updateFloorLab:function(){this.translateFn(this.minValue,this.flrLab,"floor"),this.getDimension(this.flrLab);var position=this.options.rightToLeft?this.barDimension-this.flrLab.rzsd:0;this.setPosition(this.flrLab,position)},updateCeilLab:function(){this.translateFn(this.maxValue,this.ceilLab,"ceil"),this.getDimension(this.ceilLab);var position=this.options.rightToLeft?0:this.barDimension-this.ceilLab.rzsd;this.setPosition(this.ceilLab,position)},updateHandles:function(which,newOffset){"rzSliderModel"===which?this.updateLowHandle(newOffset):this.updateHighHandle(newOffset),this.updateSelectionBar(),this.updateTicksScale(),this.range&&this.updateCmbLabel()},getHandleLabelPos:function(labelName,newOffset){var labelRzsd=this[labelName].rzsd,nearHandlePos=newOffset-labelRzsd/2+this.handleHalfDim,endOfBarPos=this.barDimension-labelRzsd;return this.options.rightToLeft&&"minLab"===labelName||!this.options.rightToLeft&&"maxLab"===labelName?Math.min(nearHandlePos,endOfBarPos):Math.min(Math.max(nearHandlePos,0),endOfBarPos)},updateLowHandle:function(newOffset){if(this.setPosition(this.minH,newOffset),this.translateFn(this.scope.rzSliderModel,this.minLab,"model"),this.setPosition(this.minLab,this.getHandleLabelPos("minLab",newOffset)),this.options.getPointerColor){var pointercolor=this.getPointerColor("min");this.scope.minPointerStyle={backgroundColor:pointercolor}}this.shFloorCeil()},updateHighHandle:function(newOffset){if(this.setPosition(this.maxH,newOffset),this.translateFn(this.scope.rzSliderHigh,this.maxLab,"high"),this.setPosition(this.maxLab,this.getHandleLabelPos("maxLab",newOffset)),this.options.getPointerColor){var pointercolor=this.getPointerColor("max");this.scope.maxPointerStyle={backgroundColor:pointercolor}}this.shFloorCeil()},shFloorCeil:function(){var flHidden=!1,clHidden=!1,isRTL=this.options.rightToLeft,flrLabPos=this.flrLab.rzsp,flrLabDim=this.flrLab.rzsd,minLabPos=this.minLab.rzsp,minLabDim=this.minLab.rzsd,maxLabPos=this.maxLab.rzsp,maxLabDim=this.maxLab.rzsd,ceilLabPos=this.ceilLab.rzsp,halfHandle=this.handleHalfDim,isMinLabAtFloor=isRTL?minLabPos+minLabDim>=flrLabPos-flrLabDim-5:minLabPos<=flrLabPos+flrLabDim+5,isMinLabAtCeil=isRTL?minLabPos-minLabDim<=ceilLabPos+halfHandle+10:minLabPos+minLabDim>=ceilLabPos-halfHandle-10,isMaxLabAtFloor=isRTL?maxLabPos>=flrLabPos-flrLabDim-halfHandle:maxLabPos<=flrLabPos+flrLabDim+halfHandle,isMaxLabAtCeil=isRTL?maxLabPos-maxLabDim<=ceilLabPos+10:maxLabPos+maxLabDim>=ceilLabPos-10;isMinLabAtFloor?(flHidden=!0,this.hideEl(this.flrLab)):(flHidden=!1,this.showEl(this.flrLab)),isMinLabAtCeil?(clHidden=!0,this.hideEl(this.ceilLab)):(clHidden=!1,this.showEl(this.ceilLab)),this.range&&(isMaxLabAtCeil?this.hideEl(this.ceilLab):clHidden||this.showEl(this.ceilLab),isMaxLabAtFloor?this.hideEl(this.flrLab):flHidden||this.showEl(this.flrLab))},updateSelectionBar:function(){var position=0,dimension=0,isSelectionBarFromRight=this.options.rightToLeft?!this.options.showSelectionBarEnd:this.options.showSelectionBarEnd,positionForRange=this.options.rightToLeft?this.maxH.rzsp+this.handleHalfDim:this.minH.rzsp+this.handleHalfDim;if(this.range)dimension=Math.abs(this.maxH.rzsp-this.minH.rzsp),position=positionForRange;else if(null!==this.options.showSelectionBarFromValue){var center=this.options.showSelectionBarFromValue,centerPosition=this.valueToOffset(center),isModelGreaterThanCenter=this.options.rightToLeft?this.scope.rzSliderModel<=center:this.scope.rzSliderModel>center;isModelGreaterThanCenter?(dimension=this.minH.rzsp-centerPosition,position=centerPosition+this.handleHalfDim):(dimension=centerPosition-this.minH.rzsp,position=this.minH.rzsp+this.handleHalfDim)}else isSelectionBarFromRight?(dimension=Math.abs(this.maxPos-this.minH.rzsp)+this.handleHalfDim,position=this.minH.rzsp+this.handleHalfDim):(dimension=Math.abs(this.maxH.rzsp-this.minH.rzsp)+this.handleHalfDim,position=0);if(this.setDimension(this.selBar,dimension),this.setPosition(this.selBar,position),this.options.getSelectionBarColor){var color=this.getSelectionBarColor();this.scope.barStyle={backgroundColor:color}}},getSelectionBarColor:function(){return this.range?this.options.getSelectionBarColor(this.scope.rzSliderModel,this.scope.rzSliderHigh):this.options.getSelectionBarColor(this.scope.rzSliderModel)},getPointerColor:function(pointerType){return"max"===pointerType?this.options.getPointerColor(this.scope.rzSliderHigh,pointerType):this.options.getPointerColor(this.scope.rzSliderModel,pointerType)},updateCmbLabel:function(){var isLabelOverlap=null;if(isLabelOverlap=this.options.rightToLeft?this.minLab.rzsp-this.minLab.rzsd-10<=this.maxLab.rzsp:this.minLab.rzsp+this.minLab.rzsd+10>=this.maxLab.rzsp){var lowTr=this.getDisplayValue(this.scope.rzSliderModel,"model"),highTr=this.getDisplayValue(this.scope.rzSliderHigh,"high"),labelVal="";labelVal=lowTr===highTr?lowTr:this.options.rightToLeft?highTr+" - "+lowTr:lowTr+" - "+highTr,this.translateFn(labelVal,this.cmbLab,"cmb",!1);var pos=Math.min(Math.max(this.selBar.rzsp+this.selBar.rzsd/2-this.cmbLab.rzsd/2,0),this.barDimension-this.cmbLab.rzsd);this.setPosition(this.cmbLab,pos),this.hideEl(this.minLab),this.hideEl(this.maxLab),this.showEl(this.cmbLab)}else this.showEl(this.maxLab),this.showEl(this.minLab),this.hideEl(this.cmbLab)},getDisplayValue:function(value,which){return this.customTrFn(value,this.options.id,which)},roundStep:function(value,customStep){var step=customStep?customStep:this.step,steppedDifference=parseFloat((value-this.minValue)/step).toPrecision(12);steppedDifference=Math.round(+steppedDifference)*step;var newValue=(this.minValue+steppedDifference).toFixed(this.precision);return+newValue},hideEl:function(element){return element.css({opacity:0})},showEl:function(element){return element.rzAlwaysHide?element:element.css({opacity:1})},setPosition:function(elem,pos){elem.rzsp=pos;var css={};return css[this.positionProperty]=pos+"px",elem.css(css),pos},getDimension:function(elem){var val=elem[0].getBoundingClientRect();return this.options.vertical?elem.rzsd=(val.bottom-val.top)*this.options.scale:elem.rzsd=(val.right-val.left)*this.options.scale,elem.rzsd},setDimension:function(elem,dim){elem.rzsd=dim;var css={};return css[this.dimensionProperty]=dim+"px",elem.css(css),dim},valueToOffset:function(val){return this.options.rightToLeft?(this.maxValue-this.sanitizeValue(val))*this.maxPos/this.valueRange||0:(this.sanitizeValue(val)-this.minValue)*this.maxPos/this.valueRange||0},sanitizeValue:function(val){return Math.min(Math.max(val,this.minValue),this.maxValue)},offsetToValue:function(offset){return this.options.rightToLeft?(1-offset/this.maxPos)*this.valueRange+this.minValue:offset/this.maxPos*this.valueRange+this.minValue},getEventXY:function(event){var clientXY=this.options.vertical?"clientY":"clientX";return clientXY in event?event[clientXY]:void 0===event.originalEvent?event.touches[0][clientXY]:event.originalEvent.touches[0][clientXY]},getEventPosition:function(event){var sliderPos=this.sliderElem.rzsp,eventPos=0;return eventPos=this.options.vertical?-this.getEventXY(event)+sliderPos:this.getEventXY(event)-sliderPos,(eventPos-this.handleHalfDim)*this.options.scale},getEventNames:function(event){var eventNames={moveEvent:"",endEvent:""};return event.touches||void 0!==event.originalEvent&&event.originalEvent.touches?(eventNames.moveEvent="touchmove",eventNames.endEvent="touchend"):(eventNames.moveEvent="mousemove",eventNames.endEvent="mouseup"),eventNames},getNearestHandle:function(event){if(!this.range)return this.minH;var offset=this.getEventPosition(event),distanceMin=Math.abs(offset-this.minH.rzsp),distanceMax=Math.abs(offset-this.maxH.rzsp);
return distanceMin<distanceMax?this.minH:distanceMin>distanceMax?this.maxH:this.options.rightToLeft?offset>this.minH.rzsp?this.minH:this.maxH:offset<this.minH.rzsp?this.minH:this.maxH},focusElement:function(el){var DOM_ELEMENT=0;el[DOM_ELEMENT].focus()},bindEvents:function(){var barTracking,barStart,barMove;this.options.draggableRange?(barTracking="rzSliderDrag",barStart=this.onDragStart,barMove=this.onDragMove):(barTracking="rzSliderModel",barStart=this.onStart,barMove=this.onMove),this.options.onlyBindHandles||(this.selBar.on("mousedown",angular.bind(this,barStart,null,barTracking)),this.selBar.on("mousedown",angular.bind(this,barMove,this.selBar))),this.options.draggableRangeOnly?(this.minH.on("mousedown",angular.bind(this,barStart,null,barTracking)),this.maxH.on("mousedown",angular.bind(this,barStart,null,barTracking))):(this.minH.on("mousedown",angular.bind(this,this.onStart,this.minH,"rzSliderModel")),this.range&&this.maxH.on("mousedown",angular.bind(this,this.onStart,this.maxH,"rzSliderHigh")),this.options.onlyBindHandles||(this.fullBar.on("mousedown",angular.bind(this,this.onStart,null,null)),this.fullBar.on("mousedown",angular.bind(this,this.onMove,this.fullBar)),this.ticks.on("mousedown",angular.bind(this,this.onStart,null,null)),this.ticks.on("mousedown",angular.bind(this,this.onTickClick,this.ticks)))),this.options.onlyBindHandles||(this.selBar.on("touchstart",angular.bind(this,barStart,null,barTracking)),this.selBar.on("touchstart",angular.bind(this,barMove,this.selBar))),this.options.draggableRangeOnly?(this.minH.on("touchstart",angular.bind(this,barStart,null,barTracking)),this.maxH.on("touchstart",angular.bind(this,barStart,null,barTracking))):(this.minH.on("touchstart",angular.bind(this,this.onStart,this.minH,"rzSliderModel")),this.range&&this.maxH.on("touchstart",angular.bind(this,this.onStart,this.maxH,"rzSliderHigh")),this.options.onlyBindHandles||(this.fullBar.on("touchstart",angular.bind(this,this.onStart,null,null)),this.fullBar.on("touchstart",angular.bind(this,this.onMove,this.fullBar)),this.ticks.on("touchstart",angular.bind(this,this.onStart,null,null)),this.ticks.on("touchstart",angular.bind(this,this.onTickClick,this.ticks)))),this.options.keyboardSupport&&(this.minH.on("focus",angular.bind(this,this.onPointerFocus,this.minH,"rzSliderModel")),this.range&&this.maxH.on("focus",angular.bind(this,this.onPointerFocus,this.maxH,"rzSliderHigh")))},unbindEvents:function(){this.minH.off(),this.maxH.off(),this.fullBar.off(),this.selBar.off(),this.ticks.off()},onStart:function(pointer,ref,event){var ehMove,ehEnd,eventNames=this.getEventNames(event);event.stopPropagation(),event.preventDefault(),this.calcViewDimensions(),pointer?this.tracking=ref:(pointer=this.getNearestHandle(event),this.tracking=pointer===this.minH?"rzSliderModel":"rzSliderHigh"),pointer.addClass("rz-active"),this.options.keyboardSupport&&this.focusElement(pointer),ehMove=angular.bind(this,this.dragging.active?this.onDragMove:this.onMove,pointer),ehEnd=angular.bind(this,this.onEnd,ehMove),$document.on(eventNames.moveEvent,ehMove),$document.one(eventNames.endEvent,ehEnd),this.callOnStart()},onMove:function(pointer,event,fromTick){var newValue,newOffset=this.getEventPosition(event),ceilValue=this.options.rightToLeft?this.minValue:this.maxValue,flrValue=this.options.rightToLeft?this.maxValue:this.minValue;newOffset<=0?newValue=flrValue:newOffset>=this.maxPos?newValue=ceilValue:(newValue=this.offsetToValue(newOffset),newValue=fromTick&&angular.isNumber(this.options.showTicks)?this.roundStep(newValue,this.options.showTicks):this.roundStep(newValue)),this.positionTrackingHandle(newValue)},onEnd:function(ehMove,event){var moveEventName=this.getEventNames(event).moveEvent;this.options.keyboardSupport||(this.minH.removeClass("rz-active"),this.maxH.removeClass("rz-active"),this.tracking=""),this.dragging.active=!1,$document.off(moveEventName,ehMove),this.scope.$emit("slideEnded"),this.callOnEnd()},onTickClick:function(pointer,event){this.onMove(pointer,event,!0)},onPointerFocus:function(pointer,ref){this.tracking=ref,pointer.one("blur",angular.bind(this,this.onPointerBlur,pointer)),pointer.on("keydown",angular.bind(this,this.onKeyboardEvent)),pointer.addClass("rz-active")},onPointerBlur:function(pointer){pointer.off("keydown"),this.tracking="",pointer.removeClass("rz-active")},getKeyActions:function(currentValue){var increaseStep=currentValue+this.step,decreaseStep=currentValue-this.step,increasePage=currentValue+this.valueRange/10,decreasePage=currentValue-this.valueRange/10,actions={UP:increaseStep,DOWN:decreaseStep,LEFT:decreaseStep,RIGHT:increaseStep,PAGEUP:increasePage,PAGEDOWN:decreasePage,HOME:this.minValue,END:this.maxValue};return this.options.rightToLeft&&(actions.LEFT=increaseStep,actions.RIGHT=decreaseStep,this.options.vertical&&(actions.UP=decreaseStep,actions.DOWN=increaseStep)),actions},onKeyboardEvent:function(event){var currentValue=this.scope[this.tracking],keyCode=event.keyCode||event.which,keys={38:"UP",40:"DOWN",37:"LEFT",39:"RIGHT",33:"PAGEUP",34:"PAGEDOWN",36:"HOME",35:"END"},actions=this.getKeyActions(currentValue),key=keys[keyCode],action=actions[key];if(null!==action&&""!==this.tracking){event.preventDefault();var newValue=this.roundStep(this.sanitizeValue(action));if(this.options.draggableRangeOnly){var newMinValue,newMaxValue,difference=this.scope.rzSliderHigh-this.scope.rzSliderModel;"rzSliderModel"===this.tracking?(newMinValue=newValue,newMaxValue=newValue+difference,newMaxValue>this.maxValue&&(newMaxValue=this.maxValue,newMinValue=newMaxValue-difference)):(newMaxValue=newValue,newMinValue=newValue-difference,newMinValue<this.minValue&&(newMinValue=this.minValue,newMaxValue=newMinValue+difference)),this.positionTrackingBar(newMinValue,newMaxValue)}else this.positionTrackingHandle(newValue)}},onDragStart:function(pointer,ref,event){var offset=this.getEventPosition(event);this.dragging={active:!0,value:this.offsetToValue(offset),difference:this.scope.rzSliderHigh-this.scope.rzSliderModel,lowLimit:this.options.rightToLeft?this.minH.rzsp-offset:offset-this.minH.rzsp,highLimit:this.options.rightToLeft?offset-this.maxH.rzsp:this.maxH.rzsp-offset},this.onStart(pointer,ref,event)},getValue:function(type,newOffset,outOfBounds,isAbove){var isRTL=this.options.rightToLeft,value=null;return value="min"===type?outOfBounds?isAbove?isRTL?this.minValue:this.maxValue-this.dragging.difference:isRTL?this.maxValue-this.dragging.difference:this.minValue:isRTL?this.offsetToValue(newOffset+this.dragging.lowLimit):this.offsetToValue(newOffset-this.dragging.lowLimit):outOfBounds?isAbove?isRTL?this.minValue+this.dragging.difference:this.maxValue:isRTL?this.maxValue:this.minValue+this.dragging.difference:isRTL?this.offsetToValue(newOffset+this.dragging.lowLimit)+this.dragging.difference:this.offsetToValue(newOffset-this.dragging.lowLimit)+this.dragging.difference,this.roundStep(value)},onDragMove:function(pointer,event){var newMinValue,newMaxValue,ceilLimit,flrLimit,isUnderFlrLimit,isOverCeilLimit,flrH,ceilH,newOffset=this.getEventPosition(event);if(this.options.rightToLeft?(ceilLimit=this.dragging.lowLimit,flrLimit=this.dragging.highLimit,flrH=this.maxH,ceilH=this.minH):(ceilLimit=this.dragging.highLimit,flrLimit=this.dragging.lowLimit,flrH=this.minH,ceilH=this.maxH),isUnderFlrLimit=newOffset<=flrLimit,isOverCeilLimit=newOffset>=this.maxPos-ceilLimit,isUnderFlrLimit){if(0===flrH.rzsp)return;newMinValue=this.getValue("min",newOffset,!0,!1),newMaxValue=this.getValue("max",newOffset,!0,!1)}else if(isOverCeilLimit){if(ceilH.rzsp===this.maxPos)return;newMaxValue=this.getValue("max",newOffset,!0,!0),newMinValue=this.getValue("min",newOffset,!0,!0)}else newMinValue=this.getValue("min",newOffset,!1),newMaxValue=this.getValue("max",newOffset,!1);this.positionTrackingBar(newMinValue,newMaxValue)},positionTrackingBar:function(newMinValue,newMaxValue){this.scope.rzSliderModel=newMinValue,this.scope.rzSliderHigh=newMaxValue,this.updateHandles("rzSliderModel",this.valueToOffset(newMinValue)),this.updateHandles("rzSliderHigh",this.valueToOffset(newMaxValue)),this.applyModel()},positionTrackingHandle:function(newValue){var valueChanged=!1;this.range&&(newValue=this.applyMinRange(newValue),"rzSliderModel"===this.tracking&&newValue>this.scope.rzSliderHigh?(this.options.noSwitching&&this.scope.rzSliderHigh!==this.minValue?newValue=this.applyMinRange(this.scope.rzSliderHigh):(this.scope[this.tracking]=this.scope.rzSliderHigh,this.updateHandles(this.tracking,this.maxH.rzsp),this.updateAriaAttributes(),this.tracking="rzSliderHigh",this.minH.removeClass("rz-active"),this.maxH.addClass("rz-active"),this.options.keyboardSupport&&this.focusElement(this.maxH)),valueChanged=!0):"rzSliderHigh"===this.tracking&&newValue<this.scope.rzSliderModel&&(this.options.noSwitching&&this.scope.rzSliderModel!==this.maxValue?newValue=this.applyMinRange(this.scope.rzSliderModel):(this.scope[this.tracking]=this.scope.rzSliderModel,this.updateHandles(this.tracking,this.minH.rzsp),this.updateAriaAttributes(),this.tracking="rzSliderModel",this.maxH.removeClass("rz-active"),this.minH.addClass("rz-active"),this.options.keyboardSupport&&this.focusElement(this.minH)),valueChanged=!0)),this.scope[this.tracking]!==newValue&&(this.scope[this.tracking]=newValue,this.updateHandles(this.tracking,this.valueToOffset(newValue)),this.updateAriaAttributes(),valueChanged=!0),valueChanged&&this.applyModel()},applyMinRange:function(newValue){if(0!==this.options.minRange){var oppositeValue="rzSliderModel"===this.tracking?this.scope.rzSliderHigh:this.scope.rzSliderModel,difference=Math.abs(newValue-oppositeValue);if(difference<this.options.minRange)return"rzSliderModel"===this.tracking?this.scope.rzSliderHigh-this.options.minRange:this.scope.rzSliderModel+this.options.minRange}return newValue},applyModel:function(){this.internalChange=!0,this.scope.$apply(),this.callOnChange(),this.internalChange=!1},callOnStart:function(){if(this.options.onStart){var self=this;this.scope.$evalAsync(function(){self.options.onStart(self.options.id,self.scope.rzSliderModel,self.scope.rzSliderHigh)})}},callOnChange:function(){if(this.options.onChange){var self=this;this.scope.$evalAsync(function(){self.options.onChange(self.options.id,self.scope.rzSliderModel,self.scope.rzSliderHigh)})}},callOnEnd:function(){if(this.options.onEnd){var self=this;this.scope.$evalAsync(function(){self.options.onEnd(self.options.id,self.scope.rzSliderModel,self.scope.rzSliderHigh)})}}},Slider}]).directive("rzslider",["RzSlider",function(RzSlider){return{restrict:"E",scope:{rzSliderModel:"=?",rzSliderHigh:"=?",rzSliderOptions:"&?",rzSliderTplUrl:"@"},templateUrl:function(elem,attrs){return attrs.rzSliderTplUrl||"rzSliderTpl.html"},link:function(scope,elem){scope.slider=new RzSlider(scope,elem)}}}]);return module.run(["$templateCache",function($templateCache){$templateCache.put("rzSliderTpl.html",'<span class=rz-bar-wrapper><span class=rz-bar></span></span> <span class=rz-bar-wrapper><span class="rz-bar rz-selection" ng-style=barStyle></span></span> <span class="rz-pointer rz-pointer-min" ng-style=minPointerStyle></span> <span class="rz-pointer rz-pointer-max" ng-style=maxPointerStyle></span> <span class="rz-bubble rz-limit"></span> <span class="rz-bubble rz-limit"></span> <span class=rz-bubble></span> <span class=rz-bubble></span> <span class=rz-bubble></span><ul ng-show=showTicks class=rz-ticks><li ng-repeat="t in ticks track by $index" class=rz-tick ng-class="{\'rz-selected\': t.selected}" ng-style=t.style ng-attr-uib-tooltip="{{ t.tooltip }}" ng-attr-tooltip-placement={{t.tooltipPlacement}} ng-attr-tooltip-append-to-body="{{ t.tooltip ? true : undefined}}"><span ng-if="t.value != null" class=rz-tick-value ng-attr-uib-tooltip="{{ t.valueTooltip }}" ng-attr-tooltip-placement={{t.valueTooltipPlacement}}>{{ t.value }}</span> <span ng-if="t.legend != null" class=rz-tick-legend>{{ t.legend }}</span></li></ul>')}]),module}),angular.module("recipes").directive("shelfstatusbar",function(){const pbLimitEmpty=10,pbLengthDeficit=20,pbLengthDesired=30,pbLenghtMax=30,pbMultyMax=5;return{restrict:"AE",scope:{progressbar:"=handle"},require:"ngModel",template:'<div><div ng-show="progressbar"><progressbar class="{{progressbar.class}}" value="progressbar.value" type="{{progressbar.type}}" max="100"><span style="color:white; white-space:nowrap;">{{progressbar.text}}</span></progressbar></div><div ng-hide="progressbar"></div></div>',link:function(scope,iElement,iAttrs,ngModelController){ngModelController.$render=function(){scope.shelf=ngModelController.$viewValue,scope.progressUpdate()},scope.$watch(function(){return ngModelController.$modelValue},function(newValue){scope.progressUpdate()},!0),scope.progressUpdate=function(){scope.shelf&&(scope.shelf.stored<=scope.shelf.deficit?(scope.progressbar={type:"danger",text:scope.shelf.stored+" < "+scope.shelf.deficit,value:0+scope.shelf.stored/scope.shelf.deficit*pbLengthDeficit},scope.progressbar.value<pbLimitEmpty&&(scope.progressbar.value=pbLimitEmpty)):scope.shelf.stored<scope.shelf.desired?scope.progressbar={type:"warning",text:scope.shelf.stored,value:20+(scope.shelf.stored-scope.shelf.deficit)/(scope.shelf.desired-scope.shelf.deficit)*pbLengthDesired}:scope.shelf.stored<=scope.shelf.max?scope.progressbar={type:"success",text:scope.shelf.stored,value:50+(scope.shelf.stored-scope.shelf.desired)/(scope.shelf.max-scope.shelf.desired)*pbLenghtMax}:(scope.progressbar={type:"info",text:scope.shelf.stored+" > "+scope.shelf.max,value:75+scope.shelf.stored/scope.shelf.max*pbMultyMax},scope.progressbar.value>100&&(scope.progressbar.value=100)),scope.shelf.isSpoiled&&(scope.progressbar["class"]="progress-striped active"))}}}}),angular.module("recipes").factory("IngredientService",IngredientService),IngredientService.$inject=["$resource","ShelfService","MeasureService"],angular.module("recipes").factory("Ingridients",["$resource",function($resource){return $resource("api/ingridients/:ingridientId",{ingridientId:"@id"},{update:{method:"PUT"}})}]),angular.module("recipes").factory("MealService",MealService),MealService.$inject=["$resource","RecipeService"],angular.module("recipes").factory("Measures",["$resource",function($resource){return $resource("api/measures/:measureId",{measureId:"@id"},{update:{method:"PUT"}})}]),angular.module("recipes").factory("MeasureService",MeasureService),MeasureService.$inject=["$resource"],angular.module("recipes").factory("MenuService",MenuService),MenuService.$inject=["$resource"],angular.module("recipes").factory("Products",["$resource",function($resource){return $resource("api/products/:productId",{productId:"@id"},{update:{method:"PUT"}})}]),angular.module("recipes").factory("Recipes",["$resource",function($resource){return $resource("api/recipes/:recipeId",{recipeId:"@id"},{update:{method:"PUT"}})}]),angular.module("recipes").factory("RecipeService",RecipeService),RecipeService.$inject=["$resource"],angular.module("recipes").factory("ShelfService",ShelfService),ShelfService.$inject=["$resource"],angular.module("recipes").factory("ShelfQueryService",ShelfQueryService),ShelfQueryService.$inject=["$resource"],angular.module("user.admin").run(["Menus",function(Menus){Menus.addSubMenuItem("topbar","admin",{title:"Manage Users",state:"admin.users"})}]),angular.module("user.admin.routes").config(["$stateProvider",function($stateProvider){$stateProvider.state("admin.users",{url:"/users",templateUrl:"modules/users/client/views/admin/list-users.client.view.html",controller:"UserListController"}).state("admin.user",{url:"/user/:userId",templateUrl:"modules/users/client/views/admin/view-user.client.view.html",controller:"UserController",resolve:{userResolve:["$stateParams","Admin",function($stateParams,Admin){return Admin.get({userId:$stateParams.userId})}]}}).state("admin.user-edit",{url:"/user/:userId/edit",templateUrl:"modules/users/client/views/admin/edit-user.client.view.html",controller:"UserController",resolve:{userResolve:["$stateParams","Admin",function($stateParams,Admin){return Admin.get({userId:$stateParams.userId})}]}})}]),angular.module("user").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("user").config(["$stateProvider",function($stateProvider){$stateProvider.state("settings",{"abstract":!0,url:"/settings",templateUrl:"modules/users/client/views/settings/settings.client.view.html",data:{roles:["user","admin"]}}).state("settings.profile",{url:"/profile",templateUrl:"modules/users/client/views/settings/edit-profile.client.view.html"}).state("settings.password",{url:"/password",templateUrl:"modules/users/client/views/settings/change-password.client.view.html"}).state("settings.accounts",{url:"/accounts",templateUrl:"modules/users/client/views/settings/manage-social-accounts.client.view.html"}).state("settings.picture",{url:"/picture",templateUrl:"modules/users/client/views/settings/change-profile-picture.client.view.html"}).state("authentication",{"abstract":!0,url:"/authentication",templateUrl:"modules/users/client/views/authentication/authentication.client.view.html"}).state("authentication.signup",{url:"/signup",templateUrl:"modules/users/client/views/authentication/signup.client.view.html"}).state("authentication.signin",{url:"/signin?err",templateUrl:"modules/users/client/views/authentication/signin.client.view.html"}).state("password",{"abstract":!0,url:"/password",template:"<ui-view/>"}).state("password.forgot",{url:"/forgot",templateUrl:"modules/users/client/views/password/forgot-password.client.view.html"}).state("password.reset",{"abstract":!0,url:"/reset",template:"<ui-view/>"}).state("password.reset.invalid",{url:"/invalid",templateUrl:"modules/users/client/views/password/reset-password-invalid.client.view.html"}).state("password.reset.success",{url:"/success",templateUrl:"modules/users/client/views/password/reset-password-success.client.view.html"}).state("password.reset.form",{url:"/:token",templateUrl:"modules/users/client/views/password/reset-password.client.view.html"})}]),angular.module("user.admin").controller("UserListController",["$scope","$filter","Admin",function($scope,$filter,Admin){Admin.query(function(data){$scope.users=data,$scope.buildPager()}),$scope.buildPager=function(){$scope.pagedItems=[],$scope.itemsPerPage=15,$scope.currentPage=1,$scope.figureOutItemsToDisplay()},$scope.figureOutItemsToDisplay=function(){$scope.filteredItems=$filter("filter")($scope.users,{$:$scope.search}),$scope.filterLength=$scope.filteredItems.length;var begin=($scope.currentPage-1)*$scope.itemsPerPage,end=begin+$scope.itemsPerPage;$scope.pagedItems=$scope.filteredItems.slice(begin,end)},$scope.pageChanged=function(){$scope.figureOutItemsToDisplay()}}]),angular.module("user.admin").controller("UserController",["$scope","$state","Authentication","userResolve",function($scope,$state,Authentication,userResolve){$scope.authentication=Authentication,$scope.user=userResolve,$scope.remove=function(){if(confirm("Are you sure you want to delete this user?")){var user=$scope.user;user.$remove({userId:user.id},function(){$state.go("admin.users")},function(errorResponse){$scope.error=errorResponse.data.message})}},$scope.update=function(isValid){if(!isValid)return $scope.$broadcast("show-errors-check-validity","userForm"),!1;var user=$scope.user;user.$update({userId:user.id},function(){$state.go("admin.user",{userId:user.id})},function(errorResponse){$scope.error=errorResponse.data.message})}}]),angular.module("user").controller("AuthenticationController",["$scope","$state","$http","$location","$window","Authentication","PasswordValidator",function($scope,$state,$http,$location,$window,Authentication,PasswordValidator){$scope.authentication=Authentication,$scope.popoverMsg=PasswordValidator.getPopoverMsg(),$scope.error=$location.search().err,$scope.authentication.user&&$location.path("/"),$scope.signup=function(isValid){return $scope.error=null,isValid?void $http.post("/api/auth/signup",$scope.credentials).success(function(response){$scope.authentication.user=response,$state.go($state.previous.state.name||"home",$state.previous.params)}).error(function(response){$scope.error=response.message}):($scope.$broadcast("show-errors-check-validity","userForm"),!1)},$scope.signin=function(isValid){return $scope.error=null,isValid?void $http.post("/api/auth/signin",$scope.credentials).success(function(response){$scope.authentication.user=response,$state.go($state.previous.state.name||"home",$state.previous.params)}).error(function(response){$scope.error=response.message}):($scope.$broadcast("show-errors-check-validity","userForm"),!1)},$scope.callOauthProvider=function(url){$state.previous&&$state.previous.href&&(url+="?redirect_to="+encodeURIComponent($state.previous.href)),$window.location.href=url}}]),angular.module("user").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication","PasswordValidator",function($scope,$stateParams,$http,$location,Authentication,PasswordValidator){$scope.authentication=Authentication,$scope.popoverMsg=PasswordValidator.getPopoverMsg(),$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(isValid){return $scope.success=$scope.error=null,isValid?void $http.post("/api/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message}):($scope.$broadcast("show-errors-check-validity","forgotPasswordForm"),!1)},$scope.resetUserPassword=function(isValid){return $scope.success=$scope.error=null,isValid?void $http.post("/api/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message}):($scope.$broadcast("show-errors-check-validity","resetPasswordForm"),!1)}}]),angular.module("user").controller("ChangePasswordController",["$scope","$http","Authentication","PasswordValidator",function($scope,$http,Authentication,PasswordValidator){$scope.user=Authentication.user,$scope.popoverMsg=PasswordValidator.getPopoverMsg(),$scope.changeUserPassword=function(isValid){return $scope.success=$scope.error=null,isValid?void $http.post("/api/user/password",$scope.passwordDetails).success(function(response){$scope.$broadcast("show-errors-reset","passwordForm"),$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message}):($scope.$broadcast("show-errors-check-validity","passwordForm"),!1)}}]),angular.module("user").controller("ChangeProfilePictureController",["$scope","$timeout","$window","Authentication","FileUploader",function($scope,$timeout,$window,Authentication,FileUploader){$scope.user=Authentication.user,$scope.imageURL=$scope.user.profileImageURL,$scope.uploader=new FileUploader({url:"api/user/picture"}),$scope.uploader.filters.push({name:"imageFilter",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(type)!==-1}}),$scope.uploader.onAfterAddingFile=function(fileItem){if($window.FileReader){var fileReader=new FileReader;fileReader.readAsDataURL(fileItem._file),fileReader.onload=function(fileReaderEvent){$timeout(function(){$scope.imageURL=fileReaderEvent.target.result},0)}}},$scope.uploader.onSuccessItem=function(fileItem,response,status,headers){$scope.success=!0,$scope.user=Authentication.user=response,$scope.cancelUpload()},$scope.uploader.onErrorItem=function(fileItem,response,status,headers){$scope.cancelUpload(),$scope.error=response.message},$scope.uploadProfilePicture=function(){$scope.success=$scope.error=null,$scope.uploader.uploadAll()},$scope.cancelUpload=function(){$scope.uploader.clearQueue(),$scope.imageURL=$scope.user.profileImageURL}}]),angular.module("user").controller("EditProfileController",["$scope","$http","$location","User","Authentication",function($scope,$http,$location,User,Authentication){$scope.user=Authentication.user,$scope.getProfile=function(){User.get(function(data){$scope.user=data})},$scope.updateUserProfile=function(isValid){if($scope.success=$scope.error=null,!isValid)return $scope.$broadcast("show-errors-check-validity","userForm"),!1;var user=new User($scope.user);user.$update(function(response){$scope.$broadcast("show-errors-reset","userForm"),$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}}]),angular.module("user").controller("SocialAccountsController",["$scope","$http","Authentication",function($scope,$http,Authentication){$scope.user=Authentication.user,$scope.hasConnectedAdditionalSocialAccounts=function(provider){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http["delete"]("/api/user/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})}}]),angular.module("user").controller("SettingsController",["$scope","Authentication",function($scope,Authentication){$scope.user=Authentication.user}]),angular.module("user").directive("passwordValidator",["PasswordValidator",function(PasswordValidator){return{require:"ngModel",link:function(scope,element,attrs,modelCtrl){modelCtrl.$parsers.unshift(function(password){var result=PasswordValidator.getResult(password),strengthIdx=0,strengthMeter=[{color:"danger",progress:"20"},{color:"warning",progress:"40"},{color:"info",progress:"60"},{color:"primary",progress:"80"},{color:"success",progress:"100"}];strengthMeter.length;return result.errors.length<strengthMeter.length&&(strengthIdx=strengthMeter.length-result.errors.length-1),scope.strengthColor=strengthMeter[strengthIdx].color,scope.strengthProgress=strengthMeter[strengthIdx].progress,result.errors.length?(scope.popoverMsg=PasswordValidator.getPopoverMsg(),scope.passwordErrors=result.errors,void modelCtrl.$setValidity("strength",!1)):(scope.popoverMsg="",modelCtrl.$setValidity("strength",!0),password)})}}}]),angular.module("user").directive("passwordVerify",function(){return{require:"ngModel",scope:{passwordVerify:"="},link:function(scope,element,attrs,modelCtrl){scope.$watch(function(){var combined;return(scope.passwordVerify||modelCtrl.$viewValue)&&(combined=scope.passwordVerify+"_"+modelCtrl.$viewValue),combined},function(value){value&&modelCtrl.$parsers.unshift(function(viewValue){var origin=scope.passwordVerify;return origin!==viewValue?void modelCtrl.$setValidity("passwordVerify",!1):(modelCtrl.$setValidity("passwordVerify",!0),viewValue)})})}}}),angular.module("user").directive("lowercase",function(){return{require:"ngModel",link:function(scope,element,attrs,modelCtrl){modelCtrl.$parsers.push(function(input){return input?input.toLowerCase():""}),element.css("text-transform","lowercase")}}}),angular.module("user").factory("Authentication",["$window",function($window){var auth={user:$window.user};return auth}]),angular.module("user").factory("PasswordValidator",["$window",function($window){var owaspPasswordStrengthTest=$window.owaspPasswordStrengthTest;return{getResult:function(password){var result=owaspPasswordStrengthTest.test(password);return result},getPopoverMsg:function(){var popoverMsg="Please enter a passphrase or password with greater than 10 characters, numbers, lowercase, upppercase, and special characters.";return popoverMsg}}}]),angular.module("user").factory("User",["$resource",function($resource){return $resource("api/user",{},{get:{method:"GET"},update:{method:"PUT"}})}]),angular.module("user.admin").factory("Admin",["$resource",function($resource){return $resource("api/admin/user/:userId",{userId:"@_id"},{query:{method:"GET",params:{},isArray:!0},update:{method:"PUT"}})}]);